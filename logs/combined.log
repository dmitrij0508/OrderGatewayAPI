{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"âœ… Database migration completed","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸš€ Order Gateway API started on port 3000","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸ“– API Index: http://localhost:3000/api","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸ’“ Health Check: http://localhost:3000/health","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸŒ Environment: development","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"ðŸŽ£ OhMyApp.io webhook support: ENABLED","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:03"}
{"level":"info","message":"Closing SQLite database...","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:04"}
{"level":"info","message":"SIGINT received, shutting down gracefully","service":"pos-order-gateway-api","timestamp":"2025-11-06 19:44:04"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:28"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"âœ… Database migration completed","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸš€ Order Gateway API started on port 3000","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸ“– API Index: http://localhost:3000/api","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸ’“ Health Check: http://localhost:3000/health","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸŒ Environment: development","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"ðŸŽ£ OhMyApp.io webhook support: ENABLED","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:40:29"}
{"level":"info","message":"Closing SQLite database...","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:44:33"}
{"level":"info","message":"SIGINT received, shutting down gracefully","service":"pos-order-gateway-api","timestamp":"2025-11-07 19:44:33"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"âœ… Database migration completed","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸš€ Order Gateway API started on port 3000","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸ“– API Index: http://localhost:3000/api","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸ’“ Health Check: http://localhost:3000/health","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸŒ Environment: development","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"ðŸŽ£ OhMyApp.io webhook support: ENABLED","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:43"}
{"level":"info","message":"Closing SQLite database...","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:47"}
{"level":"info","message":"SIGINT received, shutting down gracefully","service":"pos-order-gateway-api","timestamp":"2025-11-07 20:23:47"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"âœ… Database migration completed","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸš€ Order Gateway API started on port 3000","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸ“– API Index: http://localhost:3000/api","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸ’“ Health Check: http://localhost:3000/health","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸŒ Environment: development","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"ðŸŽ£ OhMyApp.io webhook support: ENABLED","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:26"}
{"level":"info","message":"Closing SQLite database...","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:50"}
{"level":"info","message":"SIGINT received, shutting down gracefully","service":"pos-order-gateway-api","timestamp":"2025-11-10 21:52:50"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to save payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-11 05:19:54"}
{"body":{"description":"Jest test payload","key":"jest_sample_1762838394451","payload":{"foo":"bar","n":42},"source":"jest"},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-11 05:19:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762838394451","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762838394451","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to load payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762838394451' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:33:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:19:54"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads/jest_sample_1762838394451","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762838394451' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:33:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:19:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:19:54"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:48:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:19:54"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:48:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:19:54"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:02"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:02"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:02"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:02"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to save payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-11 05:53:03"}
{"body":{"description":"Jest test payload","key":"jest_sample_1762840382962","payload":{"foo":"bar","n":42},"source":"jest"},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-11 05:53:03"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762840382962","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762840382962","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to load payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762840382962' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:54:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:53:03"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads/jest_sample_1762840382962","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762840382962' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:54:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:53:03"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-11 05:53:03"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:69:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:53:03"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:69:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-11 05:53:03"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to save payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:06:46"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"body":{"description":"Jest test payload","key":"jest_sample_1762967206522","payload":{"foo":"bar","n":42},"source":"jest"},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:06:46"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762967206522","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762967206522","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to load payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967206522' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:46"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads/jest_sample_1762967206522","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967206522' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:46"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:46"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:46"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:46"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to save payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:06:59"}
{"body":{"description":"Jest test payload","key":"jest_sample_1762967219732","payload":{"foo":"bar","n":42},"source":"jest"},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:06:59"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762967219732","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762967219732","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to load payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967219732' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:59"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads/jest_sample_1762967219732","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967219732' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:59"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:06:59"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:59"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:06:59"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to save payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:10:29"}
{"body":{"description":"Jest test payload","key":"jest_sample_1762967429661","payload":{"foo":"bar","n":42},"source":"jest"},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762967429661","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762967429661","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to load payload: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967429661' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:10:29"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads/jest_sample_1762967429661","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967429661' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"__augmented":true,"code":"SQLITE_ERROR","errno":1,"level":"error","message":"Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:10:29"}
{"body":{},"error":"SQLITE_ERROR: no such table: saved_payloads","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"GET","path":"/api/v1/payloads","service":"pos-order-gateway-api","stack":"Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:29"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… POS catalog table created","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:10:30"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762967531233","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762967531233","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 17:12:11"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:06"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:06"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:06"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:06"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807280","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762972807280","orderTime":"2025-11-12T18:40:07.280Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807280","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762972807280","orderTime":"2025-11-12T18:40:07.280Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807505-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972807505-TM","orderTime":"2025-11-12T18:40:07.505Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807505-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762972807505-TM","orderTime":"2025-11-12T18:40:07.505Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762972807505-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762972807505-TM","orderId":"ORD-1762972807505-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807505-TM","internalId":"8376cb9c-c416-4b67-93d8-a705ba34b630","level":"info","message":"Creating order with data:","orderId":"ORD-1762972807505-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:40:07"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762972807505-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762972807505-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"95ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:07"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"144ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:07"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972807505-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972807505-TM","orderTime":"2025-11-12T18:40:07.505Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762972807558","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762972807558","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:07"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:08"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:08"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:08"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:08"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:08"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:23"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824247","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762972824247","orderTime":"2025-11-12T18:40:24.247Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824247","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762972824247","orderTime":"2025-11-12T18:40:24.247Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762972824123","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762972824123","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824501-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972824501-TM","orderTime":"2025-11-12T18:40:24.501Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824501-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762972824501-TM","orderTime":"2025-11-12T18:40:24.501Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762972824501-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762972824501-TM","orderId":"ORD-1762972824501-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824501-TM","internalId":"1d51169a-1047-450c-9abb-9065527e78b4","level":"info","message":"Creating order with data:","orderId":"ORD-1762972824501-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:40:24"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762972824501-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762972824501-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"81ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:24"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"115ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:24"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972824501-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972824501-TM","orderTime":"2025-11-12T18:40:24.501Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:40:24"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:07"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762972987945","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762972987945","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972988749","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762972988749","orderTime":"2025-11-12T18:43:08.749Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972988749","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762972988749","orderTime":"2025-11-12T18:43:08.749Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:08"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972989054-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972989054-TM","orderTime":"2025-11-12T18:43:09.054Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972989054-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762972989054-TM","orderTime":"2025-11-12T18:43:09.054Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762972989054-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762972989054-TM","orderId":"ORD-1762972989054-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972989054-TM","internalId":"3beb60d7-d6fd-406a-9e55-e935e27954ff","level":"info","message":"Creating order with data:","orderId":"ORD-1762972989054-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:43:09"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762972989054-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762972989054-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"120ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:43:09"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"150ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:43:09"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762972989054-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762972989054-TM","orderTime":"2025-11-12T18:43:09.054Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"0":"id","1":"payload_key","2":"description","3":"source","4":"payload","5":"created_at","6":"updated_at","level":"info","message":"ðŸ“‹ saved_payloads table columns:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸŽ‰ Saved Payloads migration completed.","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"POS catalog table already exists","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸ§ª Migrations applied for test/import context","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:43:09"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743690","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762973743690","orderTime":"2025-11-12T18:55:43.690Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743690","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762973743690","orderTime":"2025-11-12T18:55:43.690Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762973743512","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762973743512","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743897-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973743897-TM","orderTime":"2025-11-12T18:55:43.897Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743897-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762973743897-TM","orderTime":"2025-11-12T18:55:43.897Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762973743897-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762973743897-TM","orderId":"ORD-1762973743897-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:43","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743897-TM","internalId":"422c4948-acdd-4a94-a1ba-92461894e336","level":"info","message":"Creating order with data:","orderId":"ORD-1762973743897-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:55:44"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762973743897-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762973743897-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"111ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:44"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"193ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:44"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973743897-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973743897-TM","orderTime":"2025-11-12T18:55:43.897Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:44"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749869","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762973749869","orderTime":"2025-11-12T18:55:49.869Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749869","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762973749869","orderTime":"2025-11-12T18:55:49.869Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749986-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973749986-TM","orderTime":"2025-11-12T18:55:49.986Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749986-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762973749986-TM","orderTime":"2025-11-12T18:55:49.986Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762973749986-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762973749986-TM","orderId":"ORD-1762973749986-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749986-TM","internalId":"1adc73c1-e1d5-4edb-b4d9-a49181a2596e","level":"info","message":"Creating order with data:","orderId":"ORD-1762973749986-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:55:50"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762973749986-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762973749986-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"60ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:50"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"74ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:50"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973749986-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973749986-TM","orderTime":"2025-11-12T18:55:49.986Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:49"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762973749994","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762973749994","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:50"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:54"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755075","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762973755075","orderTime":"2025-11-12T18:55:55.075Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755075","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762973755075","orderTime":"2025-11-12T18:55:55.075Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762973755044","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762973755044","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755302-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973755302-TM","orderTime":"2025-11-12T18:55:55.302Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755302-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762973755302-TM","orderTime":"2025-11-12T18:55:55.302Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762973755302-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762973755302-TM","orderId":"ORD-1762973755302-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55","total":3}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755302-TM","internalId":"f76c0985-909e-4b70-8786-13cfae3ea21a","level":"info","message":"Creating order with data:","orderId":"ORD-1762973755302-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:55:55"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55","tolerance":0.05}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762973755302-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762973755302-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"124ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:55"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"157ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:55"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973755302-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973755302-TM","orderTime":"2025-11-12T18:55:55.302Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:55:55"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:00"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:00"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:00"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:00"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"apiKeyPrefix":"test-key...","ip":"::ffff:127.0.0.1","level":"warn","message":"Authentication failed: Invalid API key","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ”’ Proxy trust enabled for production deployment","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ”„ Applying OhMyApp.io support migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ—„ï¸ Connected to SQLite database","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761331","items":[{"name":"Coffee","quantity":1,"unitPrice":2.99},{"name":"Coffee","quantity":0,"sku":"COFFEE-12OZ","unitPrice":2.99},{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ"}],"orderId":"ORD-1762973761331","orderTime":"2025-11-12T18:56:01.331Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761331","items":[{"itemId":null,"modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":2.99},{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":0}],"notes":"","orderId":"ORD-1762973761331","orderTime":"2025-11-12T18:56:01.331Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":2.99,"tax":0,"tip":0,"total":2.99},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"errors":["items[0].sku is required"],"level":"warn","message":"âŒ Order validation failed","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"POST /api/v1/orders","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"Processing order data:","orderData":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761552-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973761552-TM","orderTime":"2025-11-12T18:56:01.552Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"Processed order ready for service:","processedOrder":{"_ohmyAppFields":{"hasAddress":false,"hasServiceFee":false,"hasShippingFee":false,"hasWebhookMetadata":false},"createdAt":null,"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761552-TM","items":[{"itemId":"COFFEE-12OZ","modifiers":[],"name":"Coffee","quantity":1,"specialInstructions":null,"totalPrice":0,"unitPrice":3.5}],"notes":"","orderId":"ORD-1762973761552-TM","orderTime":"2025-11-12T18:56:01.552Z","orderType":"pickup","originalOrderId":null,"payment":{"amount":0,"method":null,"status":"pending","transactionId":null},"requestedTime":null,"restaurantId":"NYC-DELI-001","source":"api","status":"received","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3},"webhookMetadata":null},"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (pre-POS-price)","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals mismatch (pre-POS-price)","payloadSubtotal":3,"payloadTotal":3,"previewSubtotal":3.5,"previewTotal":3.5,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01","tolerance":0.05}
{"client":"Admin Dashboard","customerEmail":null,"externalOrderId":"EXT-1762973761552-TM","itemCount":1,"level":"info","message":"Creating enhanced order ORD-1762973761552-TM","orderId":"ORD-1762973761552-TM","orderType":"pickup","paymentStatus":"pending","requestedTime":null,"restaurantId":"NYC-DELI-001","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01","total":3}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads/jest_sample_1762973761246","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/jest_sample_1762973761246","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"ip":"::ffff:127.0.0.1","ips":[],"level":"info","message":"GET /api/v1/payloads","remoteAddress":"::ffff:127.0.0.1","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"client":"Admin Dashboard","ip":"::ffff:127.0.0.1","level":"info","message":"Authentication successful","path":"/","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"customer":{"address":null,"email":null,"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761552-TM","internalId":"f01292a2-50f3-44d9-b5e7-3c29b750b054","level":"info","message":"Creating order with data:","orderId":"ORD-1762973761552-TM","orderType":"pickup","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}}
{"expectedTotal":3.5,"level":"info","lines":[{"extended":3.5,"modsTotal":0,"name":"Coffee","qty":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"message":"ðŸ§¾ MAPPED LINES (final-to-POS)","service":"pos-order-gateway-api","subtotal":3.5,"timestamp":"2025-11-12 18:56:01"}
{"calculatedSubtotal":3.5,"calculatedTotal":3.5,"diffSubtotal":0.5,"diffTotal":0.5,"level":"warn","message":"âš–ï¸ Totals reconciliation failed","payloadSubtotal":3,"payloadTotal":3,"service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01","tolerance":0.05}
{"0":{"cid":0,"dflt_value":"lower(hex(randomblob(16)))","name":"id","notnull":0,"pk":1,"type":"TEXT"},"1":{"cid":1,"dflt_value":null,"name":"order_id","notnull":1,"pk":0,"type":"TEXT"},"10":{"cid":10,"dflt_value":null,"name":"requested_time","notnull":0,"pk":0,"type":"TEXT"},"11":{"cid":11,"dflt_value":null,"name":"subtotal","notnull":1,"pk":0,"type":"REAL"},"12":{"cid":12,"dflt_value":null,"name":"tax","notnull":1,"pk":0,"type":"REAL"},"13":{"cid":13,"dflt_value":"0","name":"tip","notnull":0,"pk":0,"type":"REAL"},"14":{"cid":14,"dflt_value":"0","name":"discount","notnull":0,"pk":0,"type":"REAL"},"15":{"cid":15,"dflt_value":"0","name":"delivery_fee","notnull":0,"pk":0,"type":"REAL"},"16":{"cid":16,"dflt_value":null,"name":"total","notnull":1,"pk":0,"type":"REAL"},"17":{"cid":17,"dflt_value":null,"name":"payment_method","notnull":0,"pk":0,"type":"TEXT"},"18":{"cid":18,"dflt_value":"'pending'","name":"payment_status","notnull":0,"pk":0,"type":"TEXT"},"19":{"cid":19,"dflt_value":null,"name":"payment_transaction_id","notnull":0,"pk":0,"type":"TEXT"},"2":{"cid":2,"dflt_value":null,"name":"external_order_id","notnull":1,"pk":0,"type":"TEXT"},"20":{"cid":20,"dflt_value":"'received'","name":"status","notnull":0,"pk":0,"type":"TEXT"},"21":{"cid":21,"dflt_value":null,"name":"estimated_time","notnull":0,"pk":0,"type":"TEXT"},"22":{"cid":22,"dflt_value":null,"name":"cancellation_reason","notnull":0,"pk":0,"type":"TEXT"},"23":{"cid":23,"dflt_value":null,"name":"notes","notnull":0,"pk":0,"type":"TEXT"},"24":{"cid":24,"dflt_value":"datetime('now')","name":"created_at","notnull":0,"pk":0,"type":"TEXT"},"25":{"cid":25,"dflt_value":"datetime('now')","name":"updated_at","notnull":0,"pk":0,"type":"TEXT"},"26":{"cid":26,"dflt_value":null,"name":"customer_address","notnull":0,"pk":0,"type":"TEXT"},"27":{"cid":27,"dflt_value":"0","name":"payment_amount","notnull":0,"pk":0,"type":"REAL"},"28":{"cid":28,"dflt_value":"'api'","name":"source","notnull":0,"pk":0,"type":"TEXT"},"29":{"cid":29,"dflt_value":null,"name":"webhook_metadata","notnull":0,"pk":0,"type":"TEXT"},"3":{"cid":3,"dflt_value":null,"name":"restaurant_id","notnull":1,"pk":0,"type":"TEXT"},"30":{"cid":30,"dflt_value":null,"name":"original_order_id","notnull":0,"pk":0,"type":"TEXT"},"31":{"cid":31,"dflt_value":null,"name":"webhook_created_at","notnull":0,"pk":0,"type":"TEXT"},"4":{"cid":4,"dflt_value":null,"name":"idempotency_key","notnull":1,"pk":0,"type":"TEXT"},"5":{"cid":5,"dflt_value":null,"name":"customer_name","notnull":1,"pk":0,"type":"TEXT"},"6":{"cid":6,"dflt_value":null,"name":"customer_phone","notnull":1,"pk":0,"type":"TEXT"},"7":{"cid":7,"dflt_value":null,"name":"customer_email","notnull":0,"pk":0,"type":"TEXT"},"8":{"cid":8,"dflt_value":null,"name":"order_type","notnull":1,"pk":0,"type":"TEXT"},"9":{"cid":9,"dflt_value":null,"name":"order_time","notnull":1,"pk":0,"type":"TEXT"},"level":"info","message":"ðŸ“‹ Final orders table structure:","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸŽ‰ OhMyApp.io migration completed successfully!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ§ª Testing new database structure...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… All new order columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… order_items.category column is present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"databaseState":{"lastQuery":"Check logs for last executed query"},"error":"Totals reconciliation failed","failedAtStep":4,"level":"error","message":"âŒ SERVICE CREATION FAILED - Detailed Debug","orderDataSnapshot":{"externalOrderId":"EXT-1762973761552-TM","hasCustomer":true,"hasItems":true,"hasTotals":true,"itemCount":1,"orderId":"ORD-1762973761552-TM","totalAmount":3},"service":"pos-order-gateway-api","serviceProcessingTime":"105ms","stack":"TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:56:01"}
{"error":"Totals mismatch","failedAtStep":6,"level":"error","message":"âŒ ORDER CREATION FAILED - Detailed Debug","processedOrderSnapshot":"Transformation completed","processingTime":"127ms","requestAnalysis":{"bodyKeys":["orderId","externalOrderId","restaurantId","customer","orderType","orderTime","items","totals"],"contentType":"application/json","hasBody":true,"method":"POST","url":"/"},"service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:56:01"}
{"body":{"customer":{"name":"Test","phone":"555-1234"},"externalOrderId":"EXT-1762973761552-TM","items":[{"name":"Coffee","quantity":1,"sku":"COFFEE-12OZ","unitPrice":3.5}],"orderId":"ORD-1762973761552-TM","orderTime":"2025-11-12T18:56:01.552Z","orderType":"pickup","restaurantId":"NYC-DELI-001","totals":{"deliveryFee":0,"discount":0,"subtotal":3,"tax":0,"tip":0,"total":3}},"error":"Totals mismatch","ip":"::ffff:127.0.0.1","level":"error","message":"API Error:","method":"POST","path":"/api/v1/orders","service":"pos-order-gateway-api","stack":"Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… All new order_item_modifiers columns are present","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸŽ¯ Database structure test completed!","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"ðŸ”„ Applying Saved Payloads migration...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
{"level":"info","message":"âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...","service":"pos-order-gateway-api","timestamp":"2025-11-12 18:56:01"}
