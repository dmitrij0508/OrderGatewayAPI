[2025-11-04 00:40:11.024] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.032] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.040] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.066] INFO: ‚úÖ Executed: PRAGMA table_info(orders)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.067] INFO: üìã Table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.068] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:11.069] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.831] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.841] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.849] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.858] INFO: ‚úÖ Executed: PRAGMA table_info(orders)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.859] INFO: üìã Table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.864] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:40:57.865] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:51.921] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:51.934] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:51.948] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.000] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.045] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.085] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.139] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.185] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.230] INFO: ‚úÖ Applied: ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.272] INFO: ‚úÖ Applied: ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.317] INFO: ‚úÖ Applied: ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.364] INFO: ‚úÖ Applied: ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.417] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.459] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.518] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.538] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.588] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.598] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.604] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.606] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.608] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.609] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.609] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.619] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.708] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.738] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.739] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:53:52.739] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:54:29.074] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 00:54:29.075] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.795] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.803] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.822] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.826] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.830] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.831] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.833] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.834] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.835] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.836] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.839] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.841] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.852] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.855] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.857] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.865] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.869] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.869] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.871] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.872] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.873] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.874] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.875] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.887] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.887] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.888] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.888] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:06:37.891] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:29.366] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:29.367] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.761] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.768] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.782] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.788] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.790] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.791] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.792] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.793] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.794] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.795] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.796] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.797] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.799] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.800] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.801] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.804] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.808] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.809] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.811] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.815] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.817] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.817] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.817] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.825] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.826] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.827] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.827] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:07:53.829] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:13.764] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:13.766] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.016] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.026] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.035] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.041] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.044] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.049] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.053] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.055] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.058] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.059] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.060] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.061] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.065] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.067] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.069] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.073] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.077] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.077] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.081] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.084] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.087] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.090] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.091] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.102] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.102] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.104] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.109] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:23.110] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.816] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.824] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.830] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.839] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.842] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.843] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.844] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.845] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.846] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.848] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.848] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.849] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.850] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.852] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.855] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.861] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.864] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.865] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.866] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.867] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:42.868] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:50.427] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:17:50.428] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.774] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.786] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.797] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.803] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.805] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.807] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.809] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.811] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.812] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.813] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.814] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.817] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.818] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.819] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.819] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.821] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.822] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.823] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.830] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.834] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.837] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.837] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.839] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.851] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.851] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.853] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.857] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:32.861] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:18:48.533] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:18:48.534] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-api...",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:19:00.468] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:19:00.469] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-api...",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:19:59.765] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:19:59.765] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "sync-age...",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:22:34.530] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:22:34.531] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 01:22:34.535] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1510",
    "connection": "Keep-Alive"
  },
  "query": {},
  "params": {},
  "bodySize": 684,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 01:22:34.536] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 933,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "payload": "{\n  \"order_type\": \"delivery\",\n  \"tax\": 2.55,\n  \"order_id\": \"TEST-20251104012234\",\n  \"order_time\": \"2025-11-04T01:22:34Z\",\n  \"subtotal\": 25.5,\n  \"customer_name\": \"John Doe\",\n  \"restaurant_id\": \"REST-001\",\n  \"payment_status\": \"paid\",\n  \"customer_address\": \"123 Main St, City, State 12345\",\n  \"external_order_id\": \"EXT-TEST-20251104012234\",\n  \"customer_phone\": \"+1234567890\",\n  \"payment_method\": \"credit_card\",\n  \"customer_email\": \"john@example.com\",\n  \"tip\": 5,\n  \"items\": [\n    {\n      \"name\": \"Burger\",\n      \"item_id\": \"ITEM-001\",\n      \"quantity\": 2,\n      \"price\": 10,\n      \"category\": \"Main Course\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"modifier_id\": \"MOD-001\",\n          \"name\": \"Extra Cheese\",\n          \"quantity\": 1\n        }\n      ]\n    },\n    {\n      \"price\": 5.5,\n      \"quantity\": 1,\n      \"item_id\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"category\": \"Sides\"\n    }\n  ],\n  \"total\": 33.05\n}"
}
[2025-11-04 01:22:34.537] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 1,
  "steps": [
    {
      "step": 1,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 3,
      "error": "Cannot read properties of undefined (reading 'detectOhMyAppWebhook')"
    }
  ]
}
[2025-11-04 01:22:34.538] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Cannot read properties of undefined (reading 'detectOhMyAppWebhook')",
  "stack": "TypeError: Cannot read properties of undefined (reading 'detectOhMyAppWebhook')\n    at createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:19:37)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)",
  "processingTime": "3ms",
  "failedAtStep": 1,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "order_type",
      "tax",
      "order_id",
      "order_time",
      "subtotal",
      "customer_name",
      "restaurant_id",
      "payment_status",
      "customer_address",
      "external_order_id",
      "customer_phone",
      "payment_method",
      "customer_email",
      "tip",
      "items",
      "total"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation not reached"
}
[2025-11-04 01:22:34.541] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Cannot read properties of undefined (reading 'detectOhMyAppWebhook')",
  "stack": "TypeError: Cannot read properties of undefined (reading 'detectOhMyAppWebhook')\n    at createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:19:37)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "order_type": "delivery",
    "tax": 2.55,
    "order_id": "TEST-20251104012234",
    "order_time": "2025-11-04T01:22:34Z",
    "subtotal": 25.5,
    "customer_name": "John Doe",
    "restaurant_id": "REST-001",
    "payment_status": "paid",
    "customer_address": "123 Main St, City, State 12345",
    "external_order_id": "EXT-TEST-20251104012234",
    "customer_phone": "+1234567890",
    "payment_method": "credit_card",
    "customer_email": "john@example.com",
    "tip": 5,
    "items": [
      {
        "name": "Burger",
        "item_id": "ITEM-001",
        "quantity": 2,
        "price": 10,
        "category": "Main Course",
        "modifiers": [
          {
            "price": 1.5,
            "modifier_id": "MOD-001",
            "name": "Extra Cheese",
            "quantity": 1
          }
        ]
      },
      {
        "price": 5.5,
        "quantity": 1,
        "item_id": "ITEM-002",
        "name": "Fries",
        "category": "Sides"
      }
    ],
    "total": 33.05
  }
}
[2025-11-04 01:26:54.456] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.466] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.470] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.480] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.482] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.484] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.485] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.486] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.487] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.489] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.490] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.490] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.492] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.493] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.496] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.498] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.500] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.501] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.502] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.504] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.508] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.510] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.513] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.519] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.520] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.520] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.523] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:26:54.524] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:27:09.980] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:27:10.007] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 01:27:10.013] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1510",
    "connection": "Keep-Alive"
  },
  "query": {},
  "params": {},
  "bodySize": 684,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 01:27:10.014] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 933,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "payload": "{\n  \"order_type\": \"delivery\",\n  \"tax\": 2.55,\n  \"order_id\": \"TEST-20251104012709\",\n  \"order_time\": \"2025-11-04T01:27:09Z\",\n  \"subtotal\": 25.5,\n  \"customer_name\": \"John Doe\",\n  \"restaurant_id\": \"REST-001\",\n  \"payment_status\": \"paid\",\n  \"customer_address\": \"123 Main St, City, State 12345\",\n  \"external_order_id\": \"EXT-TEST-20251104012709\",\n  \"customer_phone\": \"+1234567890\",\n  \"payment_method\": \"credit_card\",\n  \"customer_email\": \"john@example.com\",\n  \"tip\": 5,\n  \"items\": [\n    {\n      \"name\": \"Burger\",\n      \"item_id\": \"ITEM-001\",\n      \"quantity\": 2,\n      \"price\": 10,\n      \"category\": \"Main Course\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"modifier_id\": \"MOD-001\",\n          \"name\": \"Extra Cheese\",\n          \"quantity\": 1\n        }\n      ]\n    },\n    {\n      \"price\": 5.5,\n      \"quantity\": 1,\n      \"item_id\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"category\": \"Sides\"\n    }\n  ],\n  \"total\": 33.05\n}"
}
[2025-11-04 01:27:10.014] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 933,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "payload": "{\n  \"order_type\": \"delivery\",\n  \"tax\": 2.55,\n  \"order_id\": \"TEST-20251104012709\",\n  \"order_time\": \"2025-11-04T01:27:09Z\",\n  \"subtotal\": 25.5,\n  \"customer_name\": \"John Doe\",\n  \"restaurant_id\": \"REST-001\",\n  \"payment_status\": \"paid\",\n  \"customer_address\": \"123 Main St, City, State 12345\",\n  \"external_order_id\": \"EXT-TEST-20251104012709\",\n  \"customer_phone\": \"+1234567890\",\n  \"payment_method\": \"credit_card\",\n  \"customer_email\": \"john@example.com\",\n  \"tip\": 5,\n  \"items\": [\n    {\n      \"name\": \"Burger\",\n      \"item_id\": \"ITEM-001\",\n      \"quantity\": 2,\n      \"price\": 10,\n      \"category\": \"Main Course\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"modifier_id\": \"MOD-001\",\n          \"name\": \"Extra Cheese\",\n          \"quantity\": 1\n        }\n      ]\n    },\n    {\n      \"price\": 5.5,\n      \"quantity\": 1,\n      \"item_id\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"category\": \"Sides\"\n    }\n  ],\n  \"total\": 33.05\n}"
}
[2025-11-04 01:27:10.017] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f"
}
[2025-11-04 01:27:10.017] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": false,
  "hasCustomer": false,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ]
}
[2025-11-04 01:27:10.017] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "order_type": "delivery",
    "tax": 2.55,
    "order_id": "TEST-20251104012709",
    "order_time": "2025-11-04T01:27:09Z",
    "subtotal": 25.5,
    "customer_name": "John Doe",
    "restaurant_id": "REST-001",
    "payment_status": "paid",
    "customer_address": "123 Main St, City, State 12345",
    "external_order_id": "EXT-TEST-20251104012709",
    "customer_phone": "+1234567890",
    "payment_method": "credit_card",
    "customer_email": "john@example.com",
    "tip": 5,
    "items": [
      {
        "name": "Burger",
        "item_id": "ITEM-001",
        "quantity": 2,
        "price": 10,
        "category": "Main Course",
        "modifiers": [
          {
            "price": 1.5,
            "modifier_id": "MOD-001",
            "name": "Extra Cheese",
            "quantity": 1
          }
        ]
      },
      {
        "price": 5.5,
        "quantity": 1,
        "item_id": "ITEM-002",
        "name": "Fries",
        "category": "Sides"
      }
    ],
    "total": 33.05
  }
}
[2025-11-04 01:27:10.018] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "hasOrderId": true,
  "hasCustomer": false,
  "hasItems": true
}
[2025-11-04 01:27:10.019] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "beforeSample": "{\"order_type\":\"delivery\",\"tax\":2.55,\"order_id\":\"TEST-20251104012709\",\"order_time\":\"2025-11-04T01:27:09Z\",\"subtotal\":25.5,\"customer_name\":\"John Doe\",\"restaurant_id\":\"REST-001\",\"payment_status\":\"paid\",\"...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"TEST-20251104012709\",\"externalOrderId\":\"EXT-TEST-20251104012709\",\"restaurantId\":\"REST-001\",\"customer\":{\"name\":\"John Doe\",\"phone\":\"+1234567890\",\"email\":\"john@example.com\",\"address\":null},\"o...",
  "transformationDetails": {
    "fieldsGenerated": [
      "orderId",
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 01:27:10.019] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "TEST-20251104012709",
    "externalOrderId": "EXT-TEST-20251104012709",
    "restaurantId": "REST-001",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "email": "john@example.com",
      "address": null
    },
    "orderType": "delivery",
    "orderTime": "2025-11-04T01:27:09Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "ITEM-001",
        "name": "Burger",
        "quantity": 2,
        "unitPrice": 10,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": [
          {
            "name": "Extra Cheese",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "ITEM-002",
        "name": "Fries",
        "quantity": 1,
        "unitPrice": 5.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 25.5,
      "tax": 2.55,
      "tip": 5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 33.05
    },
    "payment": {
      "method": "credit_card",
      "status": "paid",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 01:27:10.021] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "TEST-20251104012709",
    "hasExternalId": true,
    "restaurantId": "REST-001",
    "customerComplete": true,
    "orderType": "delivery",
    "itemCount": 2,
    "totalAmount": 33.05,
    "paymentStatus": "paid",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Burger",
      "quantity": 2,
      "unitPrice": 10,
      "hasModifiers": true,
      "modifierCount": 1
    },
    {
      "index": 1,
      "name": "Fries",
      "quantity": 1,
      "unitPrice": 5.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 25.5,
    "tax": 2.55,
    "tip": 5,
    "total": 33.05,
    "calculatedTotal": 33.05
  }
}
[2025-11-04 01:27:10.022] INFO: Creating enhanced order TEST-20251104012709
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "TEST-20251104012709",
  "externalOrderId": "EXT-TEST-20251104012709",
  "restaurantId": "REST-001",
  "customerEmail": "john@example.com",
  "orderType": "delivery",
  "requestedTime": null,
  "itemCount": 2,
  "total": 33.05,
  "paymentStatus": "paid"
}
[2025-11-04 01:27:10.023] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1332,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"TEST-20251104012709\",\n  \"externalOrderId\": \"EXT-TEST-20251104012709\",\n  \"restaurantId\": \"REST-001\",\n  \"customer\": {\n    \"name\": \"John Doe\",\n    \"phone\": \"+1234567890\",\n    \"email\": \"john@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"delivery\",\n  \"orderTime\": \"2025-11-04T01:27:09Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"ITEM-001\",\n      \"name\": \"Burger\",\n      \"quantity\": 2,\n      \"unitPrice\": 10,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Cheese\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 25.5,\n    \"tax\": 2.55,\n    \"tip\": 5,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 33.05\n  },\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\"... [TRUNCATED]"
}
[2025-11-04 01:27:10.023] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-20251104012709",
  "idempotencyKey": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 33.05
}
[2025-11-04 01:27:10.024] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f"
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:27:10.025] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 01:27:10.026] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "4213055a-8aa8-4e5a-a9a8-e64238ae15d7",
  "publicOrderId": "TEST-20251104012709"
}
[2025-11-04 01:27:10.026] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "4213055a-8aa8-4e5a-a9a8-e64238ae15d7",
  "orderId": "TEST-20251104012709",
  "externalOrderId": "EXT-TEST-20251104012709",
  "customer": {
    "name": "John Doe",
    "phone": "+1234567890",
    "email": "john@example.com",
    "address": null
  },
  "orderType": "delivery",
  "totals": {
    "subtotal": 25.5,
    "tax": 2.55,
    "tip": 5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 33.05
  }
}
[2025-11-04 01:27:10.030] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4213055a-8aa8-4e5a-a9a8-e64238ae15d7",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-20251104012709",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-TEST-20251104012709",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "REST-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Doe",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "+1234567890",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "john@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T01:27:09Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.55,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "paid",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 01:27:10.032] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:27:10.032] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:27:10.032] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4213055a-8aa8-4e5a-a9a8-e64238ae15d7"
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-20251104012709"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-TEST-20251104012709"
    },
    {
      "index": 3,
      "type": "string",
      "value": "REST-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "4989e0f9-de47-45e2-b1d9-31b881ba4b7f"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Doe"
    },
    {
      "index": 6,
      "type": "string",
      "value": "+1234567890"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T01:27:09Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.5
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.55
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "paid"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:27:10.036] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 12,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 01:27:10.036] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '4213055a-8aa8-4e5a-a9a8-e64238ae15d7',\n  'TEST-20251104012709',\n  'EXT-TEST-20251104012709',\n  'REST-001',\n  '4989e0f9-de47-45e2-b1d9-31b881ba4b7f',\n  'John Doe',\n  '+1234567890',\n  'john@example.com',\n  null,\n  'delivery',\n  '2025-11-04T01:27:09Z',\n  null,\n  25.5,\n  2.55,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'paid',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "12ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "TEST-20251104012709",
    "externalOrderId": "EXT-TEST-20251104012709",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 33.05
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 01:27:10.037] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 10,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 25,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 01:27:10.038] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '4213055a-8aa8-4e5a-a9a8-e64238ae15d7',\n  'TEST-20251104012709',\n  'EXT-TEST-20251104012709',\n  'REST-001',\n  '4989e0f9-de47-45e2-b1d9-31b881ba4b7f',\n  'John Doe',\n  '+1234567890',\n  'john@example.com',\n  null,\n  'delivery',\n  '2025-11-04T01:27:09Z',\n  null,\n  25.5,\n  2.55,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'paid',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "25ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "order_type",
      "tax",
      "order_id",
      "order_time",
      "subtotal",
      "customer_name",
      "restaurant_id",
      "payment_status",
      "customer_address",
      "external_order_id",
      "customer_phone",
      "payment_method",
      "customer_email",
      "tip",
      "items",
      "total"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 01:27:10.045] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '4213055a-8aa8-4e5a-a9a8-e64238ae15d7',\n  'TEST-20251104012709',\n  'EXT-TEST-20251104012709',\n  'REST-001',\n  '4989e0f9-de47-45e2-b1d9-31b881ba4b7f',\n  'John Doe',\n  '+1234567890',\n  'john@example.com',\n  null,\n  'delivery',\n  '2025-11-04T01:27:09Z',\n  null,\n  25.5,\n  2.55,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'paid',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "order_type": "delivery",
    "tax": 2.55,
    "order_id": "TEST-20251104012709",
    "order_time": "2025-11-04T01:27:09Z",
    "subtotal": 25.5,
    "customer_name": "John Doe",
    "restaurant_id": "REST-001",
    "payment_status": "paid",
    "customer_address": "123 Main St, City, State 12345",
    "external_order_id": "EXT-TEST-20251104012709",
    "customer_phone": "+1234567890",
    "payment_method": "credit_card",
    "customer_email": "john@example.com",
    "tip": 5,
    "items": [
      {
        "name": "Burger",
        "item_id": "ITEM-001",
        "quantity": 2,
        "price": 10,
        "category": "Main Course",
        "modifiers": [
          {
            "price": 1.5,
            "modifier_id": "MOD-001",
            "name": "Extra Cheese",
            "quantity": 1
          }
        ]
      },
      {
        "price": 5.5,
        "quantity": 1,
        "item_id": "ITEM-002",
        "name": "Fries",
        "category": "Sides"
      }
    ],
    "total": 33.05
  }
}
[2025-11-04 01:29:02.911] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 01:29:02.912] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 01:29:02.915] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1514",
    "connection": "Keep-Alive"
  },
  "query": {},
  "params": {},
  "bodySize": 688,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 01:29:02.916] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 937,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "payload": "{\n  \"order_type\": \"delivery\",\n  \"tax\": 2.55,\n  \"order_id\": \"TEST-20251104012902\",\n  \"order_time\": \"2025-11-04T01:29:02Z\",\n  \"subtotal\": 25.5,\n  \"customer_name\": \"John Doe\",\n  \"restaurant_id\": \"REST-001\",\n  \"payment_status\": \"captured\",\n  \"customer_address\": \"123 Main St, City, State 12345\",\n  \"external_order_id\": \"EXT-TEST-20251104012902\",\n  \"customer_phone\": \"+1234567890\",\n  \"payment_method\": \"credit_card\",\n  \"customer_email\": \"john@example.com\",\n  \"tip\": 5,\n  \"items\": [\n    {\n      \"name\": \"Burger\",\n      \"item_id\": \"ITEM-001\",\n      \"quantity\": 2,\n      \"price\": 10,\n      \"category\": \"Main Course\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"modifier_id\": \"MOD-001\",\n          \"name\": \"Extra Cheese\",\n          \"quantity\": 1\n        }\n      ]\n    },\n    {\n      \"price\": 5.5,\n      \"quantity\": 1,\n      \"item_id\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"category\": \"Sides\"\n    }\n  ],\n  \"total\": 33.05\n}"
}
[2025-11-04 01:29:02.916] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 937,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "payload": "{\n  \"order_type\": \"delivery\",\n  \"tax\": 2.55,\n  \"order_id\": \"TEST-20251104012902\",\n  \"order_time\": \"2025-11-04T01:29:02Z\",\n  \"subtotal\": 25.5,\n  \"customer_name\": \"John Doe\",\n  \"restaurant_id\": \"REST-001\",\n  \"payment_status\": \"captured\",\n  \"customer_address\": \"123 Main St, City, State 12345\",\n  \"external_order_id\": \"EXT-TEST-20251104012902\",\n  \"customer_phone\": \"+1234567890\",\n  \"payment_method\": \"credit_card\",\n  \"customer_email\": \"john@example.com\",\n  \"tip\": 5,\n  \"items\": [\n    {\n      \"name\": \"Burger\",\n      \"item_id\": \"ITEM-001\",\n      \"quantity\": 2,\n      \"price\": 10,\n      \"category\": \"Main Course\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"modifier_id\": \"MOD-001\",\n          \"name\": \"Extra Cheese\",\n          \"quantity\": 1\n        }\n      ]\n    },\n    {\n      \"price\": 5.5,\n      \"quantity\": 1,\n      \"item_id\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"category\": \"Sides\"\n    }\n  ],\n  \"total\": 33.05\n}"
}
[2025-11-04 01:29:02.917] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "885a7c9d-d0de-434a-8ae1-216785f42b5d"
}
[2025-11-04 01:29:02.917] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": false,
  "hasCustomer": false,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ]
}
[2025-11-04 01:29:02.917] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "order_type": "delivery",
    "tax": 2.55,
    "order_id": "TEST-20251104012902",
    "order_time": "2025-11-04T01:29:02Z",
    "subtotal": 25.5,
    "customer_name": "John Doe",
    "restaurant_id": "REST-001",
    "payment_status": "captured",
    "customer_address": "123 Main St, City, State 12345",
    "external_order_id": "EXT-TEST-20251104012902",
    "customer_phone": "+1234567890",
    "payment_method": "credit_card",
    "customer_email": "john@example.com",
    "tip": 5,
    "items": [
      {
        "name": "Burger",
        "item_id": "ITEM-001",
        "quantity": 2,
        "price": 10,
        "category": "Main Course",
        "modifiers": [
          {
            "price": 1.5,
            "modifier_id": "MOD-001",
            "name": "Extra Cheese",
            "quantity": 1
          }
        ]
      },
      {
        "price": 5.5,
        "quantity": 1,
        "item_id": "ITEM-002",
        "name": "Fries",
        "category": "Sides"
      }
    ],
    "total": 33.05
  }
}
[2025-11-04 01:29:02.918] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "hasOrderId": true,
  "hasCustomer": false,
  "hasItems": true
}
[2025-11-04 01:29:02.918] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "order_type",
    "tax",
    "order_id",
    "order_time",
    "subtotal",
    "customer_name",
    "restaurant_id",
    "payment_status",
    "customer_address",
    "external_order_id",
    "customer_phone",
    "payment_method",
    "customer_email",
    "tip",
    "items",
    "total"
  ],
  "beforeSample": "{\"order_type\":\"delivery\",\"tax\":2.55,\"order_id\":\"TEST-20251104012902\",\"order_time\":\"2025-11-04T01:29:02Z\",\"subtotal\":25.5,\"customer_name\":\"John Doe\",\"restaurant_id\":\"REST-001\",\"payment_status\":\"capture...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"TEST-20251104012902\",\"externalOrderId\":\"EXT-TEST-20251104012902\",\"restaurantId\":\"REST-001\",\"customer\":{\"name\":\"John Doe\",\"phone\":\"+1234567890\",\"email\":\"john@example.com\",\"address\":null},\"o...",
  "transformationDetails": {
    "fieldsGenerated": [
      "orderId",
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 01:29:02.918] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "TEST-20251104012902",
    "externalOrderId": "EXT-TEST-20251104012902",
    "restaurantId": "REST-001",
    "customer": {
      "name": "John Doe",
      "phone": "+1234567890",
      "email": "john@example.com",
      "address": null
    },
    "orderType": "delivery",
    "orderTime": "2025-11-04T01:29:02Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "ITEM-001",
        "name": "Burger",
        "quantity": 2,
        "unitPrice": 10,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": [
          {
            "name": "Extra Cheese",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "ITEM-002",
        "name": "Fries",
        "quantity": 1,
        "unitPrice": 5.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 25.5,
      "tax": 2.55,
      "tip": 5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 33.05
    },
    "payment": {
      "method": "credit_card",
      "status": "captured",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 01:29:02.919] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "TEST-20251104012902",
    "hasExternalId": true,
    "restaurantId": "REST-001",
    "customerComplete": true,
    "orderType": "delivery",
    "itemCount": 2,
    "totalAmount": 33.05,
    "paymentStatus": "captured",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Burger",
      "quantity": 2,
      "unitPrice": 10,
      "hasModifiers": true,
      "modifierCount": 1
    },
    {
      "index": 1,
      "name": "Fries",
      "quantity": 1,
      "unitPrice": 5.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 25.5,
    "tax": 2.55,
    "tip": 5,
    "total": 33.05,
    "calculatedTotal": 33.05
  }
}
[2025-11-04 01:29:02.919] INFO: Creating enhanced order TEST-20251104012902
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "TEST-20251104012902",
  "externalOrderId": "EXT-TEST-20251104012902",
  "restaurantId": "REST-001",
  "customerEmail": "john@example.com",
  "orderType": "delivery",
  "requestedTime": null,
  "itemCount": 2,
  "total": 33.05,
  "paymentStatus": "captured"
}
[2025-11-04 01:29:02.920] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1336,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"TEST-20251104012902\",\n  \"externalOrderId\": \"EXT-TEST-20251104012902\",\n  \"restaurantId\": \"REST-001\",\n  \"customer\": {\n    \"name\": \"John Doe\",\n    \"phone\": \"+1234567890\",\n    \"email\": \"john@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"delivery\",\n  \"orderTime\": \"2025-11-04T01:29:02Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"ITEM-001\",\n      \"name\": \"Burger\",\n      \"quantity\": 2,\n      \"unitPrice\": 10,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Cheese\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"ITEM-002\",\n      \"name\": \"Fries\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 25.5,\n    \"tax\": 2.55,\n    \"tip\": 5,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 33.05\n  },\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\"... [TRUNCATED]"
}
[2025-11-04 01:29:02.920] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-20251104012902",
  "idempotencyKey": "885a7c9d-d0de-434a-8ae1-216785f42b5d",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 33.05
}
[2025-11-04 01:29:02.920] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "885a7c9d-d0de-434a-8ae1-216785f42b5d"
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:29:02.921] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "885a7c9d-d0de-434a-8ae1-216785f42b5d"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 01:29:02.921] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "054f25f2-0d90-4be5-92c7-e4ff27ace2df",
  "publicOrderId": "TEST-20251104012902"
}
[2025-11-04 01:29:02.922] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "054f25f2-0d90-4be5-92c7-e4ff27ace2df",
  "orderId": "TEST-20251104012902",
  "externalOrderId": "EXT-TEST-20251104012902",
  "customer": {
    "name": "John Doe",
    "phone": "+1234567890",
    "email": "john@example.com",
    "address": null
  },
  "orderType": "delivery",
  "totals": {
    "subtotal": 25.5,
    "tax": 2.55,
    "tip": 5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 33.05
  }
}
[2025-11-04 01:29:02.923] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-20251104012902",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-TEST-20251104012902",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "REST-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "885a7c9d-d0de-434a-8ae1-216785f42b5d",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Doe",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "+1234567890",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "john@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T01:29:02Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.55,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "captured",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 01:29:02.925] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:02.925] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:02.926] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-20251104012902"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-TEST-20251104012902"
    },
    {
      "index": 3,
      "type": "string",
      "value": "REST-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "885a7c9d-d0de-434a-8ae1-216785f42b5d"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Doe"
    },
    {
      "index": 6,
      "type": "string",
      "value": "+1234567890"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T01:29:02Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.5
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.55
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "captured"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:29:02.967] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-20251104012902"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-TEST-20251104012902"
    },
    {
      "index": 3,
      "type": "string",
      "value": "REST-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "885a7c9d-d0de-434a-8ae1-216785f42b5d"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Doe"
    },
    {
      "index": 6,
      "type": "string",
      "value": "+1234567890"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T01:29:02Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.5
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.55
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "captured"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 2
  }
}
[2025-11-04 01:29:02.967] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "054f25f2-0d90-4be5-92c7-e4ff27ace2df",
  "orderId": "TEST-20251104012902",
  "changes": 1,
  "lastID": 2
}
[2025-11-04 01:29:02.967] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:02.968] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 2,
  "items": [
    {
      "index": 0,
      "name": "Burger",
      "quantity": 2,
      "unitPrice": 10,
      "hasModifiers": true,
      "modifierCount": 1
    },
    {
      "index": 1,
      "name": "Fries",
      "quantity": 1,
      "unitPrice": 5.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 01:29:02.968] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2e90d6ae-8c91-433a-b047-dbae24854393"
    },
    {
      "index": 1,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Burger"
    },
    {
      "index": 4,
      "type": "number",
      "value": 2
    },
    {
      "index": 5,
      "type": "number",
      "value": 10
    },
    {
      "index": 6,
      "type": "number",
      "value": 0
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:29:03.011] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2e90d6ae-8c91-433a-b047-dbae24854393"
    },
    {
      "index": 1,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Burger"
    },
    {
      "index": 4,
      "type": "number",
      "value": 2
    },
    {
      "index": 5,
      "type": "number",
      "value": 10
    },
    {
      "index": 6,
      "type": "number",
      "value": 0
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 3
  }
}
[2025-11-04 01:29:03.011] DEBUG: üè∑Ô∏è Processing 1 modifiers for item Burger
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:03.012] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Modifier 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_item_modifiers ( id, order_item_id, modifier_id, name, price, quantity, created_at ) VALUES (?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 6,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d1c0ee94-1049-4da2-a675-6ac10e1b9643"
    },
    {
      "index": 1,
      "type": "string",
      "value": "2e90d6ae-8c91-433a-b047-dbae24854393"
    },
    {
      "index": 2,
      "type": "object",
      "value": null
    },
    {
      "index": 3,
      "type": "string",
      "value": "Extra Cheese"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1.5
    },
    {
      "index": 5,
      "type": "number",
      "value": 1
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:29:03.049] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Modifier 1 Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_item_modifiers ( id, order_item_id, modifier_id, name, price, quantity, created_at ) VALUES (?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 6,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d1c0ee94-1049-4da2-a675-6ac10e1b9643"
    },
    {
      "index": 1,
      "type": "string",
      "value": "2e90d6ae-8c91-433a-b047-dbae24854393"
    },
    {
      "index": 2,
      "type": "object",
      "value": null
    },
    {
      "index": 3,
      "type": "string",
      "value": "Extra Cheese"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1.5
    },
    {
      "index": 5,
      "type": "number",
      "value": 1
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 2
  }
}
[2025-11-04 01:29:03.049] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 2 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "9fc8a5d6-2237-4d7c-afce-04d43de64a7d"
    },
    {
      "index": 1,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-002"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Fries"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 5.5
    },
    {
      "index": 6,
      "type": "number",
      "value": 0
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 01:29:03.090] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 2 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "9fc8a5d6-2237-4d7c-afce-04d43de64a7d"
    },
    {
      "index": 1,
      "type": "string",
      "value": "054f25f2-0d90-4be5-92c7-e4ff27ace2df"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-002"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Fries"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 5.5
    },
    {
      "index": 6,
      "type": "number",
      "value": 0
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 4
  }
}
[2025-11-04 01:29:03.090] INFO: Inserted 2 items for order TEST-20251104012902
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:03.091] INFO: Order created successfully: TEST-20251104012902
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:29:03.097] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 47,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 170,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 171,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 177,
      "error": null
    }
  ]
}
[2025-11-04 01:29:03.098] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-20251104012902",
  "totalServiceTime": "177ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "TEST-20251104012902",
    "itemCount": 2,
    "totalAmount": 33.05,
    "status": "received"
  }
}
[2025-11-04 01:29:03.098] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 183,
      "error": null
    }
  ]
}
[2025-11-04 01:29:03.098] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-20251104012902",
  "totalProcessingTime": "183ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 2,
    "totalAmount": 33.05,
    "status": "received"
  }
}
[2025-11-04 01:30:30.477] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 01:30:30.478] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.699] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.715] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.729] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.748] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.750] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.751] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.752] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.753] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.754] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.757] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.758] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.759] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.761] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.762] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.763] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.765] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.767] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.768] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.769] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.770] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.774] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.777] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.778] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.795] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.796] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.797] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.798] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:29:40.798] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:30:18.685] INFO: GET /api/v1/logs
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:30:18.687] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:31:00.239] INFO: GET /api/v1/logs/files
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:31:00.241] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/files"
}
[2025-11-04 05:31:18.289] INFO: GET /api/v1/logs/combined.log
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:31:18.292] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/combined.log"
}
[2025-11-04 05:31:22.885] INFO: GET /api/v1/logs/
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:31:22.887] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:31:43.627] INFO: GET /api/v1/logs/files
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:31:43.630] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/files"
}
[2025-11-04 05:31:55.852] INFO: GET /logs/combined.log
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:41:40.217] INFO: GET /health
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:41:51.066] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:51.080] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.075] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.086] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.130] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.133] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.136] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.180] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.199] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.231] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.249] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.272] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.300] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.351] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.381] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.389] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.401] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.418] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.437] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.441] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.468] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.491] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.506] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.515] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.520] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.570] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.588] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.601] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.606] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:41:59.620] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:42:05.480] INFO: GET /api/v1/logs/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:42:05.492] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/orders",
  "apiKeyPrefix": "dev-api-...",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:42:31.443] INFO: GET /api/v1/logs/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:42:31.455] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/orders"
}
[2025-11-04 05:45:05.254] INFO: GET /api/v1/logs/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:45:05.255] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/orders"
}
[2025-11-04 05:45:21.785] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:45:21.788] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 05:45:43.292] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:43.295] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.813] INFO: üîí Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.826] INFO: üîÑ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.856] INFO: üóÑÔ∏è Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.928] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.955] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:46.992] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.033] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.035] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.083] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.096] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.117] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.151] INFO: ‚ö†Ô∏è Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.167] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.212] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.214] INFO: ‚úÖ Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.244] INFO: üìã Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.251] INFO: üéâ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.290] INFO: üß™ Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.306] INFO: ‚úÖ All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.316] INFO: ‚úÖ order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.319] INFO: ‚úÖ All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.332] INFO: üéØ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.335] INFO: ‚úÖ Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.365] INFO: üöÄ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.367] INFO: üìñ API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.373] INFO: üíì Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.378] INFO: üåç Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:45:47.394] INFO: üé£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:48:54.232] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:48:54.236] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads",
  "apiKeyPrefix": "dev-api-...",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:49:10.108] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:49:10.121] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 05:52:04.186] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:52:04.192] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:52:04.203] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1910",
    "connection": "Keep-Alive"
  },
  "query": {},
  "params": {},
  "bodySize": 823,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:52:04.205] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1127,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 18.88,\n    \"tax\": 1.4,\n    \"tip\": 0\n  },\n  \"requestedTime\": \"2025-11-04T06:22:04Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"notes\": \"Please call when ready\",\n  \"items\": [\n    {\n      \"name\": \"Turkey Club Sandwich\",\n      \"itemId\": \"SANDWICH-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"name\": \"Extra Cheese\"\n        }\n      ],\n      \"totalPrice\": 12.99\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\",\n      \"itemId\": \"DRINK-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"orderTime\": \"2025-11-04T05:52:04Z\",\n  \"payment\": {\n    \"transactionId\": \"TXN-... [TRUNCATED]"
}
[2025-11-04 05:52:04.206] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1127,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 18.88,\n    \"tax\": 1.4,\n    \"tip\": 0\n  },\n  \"requestedTime\": \"2025-11-04T06:22:04Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"notes\": \"Please call when ready\",\n  \"items\": [\n    {\n      \"name\": \"Turkey Club Sandwich\",\n      \"itemId\": \"SANDWICH-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"name\": \"Extra Cheese\"\n        }\n      ],\n      \"totalPrice\": 12.99\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\",\n      \"itemId\": \"DRINK-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"orderTime\": \"2025-11-04T05:52:04Z\",\n  \"payment\": {\n    \"transactionId\": \"TXN-... [TRUNCATED]"
}
[2025-11-04 05:52:04.218] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85"
}
[2025-11-04 05:52:04.218] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:52:04.219] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 17.48,
      "deliveryFee": 0,
      "discount": 0,
      "total": 18.88,
      "tax": 1.4,
      "tip": 0
    },
    "requestedTime": "2025-11-04T06:22:04Z",
    "orderType": "pickup",
    "restaurantId": "NYC-DELI-001",
    "status": "received",
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "notes": "Please call when ready",
    "items": [
      {
        "name": "Turkey Club Sandwich",
        "itemId": "SANDWICH-001",
        "quantity": 1,
        "unitPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "price": 1.5,
            "name": "Extra Cheese"
          }
        ],
        "totalPrice": 12.99
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea",
        "itemId": "DRINK-001"
      }
    ],
    "externalOrderId": "EXT-PICKUP-001",
    "orderTime": "2025-11-04T05:52:04Z",
    "payment": {
      "transactionId": "TXN-9194",
      "method": "credit_card",
      "amount": 18.88,
      "status": "completed"
    },
    "orderId": "ORD-20251104055204-001"
  }
}
[2025-11-04 05:52:04.256] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:52:04.257] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":17.48,\"deliveryFee\":0,\"discount\":0,\"total\":18.88,\"tax\":1.4,\"tip\":0},\"requestedTime\":\"2025-11-04T06:22:04Z\",\"orderType\":\"pickup\",\"restaurantId\":\"NYC-DELI-001\",\"status\":\"received\",...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055204-001\",\"externalOrderId\":\"EXT-PICKUP-001\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"John Smith\",\"phone\":\"555-0101\",\"email\":\"john.smith@example.com\",\"address\":null}...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:52:04.258] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055204-001",
    "externalOrderId": "EXT-PICKUP-001",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "John Smith",
      "phone": "555-0101",
      "email": "john.smith@example.com",
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:52:04Z",
    "requestedTime": "2025-11-04T06:22:04Z",
    "items": [
      {
        "itemId": "SANDWICH-001",
        "name": "Turkey Club Sandwich",
        "quantity": 1,
        "unitPrice": 12.99,
        "totalPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "name": "Extra Cheese",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "DRINK-001",
        "name": "Iced Tea",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 17.48,
      "tax": 1.4,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 18.88
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": "TXN-9194",
      "amount": 18.88
    },
    "notes": "Please call when ready",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:52:04.259] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055204-001",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 18.88,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Turkey Club Sandwich",
      "quantity": 1,
      "unitPrice": 12.99,
      "hasModifiers": true,
      "modifierCount": 1
    },
    {
      "index": 1,
      "name": "Iced Tea",
      "quantity": 1,
      "unitPrice": 2.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 17.48,
    "tax": 1.4,
    "tip": 0,
    "total": 18.88,
    "calculatedTotal": 18.88
  }
}
[2025-11-04 05:52:04.259] INFO: Creating enhanced order ORD-20251104055204-001
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055204-001",
  "externalOrderId": "EXT-PICKUP-001",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": "john.smith@example.com",
  "orderType": "pickup",
  "requestedTime": "2025-11-04T06:22:04Z",
  "itemCount": 2,
  "total": 18.88,
  "paymentStatus": "completed"
}
[2025-11-04 05:52:04.260] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1441,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055204-001\",\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\",\n    \"email\": \"john.smith@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:52:04Z\",\n  \"requestedTime\": \"2025-11-04T06:22:04Z\",\n  \"items\": [\n    {\n      \"itemId\": \"SANDWICH-001\",\n      \"name\": \"Turkey Club Sandwich\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"totalPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Cheese\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"DRINK-001\",\n      \"name\": \"Iced Tea\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"tax\": 1.4,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"tot... [TRUNCATED]"
}
[2025-11-04 05:52:04.261] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055204-001",
  "idempotencyKey": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 18.88
}
[2025-11-04 05:52:04.261] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:04.267] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:52:04.267] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "59222e08-da24-478c-a427-5622be954d6e",
  "publicOrderId": "ORD-20251104055204-001"
}
[2025-11-04 05:52:04.268] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "59222e08-da24-478c-a427-5622be954d6e",
  "orderId": "ORD-20251104055204-001",
  "externalOrderId": "EXT-PICKUP-001",
  "customer": {
    "name": "John Smith",
    "phone": "555-0101",
    "email": "john.smith@example.com",
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 17.48,
    "tax": 1.4,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 18.88
  }
}
[2025-11-04 05:52:04.269] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "59222e08-da24-478c-a427-5622be954d6e",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055204-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-PICKUP-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:04Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:22:04Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 17.48,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.4,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 18.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-9194",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 18.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:52:04.270] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:04.270] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:04.270] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "59222e08-da24-478c-a427-5622be954d6e"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055204-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-PICKUP-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "a7f70f22-4d1c-40a7-a9a2-71fb91186e85"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:04Z"
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:22:04Z"
    },
    {
      "index": 12,
      "type": "number",
      "value": 17.48
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.4
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 18.88
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-9194"
    },
    {
      "index": 21,
      "type": "number",
      "value": 18.88
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:04.278] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 8,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 17,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:52:04.279] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '59222e08-da24-478c-a427-5622be954d6e',\n  'ORD-20251104055204-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  'a7f70f22-4d1c-40a7-a9a2-71fb91186e85',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:04Z',\n  '2025-11-04T06:22:04Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-9194',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "17ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055204-001",
    "externalOrderId": "EXT-PICKUP-001",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 18.88
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:52:04.282] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 8,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 9,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 21,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 60,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 62,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 85,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:52:04.284] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '59222e08-da24-478c-a427-5622be954d6e',\n  'ORD-20251104055204-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  'a7f70f22-4d1c-40a7-a9a2-71fb91186e85',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:04Z',\n  '2025-11-04T06:22:04Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-9194',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "85ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "requestedTime",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:52:04.287] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '59222e08-da24-478c-a427-5622be954d6e',\n  'ORD-20251104055204-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  'a7f70f22-4d1c-40a7-a9a2-71fb91186e85',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:04Z',\n  '2025-11-04T06:22:04Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-9194',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 17.48,
      "deliveryFee": 0,
      "discount": 0,
      "total": 18.88,
      "tax": 1.4,
      "tip": 0
    },
    "requestedTime": "2025-11-04T06:22:04Z",
    "orderType": "pickup",
    "restaurantId": "NYC-DELI-001",
    "status": "received",
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "notes": "Please call when ready",
    "items": [
      {
        "name": "Turkey Club Sandwich",
        "itemId": "SANDWICH-001",
        "quantity": 1,
        "unitPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "price": 1.5,
            "name": "Extra Cheese"
          }
        ],
        "totalPrice": 12.99
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea",
        "itemId": "DRINK-001"
      }
    ],
    "externalOrderId": "EXT-PICKUP-001",
    "orderTime": "2025-11-04T05:52:04Z",
    "payment": {
      "transactionId": "TXN-9194",
      "method": "credit_card",
      "amount": 18.88,
      "status": "completed"
    },
    "orderId": "ORD-20251104055204-001"
  }
}
[2025-11-04 05:52:05.322] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:52:05.327] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:52:05.329] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "2330"
  },
  "query": {},
  "params": {},
  "bodySize": 901,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:52:05.330] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1293,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 29.46,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 36.82,\n    \"tax\": 2.36,\n    \"tip\": 5\n  },\n  \"orderType\": \"dine_in\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"mchen@example.com\",\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"notes\": \"Table 15\",\n  \"items\": [\n    {\n      \"name\": \"Classic Cheeseburger\",\n      \"itemId\": \"BURGER-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"price\": 2,\n          \"name\": \"Extra Bacon\"\n        },\n        {\n          \"price\": 1.5,\n          \"name\": \"Avocado\"\n        }\n      ],\n      \"totalPrice\": 14.99\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\",\n      \"itemId\": \"SIDES-001\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milk... [TRUNCATED]"
}
[2025-11-04 05:52:05.335] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1293,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 29.46,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 36.82,\n    \"tax\": 2.36,\n    \"tip\": 5\n  },\n  \"orderType\": \"dine_in\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"mchen@example.com\",\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"notes\": \"Table 15\",\n  \"items\": [\n    {\n      \"name\": \"Classic Cheeseburger\",\n      \"itemId\": \"BURGER-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"price\": 2,\n          \"name\": \"Extra Bacon\"\n        },\n        {\n          \"price\": 1.5,\n          \"name\": \"Avocado\"\n        }\n      ],\n      \"totalPrice\": 14.99\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\",\n      \"itemId\": \"SIDES-001\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milk... [TRUNCATED]"
}
[2025-11-04 05:52:05.336] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "06f14f36-de0d-4d0a-8db6-89cfad194640"
}
[2025-11-04 05:52:05.337] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:52:05.337] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 29.46,
      "deliveryFee": 0,
      "discount": 0,
      "total": 36.82,
      "tax": 2.36,
      "tip": 5
    },
    "orderType": "dine_in",
    "restaurantId": "NYC-BURGER-001",
    "status": "received",
    "customer": {
      "email": "mchen@example.com",
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "notes": "Table 15",
    "items": [
      {
        "name": "Classic Cheeseburger",
        "itemId": "BURGER-001",
        "quantity": 1,
        "unitPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "price": 2,
            "name": "Extra Bacon"
          },
          {
            "price": 1.5,
            "name": "Avocado"
          }
        ],
        "totalPrice": 14.99
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries",
        "itemId": "SIDES-001"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake",
        "itemId": "SHAKE-001"
      }
    ],
    "externalOrderId": "EXT-DINEIN-003",
    "orderTime": "2025-11-04T05:52:05Z",
    "payment": {
      "transactionId": "TXN-7492",
      "method": "credit_card",
      "amount": 36.82,
      "status": "completed"
    },
    "orderId": "ORD-20251104055205-003"
  }
}
[2025-11-04 05:52:05.354] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:52:05.355] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":29.46,\"deliveryFee\":0,\"discount\":0,\"total\":36.82,\"tax\":2.36,\"tip\":5},\"orderType\":\"dine_in\",\"restaurantId\":\"NYC-BURGER-001\",\"status\":\"received\",\"customer\":{\"email\":\"mchen@example....",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055205-003\",\"externalOrderId\":\"EXT-DINEIN-003\",\"restaurantId\":\"NYC-BURGER-001\",\"customer\":{\"name\":\"Michael Chen\",\"phone\":\"555-0303\",\"email\":\"mchen@example.com\",\"address\":null},...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:52:05.356] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055205-003",
    "externalOrderId": "EXT-DINEIN-003",
    "restaurantId": "NYC-BURGER-001",
    "customer": {
      "name": "Michael Chen",
      "phone": "555-0303",
      "email": "mchen@example.com",
      "address": null
    },
    "orderType": "dine_in",
    "orderTime": "2025-11-04T05:52:05Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "BURGER-001",
        "name": "Classic Cheeseburger",
        "quantity": 1,
        "unitPrice": 14.99,
        "totalPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "name": "Extra Bacon",
            "price": 2
          },
          {
            "name": "Avocado",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "SIDES-001",
        "name": "French Fries",
        "quantity": 1,
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "SHAKE-001",
        "name": "Chocolate Milkshake",
        "quantity": 1,
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 29.46,
      "tax": 2.36,
      "tip": 5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 36.82
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": "TXN-7492",
      "amount": 36.82
    },
    "notes": "Table 15",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:52:05.357] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055205-003",
    "hasExternalId": true,
    "restaurantId": "NYC-BURGER-001",
    "customerComplete": true,
    "orderType": "dine_in",
    "itemCount": 3,
    "totalAmount": 36.82,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Classic Cheeseburger",
      "quantity": 1,
      "unitPrice": 14.99,
      "hasModifiers": true,
      "modifierCount": 2
    },
    {
      "index": 1,
      "name": "French Fries",
      "quantity": 1,
      "unitPrice": 4.99,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 2,
      "name": "Chocolate Milkshake",
      "quantity": 1,
      "unitPrice": 5.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 29.46,
    "tax": 2.36,
    "tip": 5,
    "total": 36.82,
    "calculatedTotal": 36.82
  }
}
[2025-11-04 05:52:05.357] INFO: Creating enhanced order ORD-20251104055205-003
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055205-003",
  "externalOrderId": "EXT-DINEIN-003",
  "restaurantId": "NYC-BURGER-001",
  "customerEmail": "mchen@example.com",
  "orderType": "dine_in",
  "requestedTime": null,
  "itemCount": 3,
  "total": 36.82,
  "paymentStatus": "completed"
}
[2025-11-04 05:52:05.358] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1690,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055205-003\",\n  \"externalOrderId\": \"EXT-DINEIN-003\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"customer\": {\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\",\n    \"email\": \"mchen@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"dine_in\",\n  \"orderTime\": \"2025-11-04T05:52:05Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"BURGER-001\",\n      \"name\": \"Classic Cheeseburger\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"totalPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Bacon\",\n          \"price\": 2\n        },\n        {\n          \"name\": \"Avocado\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"SIDES-001\",\n      \"name\": \"French Fries\",\n      \"quantity\": 1,\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": \"SHAKE-001\",\n      \"name\": \"Chocolate Milksh... [TRUNCATED]"
}
[2025-11-04 05:52:05.358] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055205-003",
  "idempotencyKey": "06f14f36-de0d-4d0a-8db6-89cfad194640",
  "hasCustomer": true,
  "itemCount": 3,
  "totalAmount": 36.82
}
[2025-11-04 05:52:05.358] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "06f14f36-de0d-4d0a-8db6-89cfad194640"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:05.359] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "06f14f36-de0d-4d0a-8db6-89cfad194640"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:52:05.360] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "98d845fe-0627-4a41-b9c3-ec9c337e2f7b",
  "publicOrderId": "ORD-20251104055205-003"
}
[2025-11-04 05:52:05.360] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "98d845fe-0627-4a41-b9c3-ec9c337e2f7b",
  "orderId": "ORD-20251104055205-003",
  "externalOrderId": "EXT-DINEIN-003",
  "customer": {
    "name": "Michael Chen",
    "phone": "555-0303",
    "email": "mchen@example.com",
    "address": null
  },
  "orderType": "dine_in",
  "totals": {
    "subtotal": 29.46,
    "tax": 2.36,
    "tip": 5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 36.82
  }
}
[2025-11-04 05:52:05.360] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "98d845fe-0627-4a41-b9c3-ec9c337e2f7b",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055205-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-DINEIN-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-BURGER-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "06f14f36-de0d-4d0a-8db6-89cfad194640",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "mchen@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine_in",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:05Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 29.46,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.36,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 36.82,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-7492",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 36.82,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:52:05.362] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:05.362] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:05.363] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "98d845fe-0627-4a41-b9c3-ec9c337e2f7b"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055205-003"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-DINEIN-003"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-BURGER-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "06f14f36-de0d-4d0a-8db6-89cfad194640"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303"
    },
    {
      "index": 7,
      "type": "string",
      "value": "mchen@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine_in"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:05Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 29.46
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.36
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 36.82
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-7492"
    },
    {
      "index": 21,
      "type": "number",
      "value": 36.82
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:05.367] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 9,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')"
    }
  ]
}
[2025-11-04 05:52:05.367] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')\n--> in Statement#run([\n  '98d845fe-0627-4a41-b9c3-ec9c337e2f7b',\n  'ORD-20251104055205-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '06f14f36-de0d-4d0a-8db6-89cfad194640',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine_in',\n  '2025-11-04T05:52:05Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-7492',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "9ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055205-003",
    "externalOrderId": "EXT-DINEIN-003",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 3,
    "hasTotals": true,
    "totalAmount": 36.82
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:52:05.370] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 8,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 26,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 29,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 40,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')"
    }
  ]
}
[2025-11-04 05:52:05.370] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')\n--> in Statement#run([\n  '98d845fe-0627-4a41-b9c3-ec9c337e2f7b',\n  'ORD-20251104055205-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '06f14f36-de0d-4d0a-8db6-89cfad194640',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine_in',\n  '2025-11-04T05:52:05Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-7492',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "40ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:52:05.371] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: order_type IN ('pickup', 'delivery', 'dine-in')\n--> in Statement#run([\n  '98d845fe-0627-4a41-b9c3-ec9c337e2f7b',\n  'ORD-20251104055205-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '06f14f36-de0d-4d0a-8db6-89cfad194640',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine_in',\n  '2025-11-04T05:52:05Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-7492',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 29.46,
      "deliveryFee": 0,
      "discount": 0,
      "total": 36.82,
      "tax": 2.36,
      "tip": 5
    },
    "orderType": "dine_in",
    "restaurantId": "NYC-BURGER-001",
    "status": "received",
    "customer": {
      "email": "mchen@example.com",
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "notes": "Table 15",
    "items": [
      {
        "name": "Classic Cheeseburger",
        "itemId": "BURGER-001",
        "quantity": 1,
        "unitPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "price": 2,
            "name": "Extra Bacon"
          },
          {
            "price": 1.5,
            "name": "Avocado"
          }
        ],
        "totalPrice": 14.99
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries",
        "itemId": "SIDES-001"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake",
        "itemId": "SHAKE-001"
      }
    ],
    "externalOrderId": "EXT-DINEIN-003",
    "orderTime": "2025-11-04T05:52:05Z",
    "payment": {
      "transactionId": "TXN-7492",
      "method": "credit_card",
      "amount": 36.82,
      "status": "completed"
    },
    "orderId": "ORD-20251104055205-003"
  }
}
[2025-11-04 05:52:06.395] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:52:06.397] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:52:06.398] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "2035"
  },
  "query": {},
  "params": {},
  "bodySize": 794,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:52:06.403] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1132,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 13.09,\n    \"tax\": 0.86,\n    \"tip\": 1.5\n  },\n  \"requestedTime\": \"2025-11-04T06:07:06Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"emma.w@example.com\",\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"notes\": \"Name: Emma\",\n  \"items\": [\n    {\n      \"name\": \"Large Latte\",\n      \"itemId\": \"COFFEE-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"modifiers\": [\n        {\n          \"price\": 0.75,\n          \"name\": \"Extra Shot\"\n        },\n        {\n          \"price\": 0.5,\n          \"name\": \"Oat Milk\"\n        }\n      ],\n      \"totalPrice\": 5.49\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\",\n      \"itemId\": \"PASTRY-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"orderTime\": \"2025-11-04T05:52:06Z\",\n  \"payment\": {\n    \"transactionId\": \"TX... [TRUNCATED]"
}
[2025-11-04 05:52:06.405] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1132,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 13.09,\n    \"tax\": 0.86,\n    \"tip\": 1.5\n  },\n  \"requestedTime\": \"2025-11-04T06:07:06Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"emma.w@example.com\",\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"notes\": \"Name: Emma\",\n  \"items\": [\n    {\n      \"name\": \"Large Latte\",\n      \"itemId\": \"COFFEE-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"modifiers\": [\n        {\n          \"price\": 0.75,\n          \"name\": \"Extra Shot\"\n        },\n        {\n          \"price\": 0.5,\n          \"name\": \"Oat Milk\"\n        }\n      ],\n      \"totalPrice\": 5.49\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\",\n      \"itemId\": \"PASTRY-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"orderTime\": \"2025-11-04T05:52:06Z\",\n  \"payment\": {\n    \"transactionId\": \"TX... [TRUNCATED]"
}
[2025-11-04 05:52:06.411] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "d7c317a5-6af6-4256-9906-0dc053880853"
}
[2025-11-04 05:52:06.411] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:52:06.412] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 10.73,
      "deliveryFee": 0,
      "discount": 0,
      "total": 13.09,
      "tax": 0.86,
      "tip": 1.5
    },
    "requestedTime": "2025-11-04T06:07:06Z",
    "orderType": "pickup",
    "restaurantId": "NYC-CAFE-001",
    "status": "received",
    "customer": {
      "email": "emma.w@example.com",
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "notes": "Name: Emma",
    "items": [
      {
        "name": "Large Latte",
        "itemId": "COFFEE-001",
        "quantity": 1,
        "unitPrice": 5.49,
        "modifiers": [
          {
            "price": 0.75,
            "name": "Extra Shot"
          },
          {
            "price": 0.5,
            "name": "Oat Milk"
          }
        ],
        "totalPrice": 5.49
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin",
        "itemId": "PASTRY-001"
      }
    ],
    "externalOrderId": "EXT-COFFEE-005",
    "orderTime": "2025-11-04T05:52:06Z",
    "payment": {
      "transactionId": "TXN-8362",
      "method": "mobile_payment",
      "amount": 13.09,
      "status": "completed"
    },
    "orderId": "ORD-20251104055206-005"
  }
}
[2025-11-04 05:52:06.412] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:52:06.413] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":10.73,\"deliveryFee\":0,\"discount\":0,\"total\":13.09,\"tax\":0.86,\"tip\":1.5},\"requestedTime\":\"2025-11-04T06:07:06Z\",\"orderType\":\"pickup\",\"restaurantId\":\"NYC-CAFE-001\",\"status\":\"receive...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055206-005\",\"externalOrderId\":\"EXT-COFFEE-005\",\"restaurantId\":\"NYC-CAFE-001\",\"customer\":{\"name\":\"Emma Wilson\",\"phone\":\"555-0505\",\"email\":\"emma.w@example.com\",\"address\":null},\"o...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:52:06.413] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055206-005",
    "externalOrderId": "EXT-COFFEE-005",
    "restaurantId": "NYC-CAFE-001",
    "customer": {
      "name": "Emma Wilson",
      "phone": "555-0505",
      "email": "emma.w@example.com",
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:52:06Z",
    "requestedTime": "2025-11-04T06:07:06Z",
    "items": [
      {
        "itemId": "COFFEE-001",
        "name": "Large Latte",
        "quantity": 1,
        "unitPrice": 5.49,
        "totalPrice": 5.49,
        "specialInstructions": null,
        "modifiers": [
          {
            "name": "Extra Shot",
            "price": 0.75
          },
          {
            "name": "Oat Milk",
            "price": 0.5
          }
        ]
      },
      {
        "itemId": "PASTRY-001",
        "name": "Blueberry Muffin",
        "quantity": 1,
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 10.73,
      "tax": 0.86,
      "tip": 1.5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 13.09
    },
    "payment": {
      "method": "mobile_payment",
      "status": "completed",
      "transactionId": "TXN-8362",
      "amount": 13.09
    },
    "notes": "Name: Emma",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:52:06.414] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055206-005",
    "hasExternalId": true,
    "restaurantId": "NYC-CAFE-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 13.09,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Large Latte",
      "quantity": 1,
      "unitPrice": 5.49,
      "hasModifiers": true,
      "modifierCount": 2
    },
    {
      "index": 1,
      "name": "Blueberry Muffin",
      "quantity": 1,
      "unitPrice": 3.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 10.73,
    "tax": 0.86,
    "tip": 1.5,
    "total": 13.09,
    "calculatedTotal": 13.09
  }
}
[2025-11-04 05:52:06.414] INFO: Creating enhanced order ORD-20251104055206-005
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055206-005",
  "externalOrderId": "EXT-COFFEE-005",
  "restaurantId": "NYC-CAFE-001",
  "customerEmail": "emma.w@example.com",
  "orderType": "pickup",
  "requestedTime": "2025-11-04T06:07:06Z",
  "itemCount": 2,
  "total": 13.09,
  "paymentStatus": "completed"
}
[2025-11-04 05:52:06.430] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1481,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055206-005\",\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"customer\": {\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\",\n    \"email\": \"emma.w@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:52:06Z\",\n  \"requestedTime\": \"2025-11-04T06:07:06Z\",\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-001\",\n      \"name\": \"Large Latte\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"totalPrice\": 5.49,\n      \"specialInstructions\": null,\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Shot\",\n          \"price\": 0.75\n        },\n        {\n          \"name\": \"Oat Milk\",\n          \"price\": 0.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"PASTRY-001\",\n      \"name\": \"Blueberry Muffin\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"tax\": 0.86,\n    \"tip\": 1.5,\n... [TRUNCATED]"
}
[2025-11-04 05:52:06.431] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055206-005",
  "idempotencyKey": "d7c317a5-6af6-4256-9906-0dc053880853",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 13.09
}
[2025-11-04 05:52:06.431] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d7c317a5-6af6-4256-9906-0dc053880853"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:06.437] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d7c317a5-6af6-4256-9906-0dc053880853"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:52:06.438] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "2a81fb73-a009-4d42-9d23-5d5b1de2c63e",
  "publicOrderId": "ORD-20251104055206-005"
}
[2025-11-04 05:52:06.439] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "2a81fb73-a009-4d42-9d23-5d5b1de2c63e",
  "orderId": "ORD-20251104055206-005",
  "externalOrderId": "EXT-COFFEE-005",
  "customer": {
    "name": "Emma Wilson",
    "phone": "555-0505",
    "email": "emma.w@example.com",
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 10.73,
    "tax": 0.86,
    "tip": 1.5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 13.09
  }
}
[2025-11-04 05:52:06.443] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2a81fb73-a009-4d42-9d23-5d5b1de2c63e",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055206-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-COFFEE-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-CAFE-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "d7c317a5-6af6-4256-9906-0dc053880853",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "emma.w@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:06Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:07:06Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 10.73,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.86,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 13.09,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-8362",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 13.09,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Name: Emma",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:52:06.444] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:06.444] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:52:06.445] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2a81fb73-a009-4d42-9d23-5d5b1de2c63e"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055206-005"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-COFFEE-005"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-CAFE-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "d7c317a5-6af6-4256-9906-0dc053880853"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505"
    },
    {
      "index": 7,
      "type": "string",
      "value": "emma.w@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:52:06Z"
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:07:06Z"
    },
    {
      "index": 12,
      "type": "number",
      "value": 10.73
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.86
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 13.09
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-8362"
    },
    {
      "index": 21,
      "type": "number",
      "value": 13.09
    },
    {
      "index": 22,
      "type": "string",
      "value": "Name: Emma"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:52:06.448] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 8,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 18,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:52:06.455] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '2a81fb73-a009-4d42-9d23-5d5b1de2c63e',\n  'ORD-20251104055206-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  'd7c317a5-6af6-4256-9906-0dc053880853',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:06Z',\n  '2025-11-04T06:07:06Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-8362',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "18ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055206-005",
    "externalOrderId": "EXT-COFFEE-005",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 13.09
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:52:06.460] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 11,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 13,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 15,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 32,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 62,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:52:06.461] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '2a81fb73-a009-4d42-9d23-5d5b1de2c63e',\n  'ORD-20251104055206-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  'd7c317a5-6af6-4256-9906-0dc053880853',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:06Z',\n  '2025-11-04T06:07:06Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-8362',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "62ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "requestedTime",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:52:06.464] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '2a81fb73-a009-4d42-9d23-5d5b1de2c63e',\n  'ORD-20251104055206-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  'd7c317a5-6af6-4256-9906-0dc053880853',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:52:06Z',\n  '2025-11-04T06:07:06Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-8362',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 10.73,
      "deliveryFee": 0,
      "discount": 0,
      "total": 13.09,
      "tax": 0.86,
      "tip": 1.5
    },
    "requestedTime": "2025-11-04T06:07:06Z",
    "orderType": "pickup",
    "restaurantId": "NYC-CAFE-001",
    "status": "received",
    "customer": {
      "email": "emma.w@example.com",
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "notes": "Name: Emma",
    "items": [
      {
        "name": "Large Latte",
        "itemId": "COFFEE-001",
        "quantity": 1,
        "unitPrice": 5.49,
        "modifiers": [
          {
            "price": 0.75,
            "name": "Extra Shot"
          },
          {
            "price": 0.5,
            "name": "Oat Milk"
          }
        ],
        "totalPrice": 5.49
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin",
        "itemId": "PASTRY-001"
      }
    ],
    "externalOrderId": "EXT-COFFEE-005",
    "orderTime": "2025-11-04T05:52:06Z",
    "payment": {
      "transactionId": "TXN-8362",
      "method": "mobile_payment",
      "amount": 13.09,
      "status": "completed"
    },
    "orderId": "ORD-20251104055206-005"
  }
}
[2025-11-04 05:52:21.796] INFO: GET /api/v1/logs
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:52:21.796] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:53:08.192] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:53:08.196] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:53:08.200] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1910"
  },
  "query": {},
  "params": {},
  "bodySize": 823,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:53:08.201] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1127,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 18.88,\n    \"tax\": 1.4,\n    \"tip\": 0\n  },\n  \"requestedTime\": \"2025-11-04T06:23:08Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"notes\": \"Please call when ready\",\n  \"items\": [\n    {\n      \"name\": \"Turkey Club Sandwich\",\n      \"itemId\": \"SANDWICH-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"name\": \"Extra Cheese\"\n        }\n      ],\n      \"totalPrice\": 12.99\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\",\n      \"itemId\": \"DRINK-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"orderTime\": \"2025-11-04T05:53:08Z\",\n  \"payment\": {\n    \"transactionId\": \"TXN-... [TRUNCATED]"
}
[2025-11-04 05:53:08.201] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1127,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 18.88,\n    \"tax\": 1.4,\n    \"tip\": 0\n  },\n  \"requestedTime\": \"2025-11-04T06:23:08Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"notes\": \"Please call when ready\",\n  \"items\": [\n    {\n      \"name\": \"Turkey Club Sandwich\",\n      \"itemId\": \"SANDWICH-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"price\": 1.5,\n          \"name\": \"Extra Cheese\"\n        }\n      ],\n      \"totalPrice\": 12.99\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\",\n      \"itemId\": \"DRINK-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"orderTime\": \"2025-11-04T05:53:08Z\",\n  \"payment\": {\n    \"transactionId\": \"TXN-... [TRUNCATED]"
}
[2025-11-04 05:53:08.202] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca"
}
[2025-11-04 05:53:08.202] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:53:08.202] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 17.48,
      "deliveryFee": 0,
      "discount": 0,
      "total": 18.88,
      "tax": 1.4,
      "tip": 0
    },
    "requestedTime": "2025-11-04T06:23:08Z",
    "orderType": "pickup",
    "restaurantId": "NYC-DELI-001",
    "status": "received",
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "notes": "Please call when ready",
    "items": [
      {
        "name": "Turkey Club Sandwich",
        "itemId": "SANDWICH-001",
        "quantity": 1,
        "unitPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "price": 1.5,
            "name": "Extra Cheese"
          }
        ],
        "totalPrice": 12.99
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea",
        "itemId": "DRINK-001"
      }
    ],
    "externalOrderId": "EXT-PICKUP-001",
    "orderTime": "2025-11-04T05:53:08Z",
    "payment": {
      "transactionId": "TXN-7578",
      "method": "credit_card",
      "amount": 18.88,
      "status": "completed"
    },
    "orderId": "ORD-20251104055308-001"
  }
}
[2025-11-04 05:53:08.203] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:53:08.204] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":17.48,\"deliveryFee\":0,\"discount\":0,\"total\":18.88,\"tax\":1.4,\"tip\":0},\"requestedTime\":\"2025-11-04T06:23:08Z\",\"orderType\":\"pickup\",\"restaurantId\":\"NYC-DELI-001\",\"status\":\"received\",...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055308-001\",\"externalOrderId\":\"EXT-PICKUP-001\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"John Smith\",\"phone\":\"555-0101\",\"email\":\"john.smith@example.com\",\"address\":null}...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:53:08.204] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055308-001",
    "externalOrderId": "EXT-PICKUP-001",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "John Smith",
      "phone": "555-0101",
      "email": "john.smith@example.com",
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:53:08Z",
    "requestedTime": "2025-11-04T06:23:08Z",
    "items": [
      {
        "itemId": "SANDWICH-001",
        "name": "Turkey Club Sandwich",
        "quantity": 1,
        "unitPrice": 12.99,
        "totalPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "name": "Extra Cheese",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "DRINK-001",
        "name": "Iced Tea",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 17.48,
      "tax": 1.4,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 18.88
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": "TXN-7578",
      "amount": 18.88
    },
    "notes": "Please call when ready",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:53:08.205] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055308-001",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 18.88,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Turkey Club Sandwich",
      "quantity": 1,
      "unitPrice": 12.99,
      "hasModifiers": true,
      "modifierCount": 1
    },
    {
      "index": 1,
      "name": "Iced Tea",
      "quantity": 1,
      "unitPrice": 2.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 17.48,
    "tax": 1.4,
    "tip": 0,
    "total": 18.88,
    "calculatedTotal": 18.88
  }
}
[2025-11-04 05:53:08.205] INFO: Creating enhanced order ORD-20251104055308-001
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055308-001",
  "externalOrderId": "EXT-PICKUP-001",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": "john.smith@example.com",
  "orderType": "pickup",
  "requestedTime": "2025-11-04T06:23:08Z",
  "itemCount": 2,
  "total": 18.88,
  "paymentStatus": "completed"
}
[2025-11-04 05:53:08.205] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1441,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055308-001\",\n  \"externalOrderId\": \"EXT-PICKUP-001\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\",\n    \"email\": \"john.smith@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:53:08Z\",\n  \"requestedTime\": \"2025-11-04T06:23:08Z\",\n  \"items\": [\n    {\n      \"itemId\": \"SANDWICH-001\",\n      \"name\": \"Turkey Club Sandwich\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"totalPrice\": 12.99,\n      \"specialInstructions\": \"No mayo, extra lettuce\",\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Cheese\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"DRINK-001\",\n      \"name\": \"Iced Tea\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 17.48,\n    \"tax\": 1.4,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"tot... [TRUNCATED]"
}
[2025-11-04 05:53:08.205] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055308-001",
  "idempotencyKey": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 18.88
}
[2025-11-04 05:53:08.206] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:08.207] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:53:08.207] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "b63afbc8-bc48-4bd4-9279-2d583fc16c32",
  "publicOrderId": "ORD-20251104055308-001"
}
[2025-11-04 05:53:08.207] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "b63afbc8-bc48-4bd4-9279-2d583fc16c32",
  "orderId": "ORD-20251104055308-001",
  "externalOrderId": "EXT-PICKUP-001",
  "customer": {
    "name": "John Smith",
    "phone": "555-0101",
    "email": "john.smith@example.com",
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 17.48,
    "tax": 1.4,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 18.88
  }
}
[2025-11-04 05:53:08.218] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "b63afbc8-bc48-4bd4-9279-2d583fc16c32",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055308-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-PICKUP-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:08Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:23:08Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 17.48,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.4,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 18.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-7578",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 18.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:53:08.219] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:08.219] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:08.219] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "b63afbc8-bc48-4bd4-9279-2d583fc16c32"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055308-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-PICKUP-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "3c14dce9-b35c-4f05-9f4d-0c3fa61282ca"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:08Z"
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:23:08Z"
    },
    {
      "index": 12,
      "type": "number",
      "value": 17.48
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.4
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 18.88
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-7578"
    },
    {
      "index": 21,
      "type": "number",
      "value": 18.88
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:08.221] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 16,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:08.222] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'b63afbc8-bc48-4bd4-9279-2d583fc16c32',\n  'ORD-20251104055308-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  '3c14dce9-b35c-4f05-9f4d-0c3fa61282ca',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:08Z',\n  '2025-11-04T06:23:08Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-7578',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "16ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055308-001",
    "externalOrderId": "EXT-PICKUP-001",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 18.88
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:53:08.223] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 23,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:08.223] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'b63afbc8-bc48-4bd4-9279-2d583fc16c32',\n  'ORD-20251104055308-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  '3c14dce9-b35c-4f05-9f4d-0c3fa61282ca',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:08Z',\n  '2025-11-04T06:23:08Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-7578',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "23ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "requestedTime",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:53:08.226] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'b63afbc8-bc48-4bd4-9279-2d583fc16c32',\n  'ORD-20251104055308-001',\n  'EXT-PICKUP-001',\n  'NYC-DELI-001',\n  '3c14dce9-b35c-4f05-9f4d-0c3fa61282ca',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:08Z',\n  '2025-11-04T06:23:08Z',\n  17.48,\n  1.4,\n  0,\n  0,\n  0,\n  18.88,\n  'credit_card',\n  'completed',\n  'TXN-7578',\n  18.88,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 17.48,
      "deliveryFee": 0,
      "discount": 0,
      "total": 18.88,
      "tax": 1.4,
      "tip": 0
    },
    "requestedTime": "2025-11-04T06:23:08Z",
    "orderType": "pickup",
    "restaurantId": "NYC-DELI-001",
    "status": "received",
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "notes": "Please call when ready",
    "items": [
      {
        "name": "Turkey Club Sandwich",
        "itemId": "SANDWICH-001",
        "quantity": 1,
        "unitPrice": 12.99,
        "specialInstructions": "No mayo, extra lettuce",
        "modifiers": [
          {
            "price": 1.5,
            "name": "Extra Cheese"
          }
        ],
        "totalPrice": 12.99
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea",
        "itemId": "DRINK-001"
      }
    ],
    "externalOrderId": "EXT-PICKUP-001",
    "orderTime": "2025-11-04T05:53:08Z",
    "payment": {
      "transactionId": "TXN-7578",
      "method": "credit_card",
      "amount": 18.88,
      "status": "completed"
    },
    "orderId": "ORD-20251104055308-001"
  }
}
[2025-11-04 05:53:09.241] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:53:09.241] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:53:09.242] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "2330"
  },
  "query": {},
  "params": {},
  "bodySize": 901,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:53:09.243] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1293,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 29.46,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 36.82,\n    \"tax\": 2.36,\n    \"tip\": 5\n  },\n  \"orderType\": \"dine-in\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"mchen@example.com\",\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"notes\": \"Table 15\",\n  \"items\": [\n    {\n      \"name\": \"Classic Cheeseburger\",\n      \"itemId\": \"BURGER-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"price\": 2,\n          \"name\": \"Extra Bacon\"\n        },\n        {\n          \"price\": 1.5,\n          \"name\": \"Avocado\"\n        }\n      ],\n      \"totalPrice\": 14.99\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\",\n      \"itemId\": \"SIDES-001\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milk... [TRUNCATED]"
}
[2025-11-04 05:53:09.243] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1293,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 29.46,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 36.82,\n    \"tax\": 2.36,\n    \"tip\": 5\n  },\n  \"orderType\": \"dine-in\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"mchen@example.com\",\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"notes\": \"Table 15\",\n  \"items\": [\n    {\n      \"name\": \"Classic Cheeseburger\",\n      \"itemId\": \"BURGER-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"price\": 2,\n          \"name\": \"Extra Bacon\"\n        },\n        {\n          \"price\": 1.5,\n          \"name\": \"Avocado\"\n        }\n      ],\n      \"totalPrice\": 14.99\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\",\n      \"itemId\": \"SIDES-001\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milk... [TRUNCATED]"
}
[2025-11-04 05:53:09.249] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "1cd0f17d-6061-404f-b119-be9ef6c8c884"
}
[2025-11-04 05:53:09.249] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:53:09.250] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 29.46,
      "deliveryFee": 0,
      "discount": 0,
      "total": 36.82,
      "tax": 2.36,
      "tip": 5
    },
    "orderType": "dine-in",
    "restaurantId": "NYC-BURGER-001",
    "status": "received",
    "customer": {
      "email": "mchen@example.com",
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "notes": "Table 15",
    "items": [
      {
        "name": "Classic Cheeseburger",
        "itemId": "BURGER-001",
        "quantity": 1,
        "unitPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "price": 2,
            "name": "Extra Bacon"
          },
          {
            "price": 1.5,
            "name": "Avocado"
          }
        ],
        "totalPrice": 14.99
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries",
        "itemId": "SIDES-001"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake",
        "itemId": "SHAKE-001"
      }
    ],
    "externalOrderId": "EXT-DINEIN-003",
    "orderTime": "2025-11-04T05:53:09Z",
    "payment": {
      "transactionId": "TXN-4944",
      "method": "credit_card",
      "amount": 36.82,
      "status": "completed"
    },
    "orderId": "ORD-20251104055309-003"
  }
}
[2025-11-04 05:53:09.252] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:53:09.252] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":29.46,\"deliveryFee\":0,\"discount\":0,\"total\":36.82,\"tax\":2.36,\"tip\":5},\"orderType\":\"dine-in\",\"restaurantId\":\"NYC-BURGER-001\",\"status\":\"received\",\"customer\":{\"email\":\"mchen@example....",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055309-003\",\"externalOrderId\":\"EXT-DINEIN-003\",\"restaurantId\":\"NYC-BURGER-001\",\"customer\":{\"name\":\"Michael Chen\",\"phone\":\"555-0303\",\"email\":\"mchen@example.com\",\"address\":null},...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:53:09.253] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055309-003",
    "externalOrderId": "EXT-DINEIN-003",
    "restaurantId": "NYC-BURGER-001",
    "customer": {
      "name": "Michael Chen",
      "phone": "555-0303",
      "email": "mchen@example.com",
      "address": null
    },
    "orderType": "dine-in",
    "orderTime": "2025-11-04T05:53:09Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "BURGER-001",
        "name": "Classic Cheeseburger",
        "quantity": 1,
        "unitPrice": 14.99,
        "totalPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "name": "Extra Bacon",
            "price": 2
          },
          {
            "name": "Avocado",
            "price": 1.5
          }
        ]
      },
      {
        "itemId": "SIDES-001",
        "name": "French Fries",
        "quantity": 1,
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "SHAKE-001",
        "name": "Chocolate Milkshake",
        "quantity": 1,
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 29.46,
      "tax": 2.36,
      "tip": 5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 36.82
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": "TXN-4944",
      "amount": 36.82
    },
    "notes": "Table 15",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:53:09.255] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055309-003",
    "hasExternalId": true,
    "restaurantId": "NYC-BURGER-001",
    "customerComplete": true,
    "orderType": "dine-in",
    "itemCount": 3,
    "totalAmount": 36.82,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Classic Cheeseburger",
      "quantity": 1,
      "unitPrice": 14.99,
      "hasModifiers": true,
      "modifierCount": 2
    },
    {
      "index": 1,
      "name": "French Fries",
      "quantity": 1,
      "unitPrice": 4.99,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 2,
      "name": "Chocolate Milkshake",
      "quantity": 1,
      "unitPrice": 5.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 29.46,
    "tax": 2.36,
    "tip": 5,
    "total": 36.82,
    "calculatedTotal": 36.82
  }
}
[2025-11-04 05:53:09.256] INFO: Creating enhanced order ORD-20251104055309-003
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055309-003",
  "externalOrderId": "EXT-DINEIN-003",
  "restaurantId": "NYC-BURGER-001",
  "customerEmail": "mchen@example.com",
  "orderType": "dine-in",
  "requestedTime": null,
  "itemCount": 3,
  "total": 36.82,
  "paymentStatus": "completed"
}
[2025-11-04 05:53:09.256] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1690,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055309-003\",\n  \"externalOrderId\": \"EXT-DINEIN-003\",\n  \"restaurantId\": \"NYC-BURGER-001\",\n  \"customer\": {\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\",\n    \"email\": \"mchen@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"dine-in\",\n  \"orderTime\": \"2025-11-04T05:53:09Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"BURGER-001\",\n      \"name\": \"Classic Cheeseburger\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"totalPrice\": 14.99,\n      \"specialInstructions\": \"Medium rare, no onions\",\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Bacon\",\n          \"price\": 2\n        },\n        {\n          \"name\": \"Avocado\",\n          \"price\": 1.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"SIDES-001\",\n      \"name\": \"French Fries\",\n      \"quantity\": 1,\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": \"SHAKE-001\",\n      \"name\": \"Chocolate Milksh... [TRUNCATED]"
}
[2025-11-04 05:53:09.256] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055309-003",
  "idempotencyKey": "1cd0f17d-6061-404f-b119-be9ef6c8c884",
  "hasCustomer": true,
  "itemCount": 3,
  "totalAmount": 36.82
}
[2025-11-04 05:53:09.256] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "1cd0f17d-6061-404f-b119-be9ef6c8c884"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:09.258] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "1cd0f17d-6061-404f-b119-be9ef6c8c884"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:53:09.258] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "83cb2f6c-4e93-4456-aead-2805958d8525",
  "publicOrderId": "ORD-20251104055309-003"
}
[2025-11-04 05:53:09.258] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "83cb2f6c-4e93-4456-aead-2805958d8525",
  "orderId": "ORD-20251104055309-003",
  "externalOrderId": "EXT-DINEIN-003",
  "customer": {
    "name": "Michael Chen",
    "phone": "555-0303",
    "email": "mchen@example.com",
    "address": null
  },
  "orderType": "dine-in",
  "totals": {
    "subtotal": 29.46,
    "tax": 2.36,
    "tip": 5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 36.82
  }
}
[2025-11-04 05:53:09.259] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "83cb2f6c-4e93-4456-aead-2805958d8525",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055309-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-DINEIN-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-BURGER-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "1cd0f17d-6061-404f-b119-be9ef6c8c884",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "mchen@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:09Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 29.46,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.36,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 36.82,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-4944",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 36.82,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:53:09.260] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:09.260] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:09.260] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "83cb2f6c-4e93-4456-aead-2805958d8525"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055309-003"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-DINEIN-003"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-BURGER-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "1cd0f17d-6061-404f-b119-be9ef6c8c884"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303"
    },
    {
      "index": 7,
      "type": "string",
      "value": "mchen@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:09Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 29.46
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.36
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 36.82
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-4944"
    },
    {
      "index": 21,
      "type": "number",
      "value": 36.82
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:09.267] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 11,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:09.268] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '83cb2f6c-4e93-4456-aead-2805958d8525',\n  'ORD-20251104055309-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '1cd0f17d-6061-404f-b119-be9ef6c8c884',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine-in',\n  '2025-11-04T05:53:09Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-4944',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "11ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055309-003",
    "externalOrderId": "EXT-DINEIN-003",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 3,
    "hasTotals": true,
    "totalAmount": 36.82
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:53:09.269] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 10,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 14,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 27,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:09.269] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '83cb2f6c-4e93-4456-aead-2805958d8525',\n  'ORD-20251104055309-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '1cd0f17d-6061-404f-b119-be9ef6c8c884',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine-in',\n  '2025-11-04T05:53:09Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-4944',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "27ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:53:09.272] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '83cb2f6c-4e93-4456-aead-2805958d8525',\n  'ORD-20251104055309-003',\n  'EXT-DINEIN-003',\n  'NYC-BURGER-001',\n  '1cd0f17d-6061-404f-b119-be9ef6c8c884',\n  'Michael Chen',\n  '555-0303',\n  'mchen@example.com',\n  null,\n  'dine-in',\n  '2025-11-04T05:53:09Z',\n  null,\n  29.46,\n  2.36,\n  5,\n  0,\n  0,\n  36.82,\n  'credit_card',\n  'completed',\n  'TXN-4944',\n  36.82,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 29.46,
      "deliveryFee": 0,
      "discount": 0,
      "total": 36.82,
      "tax": 2.36,
      "tip": 5
    },
    "orderType": "dine-in",
    "restaurantId": "NYC-BURGER-001",
    "status": "received",
    "customer": {
      "email": "mchen@example.com",
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "notes": "Table 15",
    "items": [
      {
        "name": "Classic Cheeseburger",
        "itemId": "BURGER-001",
        "quantity": 1,
        "unitPrice": 14.99,
        "specialInstructions": "Medium rare, no onions",
        "modifiers": [
          {
            "price": 2,
            "name": "Extra Bacon"
          },
          {
            "price": 1.5,
            "name": "Avocado"
          }
        ],
        "totalPrice": 14.99
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries",
        "itemId": "SIDES-001"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake",
        "itemId": "SHAKE-001"
      }
    ],
    "externalOrderId": "EXT-DINEIN-003",
    "orderTime": "2025-11-04T05:53:09Z",
    "payment": {
      "transactionId": "TXN-4944",
      "method": "credit_card",
      "amount": 36.82,
      "status": "completed"
    },
    "orderId": "ORD-20251104055309-003"
  }
}
[2025-11-04 05:53:10.324] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:53:10.328] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:53:10.338] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "2035"
  },
  "query": {},
  "params": {},
  "bodySize": 794,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:53:10.338] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1132,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 13.09,\n    \"tax\": 0.86,\n    \"tip\": 1.5\n  },\n  \"requestedTime\": \"2025-11-04T06:08:10Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"emma.w@example.com\",\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"notes\": \"Name: Emma\",\n  \"items\": [\n    {\n      \"name\": \"Large Latte\",\n      \"itemId\": \"COFFEE-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"modifiers\": [\n        {\n          \"price\": 0.75,\n          \"name\": \"Extra Shot\"\n        },\n        {\n          \"price\": 0.5,\n          \"name\": \"Oat Milk\"\n        }\n      ],\n      \"totalPrice\": 5.49\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\",\n      \"itemId\": \"PASTRY-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"orderTime\": \"2025-11-04T05:53:10Z\",\n  \"payment\": {\n    \"transactionId\": \"TX... [TRUNCATED]"
}
[2025-11-04 05:53:10.339] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1132,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "payload": "{\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"deliveryFee\": 0,\n    \"discount\": 0,\n    \"total\": 13.09,\n    \"tax\": 0.86,\n    \"tip\": 1.5\n  },\n  \"requestedTime\": \"2025-11-04T06:08:10Z\",\n  \"orderType\": \"pickup\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"status\": \"received\",\n  \"customer\": {\n    \"email\": \"emma.w@example.com\",\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"notes\": \"Name: Emma\",\n  \"items\": [\n    {\n      \"name\": \"Large Latte\",\n      \"itemId\": \"COFFEE-001\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"modifiers\": [\n        {\n          \"price\": 0.75,\n          \"name\": \"Extra Shot\"\n        },\n        {\n          \"price\": 0.5,\n          \"name\": \"Oat Milk\"\n        }\n      ],\n      \"totalPrice\": 5.49\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\",\n      \"itemId\": \"PASTRY-001\"\n    }\n  ],\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"orderTime\": \"2025-11-04T05:53:10Z\",\n  \"payment\": {\n    \"transactionId\": \"TX... [TRUNCATED]"
}
[2025-11-04 05:53:10.340] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "61336910-d7f0-43ef-81c7-d0448fafdcc0"
}
[2025-11-04 05:53:10.341] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ]
}
[2025-11-04 05:53:10.341] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "totals": {
      "subtotal": 10.73,
      "deliveryFee": 0,
      "discount": 0,
      "total": 13.09,
      "tax": 0.86,
      "tip": 1.5
    },
    "requestedTime": "2025-11-04T06:08:10Z",
    "orderType": "pickup",
    "restaurantId": "NYC-CAFE-001",
    "status": "received",
    "customer": {
      "email": "emma.w@example.com",
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "notes": "Name: Emma",
    "items": [
      {
        "name": "Large Latte",
        "itemId": "COFFEE-001",
        "quantity": 1,
        "unitPrice": 5.49,
        "modifiers": [
          {
            "price": 0.75,
            "name": "Extra Shot"
          },
          {
            "price": 0.5,
            "name": "Oat Milk"
          }
        ],
        "totalPrice": 5.49
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin",
        "itemId": "PASTRY-001"
      }
    ],
    "externalOrderId": "EXT-COFFEE-005",
    "orderTime": "2025-11-04T05:53:10Z",
    "payment": {
      "transactionId": "TXN-9054",
      "method": "mobile_payment",
      "amount": 13.09,
      "status": "completed"
    },
    "orderId": "ORD-20251104055310-005"
  }
}
[2025-11-04 05:53:10.343] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:53:10.343] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "totals",
    "requestedTime",
    "orderType",
    "restaurantId",
    "status",
    "customer",
    "notes",
    "items",
    "externalOrderId",
    "orderTime",
    "payment",
    "orderId"
  ],
  "beforeSample": "{\"totals\":{\"subtotal\":10.73,\"deliveryFee\":0,\"discount\":0,\"total\":13.09,\"tax\":0.86,\"tip\":1.5},\"requestedTime\":\"2025-11-04T06:08:10Z\",\"orderType\":\"pickup\",\"restaurantId\":\"NYC-CAFE-001\",\"status\":\"receive...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055310-005\",\"externalOrderId\":\"EXT-COFFEE-005\",\"restaurantId\":\"NYC-CAFE-001\",\"customer\":{\"name\":\"Emma Wilson\",\"phone\":\"555-0505\",\"email\":\"emma.w@example.com\",\"address\":null},\"o...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:53:10.344] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055310-005",
    "externalOrderId": "EXT-COFFEE-005",
    "restaurantId": "NYC-CAFE-001",
    "customer": {
      "name": "Emma Wilson",
      "phone": "555-0505",
      "email": "emma.w@example.com",
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:53:10Z",
    "requestedTime": "2025-11-04T06:08:10Z",
    "items": [
      {
        "itemId": "COFFEE-001",
        "name": "Large Latte",
        "quantity": 1,
        "unitPrice": 5.49,
        "totalPrice": 5.49,
        "specialInstructions": null,
        "modifiers": [
          {
            "name": "Extra Shot",
            "price": 0.75
          },
          {
            "name": "Oat Milk",
            "price": 0.5
          }
        ]
      },
      {
        "itemId": "PASTRY-001",
        "name": "Blueberry Muffin",
        "quantity": 1,
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 10.73,
      "tax": 0.86,
      "tip": 1.5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 13.09
    },
    "payment": {
      "method": "mobile_payment",
      "status": "completed",
      "transactionId": "TXN-9054",
      "amount": 13.09
    },
    "notes": "Name: Emma",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:53:10.345] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055310-005",
    "hasExternalId": true,
    "restaurantId": "NYC-CAFE-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 13.09,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Large Latte",
      "quantity": 1,
      "unitPrice": 5.49,
      "hasModifiers": true,
      "modifierCount": 2
    },
    {
      "index": 1,
      "name": "Blueberry Muffin",
      "quantity": 1,
      "unitPrice": 3.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 10.73,
    "tax": 0.86,
    "tip": 1.5,
    "total": 13.09,
    "calculatedTotal": 13.09
  }
}
[2025-11-04 05:53:10.345] INFO: Creating enhanced order ORD-20251104055310-005
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055310-005",
  "externalOrderId": "EXT-COFFEE-005",
  "restaurantId": "NYC-CAFE-001",
  "customerEmail": "emma.w@example.com",
  "orderType": "pickup",
  "requestedTime": "2025-11-04T06:08:10Z",
  "itemCount": 2,
  "total": 13.09,
  "paymentStatus": "completed"
}
[2025-11-04 05:53:10.353] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1481,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055310-005\",\n  \"externalOrderId\": \"EXT-COFFEE-005\",\n  \"restaurantId\": \"NYC-CAFE-001\",\n  \"customer\": {\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\",\n    \"email\": \"emma.w@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:53:10Z\",\n  \"requestedTime\": \"2025-11-04T06:08:10Z\",\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-001\",\n      \"name\": \"Large Latte\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"totalPrice\": 5.49,\n      \"specialInstructions\": null,\n      \"modifiers\": [\n        {\n          \"name\": \"Extra Shot\",\n          \"price\": 0.75\n        },\n        {\n          \"name\": \"Oat Milk\",\n          \"price\": 0.5\n        }\n      ]\n    },\n    {\n      \"itemId\": \"PASTRY-001\",\n      \"name\": \"Blueberry Muffin\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 10.73,\n    \"tax\": 0.86,\n    \"tip\": 1.5,\n... [TRUNCATED]"
}
[2025-11-04 05:53:10.354] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055310-005",
  "idempotencyKey": "61336910-d7f0-43ef-81c7-d0448fafdcc0",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 13.09
}
[2025-11-04 05:53:10.354] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "61336910-d7f0-43ef-81c7-d0448fafdcc0"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:10.355] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "61336910-d7f0-43ef-81c7-d0448fafdcc0"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:53:10.355] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "c68efea7-5acb-499c-82ef-24a9bd114a29",
  "publicOrderId": "ORD-20251104055310-005"
}
[2025-11-04 05:53:10.356] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "c68efea7-5acb-499c-82ef-24a9bd114a29",
  "orderId": "ORD-20251104055310-005",
  "externalOrderId": "EXT-COFFEE-005",
  "customer": {
    "name": "Emma Wilson",
    "phone": "555-0505",
    "email": "emma.w@example.com",
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 10.73,
    "tax": 0.86,
    "tip": 1.5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 13.09
  }
}
[2025-11-04 05:53:10.356] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c68efea7-5acb-499c-82ef-24a9bd114a29",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055310-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-COFFEE-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-CAFE-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "61336910-d7f0-43ef-81c7-d0448fafdcc0",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "emma.w@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:10Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:08:10Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 10.73,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.86,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 13.09,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-9054",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 13.09,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Name: Emma",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:53:10.358] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:10.358] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:10.359] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c68efea7-5acb-499c-82ef-24a9bd114a29"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055310-005"
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-COFFEE-005"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-CAFE-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "61336910-d7f0-43ef-81c7-d0448fafdcc0"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505"
    },
    {
      "index": 7,
      "type": "string",
      "value": "emma.w@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:10Z"
    },
    {
      "index": 11,
      "type": "string",
      "value": "2025-11-04T06:08:10Z"
    },
    {
      "index": 12,
      "type": "number",
      "value": 10.73
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.86
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 13.09
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "string",
      "value": "TXN-9054"
    },
    {
      "index": 21,
      "type": "number",
      "value": 13.09
    },
    {
      "index": 22,
      "type": "string",
      "value": "Name: Emma"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:10.360] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 7,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:10.360] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c68efea7-5acb-499c-82ef-24a9bd114a29',\n  'ORD-20251104055310-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  '61336910-d7f0-43ef-81c7-d0448fafdcc0',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:10Z',\n  '2025-11-04T06:08:10Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-9054',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "7ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055310-005",
    "externalOrderId": "EXT-COFFEE-005",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 13.09
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:53:10.361] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 15,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 23,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:53:10.361] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c68efea7-5acb-499c-82ef-24a9bd114a29',\n  'ORD-20251104055310-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  '61336910-d7f0-43ef-81c7-d0448fafdcc0',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:10Z',\n  '2025-11-04T06:08:10Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-9054',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "23ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "totals",
      "requestedTime",
      "orderType",
      "restaurantId",
      "status",
      "customer",
      "notes",
      "items",
      "externalOrderId",
      "orderTime",
      "payment",
      "orderId"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:53:10.378] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c68efea7-5acb-499c-82ef-24a9bd114a29',\n  'ORD-20251104055310-005',\n  'EXT-COFFEE-005',\n  'NYC-CAFE-001',\n  '61336910-d7f0-43ef-81c7-d0448fafdcc0',\n  'Emma Wilson',\n  '555-0505',\n  'emma.w@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:53:10Z',\n  '2025-11-04T06:08:10Z',\n  10.73,\n  0.86,\n  1.5,\n  0,\n  0,\n  13.09,\n  'mobile_payment',\n  'completed',\n  'TXN-9054',\n  13.09,\n  'Name: Emma',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "totals": {
      "subtotal": 10.73,
      "deliveryFee": 0,
      "discount": 0,
      "total": 13.09,
      "tax": 0.86,
      "tip": 1.5
    },
    "requestedTime": "2025-11-04T06:08:10Z",
    "orderType": "pickup",
    "restaurantId": "NYC-CAFE-001",
    "status": "received",
    "customer": {
      "email": "emma.w@example.com",
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "notes": "Name: Emma",
    "items": [
      {
        "name": "Large Latte",
        "itemId": "COFFEE-001",
        "quantity": 1,
        "unitPrice": 5.49,
        "modifiers": [
          {
            "price": 0.75,
            "name": "Extra Shot"
          },
          {
            "price": 0.5,
            "name": "Oat Milk"
          }
        ],
        "totalPrice": 5.49
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin",
        "itemId": "PASTRY-001"
      }
    ],
    "externalOrderId": "EXT-COFFEE-005",
    "orderTime": "2025-11-04T05:53:10Z",
    "payment": {
      "transactionId": "TXN-9054",
      "method": "mobile_payment",
      "amount": 13.09,
      "status": "completed"
    },
    "orderId": "ORD-20251104055310-005"
  }
}
[2025-11-04 05:53:49.415] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:53:49.431] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:53:49.433] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "212"
  },
  "query": {},
  "params": {},
  "bodySize": 212,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:53:49.434] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 314,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "customer",
    "orderType",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"TEST-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-0123\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"name\": \"Test Item\",\n      \"quantity\": 1,\n      \"unitPrice\": 10,\n      \"totalPrice\": 10\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 10,\n    \"tax\": 0.8,\n    \"total\": 10.8\n  }\n}"
}
[2025-11-04 05:53:49.434] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 314,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "customer",
    "orderType",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"TEST-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-0123\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"name\": \"Test Item\",\n      \"quantity\": 1,\n      \"unitPrice\": 10,\n      \"totalPrice\": 10\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 10,\n    \"tax\": 0.8,\n    \"total\": 10.8\n  }\n}"
}
[2025-11-04 05:53:49.435] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "d08092c1-7a7d-49c6-90e6-b4be60e245ba"
}
[2025-11-04 05:53:49.436] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "customer",
    "orderType",
    "items",
    "totals"
  ]
}
[2025-11-04 05:53:49.436] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "TEST-001",
    "customer": {
      "name": "Test",
      "phone": "555-0123"
    },
    "orderType": "pickup",
    "items": [
      {
        "name": "Test Item",
        "quantity": 1,
        "unitPrice": 10,
        "totalPrice": 10
      }
    ],
    "totals": {
      "subtotal": 10,
      "tax": 0.8,
      "total": 10.8
    }
  }
}
[2025-11-04 05:53:49.437] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "customer",
    "orderType",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:53:49.437] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "customer",
    "orderType",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"TEST-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-0123\"},\"orderType\":\"pickup\",\"items\":[{\"name\":\"Test Item\",\"quantity\":1,\"unitPrice\":10,\"totalPrice\":10}],\"totals\":{\"subtotal\":10,\"tax\":0.8,\"t...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"TEST-001\",\"externalOrderId\":\"TEST-001\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-0123\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-04T...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:53:49.438] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "TEST-001",
    "externalOrderId": "TEST-001",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-0123",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:53:49.437Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Test Item",
        "quantity": 1,
        "unitPrice": 10,
        "totalPrice": 10,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 10,
      "tax": 0.8,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 10.8
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:53:49.440] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "TEST-001",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 10.8,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Test Item",
      "quantity": 1,
      "unitPrice": 10,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 10,
    "tax": 0.8,
    "tip": 0,
    "total": 10.8,
    "calculatedTotal": 10.8
  }
}
[2025-11-04 05:53:49.440] INFO: Creating enhanced order TEST-001
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "TEST-001",
  "externalOrderId": "TEST-001",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 10.8,
  "paymentStatus": "pending"
}
[2025-11-04 05:53:49.443] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1006,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"TEST-001\",\n  \"externalOrderId\": \"TEST-001\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-0123\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:53:49.437Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Test Item\",\n      \"quantity\": 1,\n      \"unitPrice\": 10,\n      \"totalPrice\": 10,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 10,\n    \"tax\": 0.8,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 10.8\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"hasWebhookMetadata\": false... [TRUNCATED]"
}
[2025-11-04 05:53:49.443] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-001",
  "idempotencyKey": "d08092c1-7a7d-49c6-90e6-b4be60e245ba",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 10.8
}
[2025-11-04 05:53:49.443] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d08092c1-7a7d-49c6-90e6-b4be60e245ba"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:49.446] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "d08092c1-7a7d-49c6-90e6-b4be60e245ba"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:53:49.446] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "4efcb245-d638-42f7-886b-a0b45568dd40",
  "publicOrderId": "TEST-001"
}
[2025-11-04 05:53:49.447] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "4efcb245-d638-42f7-886b-a0b45568dd40",
  "orderId": "TEST-001",
  "externalOrderId": "TEST-001",
  "customer": {
    "name": "Test",
    "phone": "555-0123",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 10,
    "tax": 0.8,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 10.8
  }
}
[2025-11-04 05:53:49.448] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4efcb245-d638-42f7-886b-a0b45568dd40",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "TEST-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "d08092c1-7a7d-49c6-90e6-b4be60e245ba",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0123",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:49.437Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 10,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.8,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 10.8,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:53:49.449] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:49.450] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:49.450] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4efcb245-d638-42f7-886b-a0b45568dd40"
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "TEST-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "d08092c1-7a7d-49c6-90e6-b4be60e245ba"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0123"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:49.437Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 10
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.8
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 10.8
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:49.481] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4efcb245-d638-42f7-886b-a0b45568dd40"
    },
    {
      "index": 1,
      "type": "string",
      "value": "TEST-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "TEST-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "d08092c1-7a7d-49c6-90e6-b4be60e245ba"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0123"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:53:49.437Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 10
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.8
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 10.8
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 3
  }
}
[2025-11-04 05:53:49.481] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "4efcb245-d638-42f7-886b-a0b45568dd40",
  "orderId": "TEST-001",
  "changes": 1,
  "lastID": 3
}
[2025-11-04 05:53:49.481] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:49.483] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 1,
  "items": [
    {
      "index": 0,
      "name": "Test Item",
      "quantity": 1,
      "unitPrice": 10,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 05:53:49.483] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "eb580b48-ca9e-4ac5-9721-ea463616cdf4"
    },
    {
      "index": 1,
      "type": "string",
      "value": "4efcb245-d638-42f7-886b-a0b45568dd40"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Test Item"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 10
    },
    {
      "index": 6,
      "type": "number",
      "value": 10
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:53:49.504] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "eb580b48-ca9e-4ac5-9721-ea463616cdf4"
    },
    {
      "index": 1,
      "type": "string",
      "value": "4efcb245-d638-42f7-886b-a0b45568dd40"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Test Item"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 10
    },
    {
      "index": 6,
      "type": "number",
      "value": 10
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 5
  }
}
[2025-11-04 05:53:49.504] INFO: Inserted 1 items for order TEST-001
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:49.516] INFO: Order created successfully: TEST-001
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:53:49.529] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 39,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 62,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 74,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 87,
      "error": null
    }
  ]
}
[2025-11-04 05:53:49.530] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-001",
  "totalServiceTime": "88ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "TEST-001",
    "itemCount": 1,
    "totalAmount": 10.8,
    "status": "received"
  }
}
[2025-11-04 05:53:49.530] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 9,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 97,
      "error": null
    }
  ]
}
[2025-11-04 05:53:49.530] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "TEST-001",
  "totalProcessingTime": "97ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 1,
    "totalAmount": 10.8,
    "status": "received"
  }
}
[2025-11-04 05:54:59.526] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 05:54:59.569] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 05:55:29.160] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:55:29.208] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:55:29.209] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1052"
  },
  "query": {},
  "params": {},
  "bodySize": 444,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:55:29.209] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 617,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-001\",\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 15.98,\n    \"tax\": 1.28,\n    \"total\": 17.26\n  },\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"unitPrice\": 12.99,\n      \"totalPrice\": 12.99,\n      \"quantity\": 1,\n      \"name\": \"Turkey Club Sandwich\"\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\"\n    }\n  ],\n  \"notes\": \"Please call when ready\"\n}"
}
[2025-11-04 05:55:29.209] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 617,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-001\",\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 15.98,\n    \"tax\": 1.28,\n    \"total\": 17.26\n  },\n  \"customer\": {\n    \"email\": \"john.smith@example.com\",\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"unitPrice\": 12.99,\n      \"totalPrice\": 12.99,\n      \"quantity\": 1,\n      \"name\": \"Turkey Club Sandwich\"\n    },\n    {\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"quantity\": 1,\n      \"name\": \"Iced Tea\"\n    }\n  ],\n  \"notes\": \"Please call when ready\"\n}"
}
[2025-11-04 05:55:29.210] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "beb2e1b1-0368-4688-9e0b-3683a0dec341"
}
[2025-11-04 05:55:29.210] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ]
}
[2025-11-04 05:55:29.210] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-20251104055529-001",
    "payment": {
      "method": "credit_card",
      "status": "completed"
    },
    "totals": {
      "subtotal": 15.98,
      "tax": 1.28,
      "total": 17.26
    },
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "orderType": "pickup",
    "items": [
      {
        "unitPrice": 12.99,
        "totalPrice": 12.99,
        "quantity": 1,
        "name": "Turkey Club Sandwich"
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea"
      }
    ],
    "notes": "Please call when ready"
  }
}
[2025-11-04 05:55:29.211] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:55:29.211] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "beforeSample": "{\"orderId\":\"ORD-20251104055529-001\",\"payment\":{\"method\":\"credit_card\",\"status\":\"completed\"},\"totals\":{\"subtotal\":15.98,\"tax\":1.28,\"total\":17.26},\"customer\":{\"email\":\"john.smith@example.com\",\"name\":\"Jo...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055529-001\",\"externalOrderId\":\"ORD-20251104055529-001\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"John Smith\",\"phone\":\"555-0101\",\"email\":\"john.smith@example.com\",\"addres...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:55:29.211] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055529-001",
    "externalOrderId": "ORD-20251104055529-001",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "John Smith",
      "phone": "555-0101",
      "email": "john.smith@example.com",
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:55:29.211Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Turkey Club Sandwich",
        "quantity": 1,
        "unitPrice": 12.99,
        "totalPrice": 12.99,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": null,
        "name": "Iced Tea",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 15.98,
      "tax": 1.28,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 17.26
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": null,
      "amount": 0
    },
    "notes": "Please call when ready",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:55:29.212] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055529-001",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 17.26,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Turkey Club Sandwich",
      "quantity": 1,
      "unitPrice": 12.99,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 1,
      "name": "Iced Tea",
      "quantity": 1,
      "unitPrice": 2.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 15.98,
    "tax": 1.28,
    "tip": 0,
    "total": 17.26,
    "calculatedTotal": 17.26
  }
}
[2025-11-04 05:55:29.212] INFO: Creating enhanced order ORD-20251104055529-001
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055529-001",
  "externalOrderId": "ORD-20251104055529-001",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": "john.smith@example.com",
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 2,
  "total": 17.26,
  "paymentStatus": "completed"
}
[2025-11-04 05:55:29.212] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1305,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-001\",\n  \"externalOrderId\": \"ORD-20251104055529-001\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"John Smith\",\n    \"phone\": \"555-0101\",\n    \"email\": \"john.smith@example.com\",\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:55:29.211Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Turkey Club Sandwich\",\n      \"quantity\": 1,\n      \"unitPrice\": 12.99,\n      \"totalPrice\": 12.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": null,\n      \"name\": \"Iced Tea\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99,\n      \"totalPrice\": 2.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 15.98,\n    \"tax\": 1.28,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 17.26\n  },\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\": \"completed\",\n    \"transactionId\": null,\n    \"amount\"... [TRUNCATED]"
}
[2025-11-04 05:55:29.212] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055529-001",
  "idempotencyKey": "beb2e1b1-0368-4688-9e0b-3683a0dec341",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 17.26
}
[2025-11-04 05:55:29.213] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "beb2e1b1-0368-4688-9e0b-3683a0dec341"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:29.213] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "beb2e1b1-0368-4688-9e0b-3683a0dec341"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:55:29.214] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "47a94419-ffc1-44ed-913a-de41d5498ca8",
  "publicOrderId": "ORD-20251104055529-001"
}
[2025-11-04 05:55:29.214] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "47a94419-ffc1-44ed-913a-de41d5498ca8",
  "orderId": "ORD-20251104055529-001",
  "externalOrderId": "ORD-20251104055529-001",
  "customer": {
    "name": "John Smith",
    "phone": "555-0101",
    "email": "john.smith@example.com",
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 15.98,
    "tax": 1.28,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 17.26
  }
}
[2025-11-04 05:55:29.214] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "47a94419-ffc1-44ed-913a-de41d5498ca8",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055529-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055529-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "beb2e1b1-0368-4688-9e0b-3683a0dec341",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:29.211Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 15.98,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.28,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 17.26,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:55:29.215] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:29.215] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:29.215] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "47a94419-ffc1-44ed-913a-de41d5498ca8"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055529-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055529-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "beb2e1b1-0368-4688-9e0b-3683a0dec341"
    },
    {
      "index": 5,
      "type": "string",
      "value": "John Smith"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0101"
    },
    {
      "index": 7,
      "type": "string",
      "value": "john.smith@example.com"
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:29.211Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 15.98
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.28
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 17.26
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": "Please call when ready"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:29.222] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 9,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:29.222] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '47a94419-ffc1-44ed-913a-de41d5498ca8',\n  'ORD-20251104055529-001',\n  'ORD-20251104055529-001',\n  'NYC-DELI-001',\n  'beb2e1b1-0368-4688-9e0b-3683a0dec341',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:55:29.211Z',\n  null,\n  15.98,\n  1.28,\n  0,\n  0,\n  0,\n  17.26,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "9ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055529-001",
    "externalOrderId": "ORD-20251104055529-001",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 17.26
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:55:29.224] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 16,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:29.225] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '47a94419-ffc1-44ed-913a-de41d5498ca8',\n  'ORD-20251104055529-001',\n  'ORD-20251104055529-001',\n  'NYC-DELI-001',\n  'beb2e1b1-0368-4688-9e0b-3683a0dec341',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:55:29.211Z',\n  null,\n  15.98,\n  1.28,\n  0,\n  0,\n  0,\n  17.26,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "16ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "payment",
      "totals",
      "customer",
      "orderType",
      "items",
      "notes"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:55:29.227] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '47a94419-ffc1-44ed-913a-de41d5498ca8',\n  'ORD-20251104055529-001',\n  'ORD-20251104055529-001',\n  'NYC-DELI-001',\n  'beb2e1b1-0368-4688-9e0b-3683a0dec341',\n  'John Smith',\n  '555-0101',\n  'john.smith@example.com',\n  null,\n  'pickup',\n  '2025-11-04T05:55:29.211Z',\n  null,\n  15.98,\n  1.28,\n  0,\n  0,\n  0,\n  17.26,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Please call when ready',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "orderId": "ORD-20251104055529-001",
    "payment": {
      "method": "credit_card",
      "status": "completed"
    },
    "totals": {
      "subtotal": 15.98,
      "tax": 1.28,
      "total": 17.26
    },
    "customer": {
      "email": "john.smith@example.com",
      "name": "John Smith",
      "phone": "555-0101"
    },
    "orderType": "pickup",
    "items": [
      {
        "unitPrice": 12.99,
        "totalPrice": 12.99,
        "quantity": 1,
        "name": "Turkey Club Sandwich"
      },
      {
        "unitPrice": 2.99,
        "totalPrice": 2.99,
        "quantity": 1,
        "name": "Iced Tea"
      }
    ],
    "notes": "Please call when ready"
  }
}
[2025-11-04 05:55:29.903] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:55:29.954] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:55:29.963] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "1241"
  },
  "query": {},
  "params": {},
  "bodySize": 491,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:55:29.963] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 706,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-003\",\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 25.97,\n    \"tax\": 2.08,\n    \"total\": 33.05,\n    \"tip\": 5\n  },\n  \"customer\": {\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"orderType\": \"dine-in\",\n  \"items\": [\n    {\n      \"unitPrice\": 14.99,\n      \"totalPrice\": 14.99,\n      \"quantity\": 1,\n      \"name\": \"Classic Cheeseburger\"\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milkshake\"\n    }\n  ],\n  \"notes\": \"Table 15\"\n}"
}
[2025-11-04 05:55:29.964] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 706,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-003\",\n  \"payment\": {\n    \"method\": \"credit_card\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 25.97,\n    \"tax\": 2.08,\n    \"total\": 33.05,\n    \"tip\": 5\n  },\n  \"customer\": {\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\"\n  },\n  \"orderType\": \"dine-in\",\n  \"items\": [\n    {\n      \"unitPrice\": 14.99,\n      \"totalPrice\": 14.99,\n      \"quantity\": 1,\n      \"name\": \"Classic Cheeseburger\"\n    },\n    {\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"quantity\": 1,\n      \"name\": \"French Fries\"\n    },\n    {\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"quantity\": 1,\n      \"name\": \"Chocolate Milkshake\"\n    }\n  ],\n  \"notes\": \"Table 15\"\n}"
}
[2025-11-04 05:55:29.965] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "3c252f83-2b6d-400b-a875-4f92adcf775e"
}
[2025-11-04 05:55:29.966] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ]
}
[2025-11-04 05:55:29.966] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-20251104055529-003",
    "payment": {
      "method": "credit_card",
      "status": "completed"
    },
    "totals": {
      "subtotal": 25.97,
      "tax": 2.08,
      "total": 33.05,
      "tip": 5
    },
    "customer": {
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "orderType": "dine-in",
    "items": [
      {
        "unitPrice": 14.99,
        "totalPrice": 14.99,
        "quantity": 1,
        "name": "Classic Cheeseburger"
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake"
      }
    ],
    "notes": "Table 15"
  }
}
[2025-11-04 05:55:29.966] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:55:29.967] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items",
    "notes"
  ],
  "beforeSample": "{\"orderId\":\"ORD-20251104055529-003\",\"payment\":{\"method\":\"credit_card\",\"status\":\"completed\"},\"totals\":{\"subtotal\":25.97,\"tax\":2.08,\"total\":33.05,\"tip\":5},\"customer\":{\"name\":\"Michael Chen\",\"phone\":\"555-...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055529-003\",\"externalOrderId\":\"ORD-20251104055529-003\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Michael Chen\",\"phone\":\"555-0303\",\"email\":null,\"address\":null},\"orderTyp...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:55:29.967] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055529-003",
    "externalOrderId": "ORD-20251104055529-003",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Michael Chen",
      "phone": "555-0303",
      "email": null,
      "address": null
    },
    "orderType": "dine-in",
    "orderTime": "2025-11-04T05:55:29.966Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Classic Cheeseburger",
        "quantity": 1,
        "unitPrice": 14.99,
        "totalPrice": 14.99,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": null,
        "name": "French Fries",
        "quantity": 1,
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": null,
        "name": "Chocolate Milkshake",
        "quantity": 1,
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 25.97,
      "tax": 2.08,
      "tip": 5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 33.05
    },
    "payment": {
      "method": "credit_card",
      "status": "completed",
      "transactionId": null,
      "amount": 0
    },
    "notes": "Table 15",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:55:29.972] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055529-003",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "dine-in",
    "itemCount": 3,
    "totalAmount": 33.05,
    "paymentStatus": "completed",
    "hasNotes": true
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Classic Cheeseburger",
      "quantity": 1,
      "unitPrice": 14.99,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 1,
      "name": "French Fries",
      "quantity": 1,
      "unitPrice": 4.99,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 2,
      "name": "Chocolate Milkshake",
      "quantity": 1,
      "unitPrice": 5.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 25.97,
    "tax": 2.08,
    "tip": 5,
    "total": 33.05,
    "calculatedTotal": 33.05
  }
}
[2025-11-04 05:55:29.973] INFO: Creating enhanced order ORD-20251104055529-003
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055529-003",
  "externalOrderId": "ORD-20251104055529-003",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "dine-in",
  "requestedTime": null,
  "itemCount": 3,
  "total": 33.05,
  "paymentStatus": "completed"
}
[2025-11-04 05:55:29.975] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1479,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055529-003\",\n  \"externalOrderId\": \"ORD-20251104055529-003\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Michael Chen\",\n    \"phone\": \"555-0303\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"dine-in\",\n  \"orderTime\": \"2025-11-04T05:55:29.966Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Classic Cheeseburger\",\n      \"quantity\": 1,\n      \"unitPrice\": 14.99,\n      \"totalPrice\": 14.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": null,\n      \"name\": \"French Fries\",\n      \"quantity\": 1,\n      \"unitPrice\": 4.99,\n      \"totalPrice\": 4.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": null,\n      \"name\": \"Chocolate Milkshake\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.99,\n      \"totalPrice\": 5.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 25.97,\n    \"tax\": 2.08,\n ... [TRUNCATED]"
}
[2025-11-04 05:55:29.975] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055529-003",
  "idempotencyKey": "3c252f83-2b6d-400b-a875-4f92adcf775e",
  "hasCustomer": true,
  "itemCount": 3,
  "totalAmount": 33.05
}
[2025-11-04 05:55:29.975] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "3c252f83-2b6d-400b-a875-4f92adcf775e"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:29.979] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "3c252f83-2b6d-400b-a875-4f92adcf775e"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:55:29.980] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "5633d26a-8f47-4335-82fe-5a737418f2a0",
  "publicOrderId": "ORD-20251104055529-003"
}
[2025-11-04 05:55:29.981] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "5633d26a-8f47-4335-82fe-5a737418f2a0",
  "orderId": "ORD-20251104055529-003",
  "externalOrderId": "ORD-20251104055529-003",
  "customer": {
    "name": "Michael Chen",
    "phone": "555-0303",
    "email": null,
    "address": null
  },
  "orderType": "dine-in",
  "totals": {
    "subtotal": 25.97,
    "tax": 2.08,
    "tip": 5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 33.05
  }
}
[2025-11-04 05:55:29.982] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "5633d26a-8f47-4335-82fe-5a737418f2a0",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055529-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055529-003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "3c252f83-2b6d-400b-a875-4f92adcf775e",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:29.966Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.97,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.08,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:55:29.986] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:29.987] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:29.988] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "5633d26a-8f47-4335-82fe-5a737418f2a0"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055529-003"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055529-003"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "3c252f83-2b6d-400b-a875-4f92adcf775e"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Michael Chen"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0303"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:29.966Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 25.97
    },
    {
      "index": 13,
      "type": "number",
      "value": 2.08
    },
    {
      "index": 14,
      "type": "number",
      "value": 5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 33.05
    },
    {
      "index": 18,
      "type": "string",
      "value": "credit_card"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": "Table 15"
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:29.992] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 16,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:29.992] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '5633d26a-8f47-4335-82fe-5a737418f2a0',\n  'ORD-20251104055529-003',\n  'ORD-20251104055529-003',\n  'NYC-DELI-001',\n  '3c252f83-2b6d-400b-a875-4f92adcf775e',\n  'Michael Chen',\n  '555-0303',\n  null,\n  null,\n  'dine-in',\n  '2025-11-04T05:55:29.966Z',\n  null,\n  25.97,\n  2.08,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "16ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055529-003",
    "externalOrderId": "ORD-20251104055529-003",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 3,
    "hasTotals": true,
    "totalAmount": 33.05
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:55:29.993] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 5,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 13,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 31,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:29.995] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '5633d26a-8f47-4335-82fe-5a737418f2a0',\n  'ORD-20251104055529-003',\n  'ORD-20251104055529-003',\n  'NYC-DELI-001',\n  '3c252f83-2b6d-400b-a875-4f92adcf775e',\n  'Michael Chen',\n  '555-0303',\n  null,\n  null,\n  'dine-in',\n  '2025-11-04T05:55:29.966Z',\n  null,\n  25.97,\n  2.08,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "31ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "payment",
      "totals",
      "customer",
      "orderType",
      "items",
      "notes"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:55:29.996] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  '5633d26a-8f47-4335-82fe-5a737418f2a0',\n  'ORD-20251104055529-003',\n  'ORD-20251104055529-003',\n  'NYC-DELI-001',\n  '3c252f83-2b6d-400b-a875-4f92adcf775e',\n  'Michael Chen',\n  '555-0303',\n  null,\n  null,\n  'dine-in',\n  '2025-11-04T05:55:29.966Z',\n  null,\n  25.97,\n  2.08,\n  5,\n  0,\n  0,\n  33.05,\n  'credit_card',\n  'completed',\n  null,\n  0,\n  'Table 15',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "orderId": "ORD-20251104055529-003",
    "payment": {
      "method": "credit_card",
      "status": "completed"
    },
    "totals": {
      "subtotal": 25.97,
      "tax": 2.08,
      "total": 33.05,
      "tip": 5
    },
    "customer": {
      "name": "Michael Chen",
      "phone": "555-0303"
    },
    "orderType": "dine-in",
    "items": [
      {
        "unitPrice": 14.99,
        "totalPrice": 14.99,
        "quantity": 1,
        "name": "Classic Cheeseburger"
      },
      {
        "unitPrice": 4.99,
        "totalPrice": 4.99,
        "quantity": 1,
        "name": "French Fries"
      },
      {
        "unitPrice": 5.99,
        "totalPrice": 5.99,
        "quantity": 1,
        "name": "Chocolate Milkshake"
      }
    ],
    "notes": "Table 15"
  }
}
[2025-11-04 05:55:30.042] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:55:30.051] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:55:30.114] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "986"
  },
  "query": {},
  "params": {},
  "bodySize": 388,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:55:30.115] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 557,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055530-005\",\n  \"payment\": {\n    \"method\": \"mobile_payment\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 9.48,\n    \"tax\": 0.76,\n    \"total\": 11.74,\n    \"tip\": 1.5\n  },\n  \"customer\": {\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"unitPrice\": 5.49,\n      \"totalPrice\": 5.49,\n      \"quantity\": 1,\n      \"name\": \"Large Latte\"\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\"\n    }\n  ]\n}"
}
[2025-11-04 05:55:30.115] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 557,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055530-005\",\n  \"payment\": {\n    \"method\": \"mobile_payment\",\n    \"status\": \"completed\"\n  },\n  \"totals\": {\n    \"subtotal\": 9.48,\n    \"tax\": 0.76,\n    \"total\": 11.74,\n    \"tip\": 1.5\n  },\n  \"customer\": {\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\"\n  },\n  \"orderType\": \"pickup\",\n  \"items\": [\n    {\n      \"unitPrice\": 5.49,\n      \"totalPrice\": 5.49,\n      \"quantity\": 1,\n      \"name\": \"Large Latte\"\n    },\n    {\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"quantity\": 1,\n      \"name\": \"Blueberry Muffin\"\n    }\n  ]\n}"
}
[2025-11-04 05:55:30.116] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "4daeb867-6ac9-45f0-81f9-f9f8fd063564"
}
[2025-11-04 05:55:30.117] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 2,
  "hasTotals": true,
  "hasPayment": true,
  "originalFields": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items"
  ]
}
[2025-11-04 05:55:30.117] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-20251104055530-005",
    "payment": {
      "method": "mobile_payment",
      "status": "completed"
    },
    "totals": {
      "subtotal": 9.48,
      "tax": 0.76,
      "total": 11.74,
      "tip": 1.5
    },
    "customer": {
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "orderType": "pickup",
    "items": [
      {
        "unitPrice": 5.49,
        "totalPrice": 5.49,
        "quantity": 1,
        "name": "Large Latte"
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin"
      }
    ]
  }
}
[2025-11-04 05:55:30.129] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:55:30.130] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "payment",
    "totals",
    "customer",
    "orderType",
    "items"
  ],
  "beforeSample": "{\"orderId\":\"ORD-20251104055530-005\",\"payment\":{\"method\":\"mobile_payment\",\"status\":\"completed\"},\"totals\":{\"subtotal\":9.48,\"tax\":0.76,\"total\":11.74,\"tip\":1.5},\"customer\":{\"name\":\"Emma Wilson\",\"phone\":\"5...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-20251104055530-005\",\"externalOrderId\":\"ORD-20251104055530-005\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Emma Wilson\",\"phone\":\"555-0505\",\"email\":null,\"address\":null},\"orderType...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 2,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:55:30.130] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-20251104055530-005",
    "externalOrderId": "ORD-20251104055530-005",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Emma Wilson",
      "phone": "555-0505",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:55:30.129Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Large Latte",
        "quantity": 1,
        "unitPrice": 5.49,
        "totalPrice": 5.49,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": null,
        "name": "Blueberry Muffin",
        "quantity": 1,
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 9.48,
      "tax": 0.76,
      "tip": 1.5,
      "discount": 0,
      "deliveryFee": 0,
      "total": 11.74
    },
    "payment": {
      "method": "mobile_payment",
      "status": "completed",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:55:30.132] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-20251104055530-005",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 2,
    "totalAmount": 11.74,
    "paymentStatus": "completed",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Large Latte",
      "quantity": 1,
      "unitPrice": 5.49,
      "hasModifiers": false,
      "modifierCount": 0
    },
    {
      "index": 1,
      "name": "Blueberry Muffin",
      "quantity": 1,
      "unitPrice": 3.99,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 9.48,
    "tax": 0.76,
    "tip": 1.5,
    "total": 11.74,
    "calculatedTotal": 11.74
  }
}
[2025-11-04 05:55:30.132] INFO: Creating enhanced order ORD-20251104055530-005
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-20251104055530-005",
  "externalOrderId": "ORD-20251104055530-005",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 2,
  "total": 11.74,
  "paymentStatus": "completed"
}
[2025-11-04 05:55:30.133] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1265,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-20251104055530-005\",\n  \"externalOrderId\": \"ORD-20251104055530-005\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Emma Wilson\",\n    \"phone\": \"555-0505\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:55:30.129Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Large Latte\",\n      \"quantity\": 1,\n      \"unitPrice\": 5.49,\n      \"totalPrice\": 5.49,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    },\n    {\n      \"itemId\": null,\n      \"name\": \"Blueberry Muffin\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.99,\n      \"totalPrice\": 3.99,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 9.48,\n    \"tax\": 0.76,\n    \"tip\": 1.5,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 11.74\n  },\n  \"payment\": {\n    \"method\": \"mobile_payment\",\n    \"status\": \"completed\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\"... [TRUNCATED]"
}
[2025-11-04 05:55:30.134] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-20251104055530-005",
  "idempotencyKey": "4daeb867-6ac9-45f0-81f9-f9f8fd063564",
  "hasCustomer": true,
  "itemCount": 2,
  "totalAmount": 11.74
}
[2025-11-04 05:55:30.134] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4daeb867-6ac9-45f0-81f9-f9f8fd063564"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:30.144] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4daeb867-6ac9-45f0-81f9-f9f8fd063564"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:55:30.144] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "c58ac83c-c59e-472e-8194-a5a5de0e6013",
  "publicOrderId": "ORD-20251104055530-005"
}
[2025-11-04 05:55:30.144] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "c58ac83c-c59e-472e-8194-a5a5de0e6013",
  "orderId": "ORD-20251104055530-005",
  "externalOrderId": "ORD-20251104055530-005",
  "customer": {
    "name": "Emma Wilson",
    "phone": "555-0505",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 9.48,
    "tax": 0.76,
    "tip": 1.5,
    "discount": 0,
    "deliveryFee": 0,
    "total": 11.74
  }
}
[2025-11-04 05:55:30.150] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c58ac83c-c59e-472e-8194-a5a5de0e6013",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055530-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055530-005",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "4daeb867-6ac9-45f0-81f9-f9f8fd063564",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:30.129Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 9.48,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.76,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 11.74,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:55:30.151] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:30.151] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:55:30.153] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c58ac83c-c59e-472e-8194-a5a5de0e6013"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-20251104055530-005"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-20251104055530-005"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "4daeb867-6ac9-45f0-81f9-f9f8fd063564"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Emma Wilson"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0505"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:55:30.129Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 9.48
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.76
    },
    {
      "index": 14,
      "type": "number",
      "value": 1.5
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 11.74
    },
    {
      "index": 18,
      "type": "string",
      "value": "mobile_payment"
    },
    {
      "index": 19,
      "type": "string",
      "value": "completed"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:55:30.154] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 11,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 11,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 21,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:30.154] ERROR: ‚ùå SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c58ac83c-c59e-472e-8194-a5a5de0e6013',\n  'ORD-20251104055530-005',\n  'ORD-20251104055530-005',\n  'NYC-DELI-001',\n  '4daeb867-6ac9-45f0-81f9-f9f8fd063564',\n  'Emma Wilson',\n  '555-0505',\n  null,\n  null,\n  'pickup',\n  '2025-11-04T05:55:30.129Z',\n  null,\n  9.48,\n  0.76,\n  1.5,\n  0,\n  0,\n  11.74,\n  'mobile_payment',\n  'completed',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "sqliteError": "SQLITE_CONSTRAINT",
  "serviceProcessingTime": "21ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-20251104055530-005",
    "externalOrderId": "ORD-20251104055530-005",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 2,
    "hasTotals": true,
    "totalAmount": 11.74
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query",
    "errorCode": "SQLITE_CONSTRAINT",
    "errorErrno": 19
  }
}
[2025-11-04 05:55:30.181] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 16,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 19,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 66,
      "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')"
    }
  ]
}
[2025-11-04 05:55:30.181] ERROR: ‚ùå ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c58ac83c-c59e-472e-8194-a5a5de0e6013',\n  'ORD-20251104055530-005',\n  'ORD-20251104055530-005',\n  'NYC-DELI-001',\n  '4daeb867-6ac9-45f0-81f9-f9f8fd063564',\n  'Emma Wilson',\n  '555-0505',\n  null,\n  null,\n  'pickup',\n  '2025-11-04T05:55:30.129Z',\n  null,\n  9.48,\n  0.76,\n  1.5,\n  0,\n  0,\n  11.74,\n  'mobile_payment',\n  'completed',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "processingTime": "66ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "payment",
      "totals",
      "customer",
      "orderType",
      "items"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json",
    "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-04 05:55:30.189] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')",
  "stack": "Error: SQLITE_CONSTRAINT: CHECK constraint failed: payment_status IN ('pending', 'authorized', 'captured', 'failed')\n--> in Statement#run([\n  'c58ac83c-c59e-472e-8194-a5a5de0e6013',\n  'ORD-20251104055530-005',\n  'ORD-20251104055530-005',\n  'NYC-DELI-001',\n  '4daeb867-6ac9-45f0-81f9-f9f8fd063564',\n  'Emma Wilson',\n  '555-0505',\n  null,\n  null,\n  'pickup',\n  '2025-11-04T05:55:30.129Z',\n  null,\n  9.48,\n  0.76,\n  1.5,\n  0,\n  0,\n  11.74,\n  'mobile_payment',\n  'completed',\n  null,\n  0,\n  '',\n  'received',\n  'api',\n  null,\n  null,\n  null\n], [Function (anonymous)])\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:76:19)\n    at Database.<anonymous> (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\node_modules\\sqlite3\\lib\\sqlite3.js:20:19)\n    at C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:27:8\n    at new Promise (<anonymous>)\n    at Object.run (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\config\\database-sqlite.js:26:10)\n    at OrderService.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\services\\orderService.js:184:42)\n    at async OrderController.createOrder (C:\\Users\\James\\Documents\\Workspace\\OrderGatewayAPI\\src\\controllers\\orderController.js:305:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "body": {
    "orderId": "ORD-20251104055530-005",
    "payment": {
      "method": "mobile_payment",
      "status": "completed"
    },
    "totals": {
      "subtotal": 9.48,
      "tax": 0.76,
      "total": 11.74,
      "tip": 1.5
    },
    "customer": {
      "name": "Emma Wilson",
      "phone": "555-0505"
    },
    "orderType": "pickup",
    "items": [
      {
        "unitPrice": 5.49,
        "totalPrice": 5.49,
        "quantity": 1,
        "name": "Large Latte"
      },
      {
        "unitPrice": 3.99,
        "totalPrice": 3.99,
        "quantity": 1,
        "name": "Blueberry Muffin"
      }
    ]
  }
}
[2025-11-04 05:57:49.616] INFO: GET /health
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:58:13.335] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:58:13.344] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:58:13.345] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "569"
  },
  "query": {},
  "params": {},
  "bodySize": 212,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 05:58:13.346] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 314,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"SIMPLE-001\",\n  \"totals\": {\n    \"subtotal\": 5,\n    \"tax\": 0.4,\n    \"total\": 5.4\n  },\n  \"orderType\": \"pickup\",\n  \"customer\": {\n    \"name\": \"Test User\",\n    \"phone\": \"555-9999\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 5,\n      \"totalPrice\": 5,\n      \"quantity\": 1,\n      \"name\": \"Coffee\"\n    }\n  ]\n}"
}
[2025-11-04 05:58:13.346] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 314,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"SIMPLE-001\",\n  \"totals\": {\n    \"subtotal\": 5,\n    \"tax\": 0.4,\n    \"total\": 5.4\n  },\n  \"orderType\": \"pickup\",\n  \"customer\": {\n    \"name\": \"Test User\",\n    \"phone\": \"555-9999\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 5,\n      \"totalPrice\": 5,\n      \"quantity\": 1,\n      \"name\": \"Coffee\"\n    }\n  ]\n}"
}
[2025-11-04 05:58:13.348] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "be6635bf-469d-44f8-823f-315023752869"
}
[2025-11-04 05:58:13.348] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ]
}
[2025-11-04 05:58:13.349] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "SIMPLE-001",
    "totals": {
      "subtotal": 5,
      "tax": 0.4,
      "total": 5.4
    },
    "orderType": "pickup",
    "customer": {
      "name": "Test User",
      "phone": "555-9999"
    },
    "items": [
      {
        "unitPrice": 5,
        "totalPrice": 5,
        "quantity": 1,
        "name": "Coffee"
      }
    ]
  }
}
[2025-11-04 05:58:13.350] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 05:58:13.351] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "beforeSample": "{\"orderId\":\"SIMPLE-001\",\"totals\":{\"subtotal\":5,\"tax\":0.4,\"total\":5.4},\"orderType\":\"pickup\",\"customer\":{\"name\":\"Test User\",\"phone\":\"555-9999\"},\"items\":[{\"unitPrice\":5,\"totalPrice\":5,\"quantity\":1,\"name\"...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"SIMPLE-001\",\"externalOrderId\":\"SIMPLE-001\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test User\",\"phone\":\"555-9999\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"orderTime\":\"20...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 05:58:13.351] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "SIMPLE-001",
    "externalOrderId": "SIMPLE-001",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test User",
      "phone": "555-9999",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T05:58:13.351Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 5,
        "totalPrice": 5,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 5,
      "tax": 0.4,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 5.4
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 05:58:13.351] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "SIMPLE-001",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 5.4,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 5,
    "tax": 0.4,
    "tip": 0,
    "total": 5.4,
    "calculatedTotal": 5.4
  }
}
[2025-11-04 05:58:13.352] INFO: Creating enhanced order SIMPLE-001
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "SIMPLE-001",
  "externalOrderId": "SIMPLE-001",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 5.4,
  "paymentStatus": "pending"
}
[2025-11-04 05:58:13.352] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1008,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"SIMPLE-001\",\n  \"externalOrderId\": \"SIMPLE-001\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test User\",\n    \"phone\": \"555-9999\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T05:58:13.351Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 5,\n      \"totalPrice\": 5,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 5,\n    \"tax\": 0.4,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 5.4\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"hasWebhookMetadata\": fal... [TRUNCATED]"
}
[2025-11-04 05:58:13.352] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "SIMPLE-001",
  "idempotencyKey": "be6635bf-469d-44f8-823f-315023752869",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 5.4
}
[2025-11-04 05:58:13.352] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "be6635bf-469d-44f8-823f-315023752869"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:58:13.354] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "be6635bf-469d-44f8-823f-315023752869"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 05:58:13.354] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "f391f56e-fee8-471b-b282-471ab73206a8",
  "publicOrderId": "SIMPLE-001"
}
[2025-11-04 05:58:13.354] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "f391f56e-fee8-471b-b282-471ab73206a8",
  "orderId": "SIMPLE-001",
  "externalOrderId": "SIMPLE-001",
  "customer": {
    "name": "Test User",
    "phone": "555-9999",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 5,
    "tax": 0.4,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 5.4
  }
}
[2025-11-04 05:58:13.354] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "f391f56e-fee8-471b-b282-471ab73206a8",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "SIMPLE-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "SIMPLE-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "be6635bf-469d-44f8-823f-315023752869",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test User",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-9999",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:58:13.351Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 5,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.4,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 5.4,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 05:58:13.355] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:58:13.355] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:58:13.355] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "f391f56e-fee8-471b-b282-471ab73206a8"
    },
    {
      "index": 1,
      "type": "string",
      "value": "SIMPLE-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "SIMPLE-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "be6635bf-469d-44f8-823f-315023752869"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test User"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-9999"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:58:13.351Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 5
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.4
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 5.4
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:58:13.372] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "f391f56e-fee8-471b-b282-471ab73206a8"
    },
    {
      "index": 1,
      "type": "string",
      "value": "SIMPLE-001"
    },
    {
      "index": 2,
      "type": "string",
      "value": "SIMPLE-001"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "be6635bf-469d-44f8-823f-315023752869"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test User"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-9999"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T05:58:13.351Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 5
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.4
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 5.4
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 4
  }
}
[2025-11-04 05:58:13.373] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "f391f56e-fee8-471b-b282-471ab73206a8",
  "orderId": "SIMPLE-001",
  "changes": 1,
  "lastID": 4
}
[2025-11-04 05:58:13.373] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:58:13.378] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 1,
  "items": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 05:58:13.378] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "ab6992c0-9629-4c1e-89c8-021b9ed83b39"
    },
    {
      "index": 1,
      "type": "string",
      "value": "f391f56e-fee8-471b-b282-471ab73206a8"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Coffee"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 5
    },
    {
      "index": 6,
      "type": "number",
      "value": 5
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 05:58:13.395] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "ab6992c0-9629-4c1e-89c8-021b9ed83b39"
    },
    {
      "index": 1,
      "type": "string",
      "value": "f391f56e-fee8-471b-b282-471ab73206a8"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Coffee"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 5
    },
    {
      "index": 6,
      "type": "number",
      "value": 5
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 6
  }
}
[2025-11-04 05:58:13.395] INFO: Inserted 1 items for order SIMPLE-001
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:58:13.424] INFO: Order created successfully: SIMPLE-001
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 05:58:13.439] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 21,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 43,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 72,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 86,
      "error": null
    }
  ]
}
[2025-11-04 05:58:13.439] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "SIMPLE-001",
  "totalServiceTime": "87ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "SIMPLE-001",
    "itemCount": 1,
    "totalAmount": 5.4,
    "status": "received"
  }
}
[2025-11-04 05:58:13.439] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 94,
      "error": null
    }
  ]
}
[2025-11-04 05:58:13.439] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "SIMPLE-001",
  "totalProcessingTime": "94ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 1,
    "totalAmount": 5.4,
    "status": "received"
  }
}
[2025-11-04 05:59:14.971] INFO: GET /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 05:59:15.032] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 05:59:15.057] INFO: Retrieving all orders
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "limit": 10,
  "offset": 0
}
[2025-11-04 06:02:17.856] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:02:17.857] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 06:04:22.512] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:04:22.517] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:04:22.545] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "577",
    "connection": "Keep-Alive"
  },
  "query": {},
  "params": {},
  "bodySize": 220,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 06:04:22.545] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 322,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-1\",\n  \"totals\": {\n    \"subtotal\": 11,\n    \"tax\": 0.88,\n    \"total\": 11.88\n  },\n  \"orderType\": \"delivery\",\n  \"customer\": {\n    \"name\": \"Customer 1\",\n    \"phone\": \"555-0001\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 11,\n      \"totalPrice\": 11,\n      \"quantity\": 1,\n      \"name\": \"Item 1\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:22.545] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 322,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-1\",\n  \"totals\": {\n    \"subtotal\": 11,\n    \"tax\": 0.88,\n    \"total\": 11.88\n  },\n  \"orderType\": \"delivery\",\n  \"customer\": {\n    \"name\": \"Customer 1\",\n    \"phone\": \"555-0001\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 11,\n      \"totalPrice\": 11,\n      \"quantity\": 1,\n      \"name\": \"Item 1\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:22.546] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "2c98e4d9-968e-444e-8d42-01fbadb7bc09"
}
[2025-11-04 06:04:22.546] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ]
}
[2025-11-04 06:04:22.546] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-NEW-1",
    "totals": {
      "subtotal": 11,
      "tax": 0.88,
      "total": 11.88
    },
    "orderType": "delivery",
    "customer": {
      "name": "Customer 1",
      "phone": "555-0001"
    },
    "items": [
      {
        "unitPrice": 11,
        "totalPrice": 11,
        "quantity": 1,
        "name": "Item 1"
      }
    ]
  }
}
[2025-11-04 06:04:22.553] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 06:04:22.553] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "beforeSample": "{\"orderId\":\"ORD-NEW-1\",\"totals\":{\"subtotal\":11,\"tax\":0.88,\"total\":11.88},\"orderType\":\"delivery\",\"customer\":{\"name\":\"Customer 1\",\"phone\":\"555-0001\"},\"items\":[{\"unitPrice\":11,\"totalPrice\":11,\"quantity\":...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-NEW-1\",\"externalOrderId\":\"ORD-NEW-1\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Customer 1\",\"phone\":\"555-0001\",\"email\":null,\"address\":null},\"orderType\":\"delivery\",\"orderTime\":\"2...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 06:04:22.553] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-NEW-1",
    "externalOrderId": "ORD-NEW-1",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Customer 1",
      "phone": "555-0001",
      "email": null,
      "address": null
    },
    "orderType": "delivery",
    "orderTime": "2025-11-04T06:04:22.553Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Item 1",
        "quantity": 1,
        "unitPrice": 11,
        "totalPrice": 11,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 11,
      "tax": 0.88,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 11.88
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 06:04:22.556] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-NEW-1",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "delivery",
    "itemCount": 1,
    "totalAmount": 11.88,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Item 1",
      "quantity": 1,
      "unitPrice": 11,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 11,
    "tax": 0.88,
    "tip": 0,
    "total": 11.88,
    "calculatedTotal": 11.88
  }
}
[2025-11-04 06:04:22.556] INFO: Creating enhanced order ORD-NEW-1
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-NEW-1",
  "externalOrderId": "ORD-NEW-1",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "delivery",
  "requestedTime": null,
  "itemCount": 1,
  "total": 11.88,
  "paymentStatus": "pending"
}
[2025-11-04 06:04:22.558] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1015,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-1\",\n  \"externalOrderId\": \"ORD-NEW-1\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Customer 1\",\n    \"phone\": \"555-0001\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"delivery\",\n  \"orderTime\": \"2025-11-04T06:04:22.553Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Item 1\",\n      \"quantity\": 1,\n      \"unitPrice\": 11,\n      \"totalPrice\": 11,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 11,\n    \"tax\": 0.88,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 11.88\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"hasWebhookMetadat... [TRUNCATED]"
}
[2025-11-04 06:04:22.559] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-1",
  "idempotencyKey": "2c98e4d9-968e-444e-8d42-01fbadb7bc09",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 11.88
}
[2025-11-04 06:04:22.559] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2c98e4d9-968e-444e-8d42-01fbadb7bc09"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:22.561] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2c98e4d9-968e-444e-8d42-01fbadb7bc09"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 06:04:22.561] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "5e7a0566-db1c-4a08-9043-119d29e70e4b",
  "publicOrderId": "ORD-NEW-1"
}
[2025-11-04 06:04:22.562] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "5e7a0566-db1c-4a08-9043-119d29e70e4b",
  "orderId": "ORD-NEW-1",
  "externalOrderId": "ORD-NEW-1",
  "customer": {
    "name": "Customer 1",
    "phone": "555-0001",
    "email": null,
    "address": null
  },
  "orderType": "delivery",
  "totals": {
    "subtotal": 11,
    "tax": 0.88,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 11.88
  }
}
[2025-11-04 06:04:22.563] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "5e7a0566-db1c-4a08-9043-119d29e70e4b",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-1",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-1",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "2c98e4d9-968e-444e-8d42-01fbadb7bc09",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 1",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:22.553Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 11,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 11.88,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 06:04:22.565] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:22.565] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:22.565] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "5e7a0566-db1c-4a08-9043-119d29e70e4b"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-1"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "2c98e4d9-968e-444e-8d42-01fbadb7bc09"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 1"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0001"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:22.553Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 11
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.88
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 11.88
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:22.594] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "5e7a0566-db1c-4a08-9043-119d29e70e4b"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-1"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "2c98e4d9-968e-444e-8d42-01fbadb7bc09"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 1"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0001"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "delivery"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:22.553Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 11
    },
    {
      "index": 13,
      "type": "number",
      "value": 0.88
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 11.88
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 5
  }
}
[2025-11-04 06:04:22.594] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "5e7a0566-db1c-4a08-9043-119d29e70e4b",
  "orderId": "ORD-NEW-1",
  "changes": 1,
  "lastID": 5
}
[2025-11-04 06:04:22.594] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:22.596] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 1,
  "items": [
    {
      "index": 0,
      "name": "Item 1",
      "quantity": 1,
      "unitPrice": 11,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 06:04:22.596] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "345c2b1c-d42f-44da-b17b-9a64c3fa5bb2"
    },
    {
      "index": 1,
      "type": "string",
      "value": "5e7a0566-db1c-4a08-9043-119d29e70e4b"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 1"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 11
    },
    {
      "index": 6,
      "type": "number",
      "value": 11
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:22.610] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "345c2b1c-d42f-44da-b17b-9a64c3fa5bb2"
    },
    {
      "index": 1,
      "type": "string",
      "value": "5e7a0566-db1c-4a08-9043-119d29e70e4b"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 1"
    },
    {
      "index": 4,
      "type": "number",
      "value": 1
    },
    {
      "index": 5,
      "type": "number",
      "value": 11
    },
    {
      "index": 6,
      "type": "number",
      "value": 11
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 7
  }
}
[2025-11-04 06:04:22.610] INFO: Inserted 1 items for order ORD-NEW-1
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:22.611] INFO: Order created successfully: ORD-NEW-1
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:22.613] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 36,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 52,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 53,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 55,
      "error": null
    }
  ]
}
[2025-11-04 06:04:22.613] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-1",
  "totalServiceTime": "55ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "ORD-NEW-1",
    "itemCount": 1,
    "totalAmount": 11.88,
    "status": "received"
  }
}
[2025-11-04 06:04:22.614] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 9,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 14,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 69,
      "error": null
    }
  ]
}
[2025-11-04 06:04:22.614] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-1",
  "totalProcessingTime": "69ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 1,
    "totalAmount": 11.88,
    "status": "received"
  }
}
[2025-11-04 06:04:23.134] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:04:23.141] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:04:23.142] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "576"
  },
  "query": {},
  "params": {},
  "bodySize": 219,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 06:04:23.143] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 321,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-2\",\n  \"totals\": {\n    \"subtotal\": 24,\n    \"tax\": 1.92,\n    \"total\": 25.92\n  },\n  \"orderType\": \"dine-in\",\n  \"customer\": {\n    \"name\": \"Customer 2\",\n    \"phone\": \"555-0002\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 12,\n      \"totalPrice\": 24,\n      \"quantity\": 2,\n      \"name\": \"Item 2\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:23.143] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 321,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-2\",\n  \"totals\": {\n    \"subtotal\": 24,\n    \"tax\": 1.92,\n    \"total\": 25.92\n  },\n  \"orderType\": \"dine-in\",\n  \"customer\": {\n    \"name\": \"Customer 2\",\n    \"phone\": \"555-0002\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 12,\n      \"totalPrice\": 24,\n      \"quantity\": 2,\n      \"name\": \"Item 2\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:23.149] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "9d63ce09-ac14-454a-9a42-1a081d0b0c64"
}
[2025-11-04 06:04:23.149] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ]
}
[2025-11-04 06:04:23.167] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-NEW-2",
    "totals": {
      "subtotal": 24,
      "tax": 1.92,
      "total": 25.92
    },
    "orderType": "dine-in",
    "customer": {
      "name": "Customer 2",
      "phone": "555-0002"
    },
    "items": [
      {
        "unitPrice": 12,
        "totalPrice": 24,
        "quantity": 2,
        "name": "Item 2"
      }
    ]
  }
}
[2025-11-04 06:04:23.183] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 06:04:23.184] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "beforeSample": "{\"orderId\":\"ORD-NEW-2\",\"totals\":{\"subtotal\":24,\"tax\":1.92,\"total\":25.92},\"orderType\":\"dine-in\",\"customer\":{\"name\":\"Customer 2\",\"phone\":\"555-0002\"},\"items\":[{\"unitPrice\":12,\"totalPrice\":24,\"quantity\":2...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-NEW-2\",\"externalOrderId\":\"ORD-NEW-2\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Customer 2\",\"phone\":\"555-0002\",\"email\":null,\"address\":null},\"orderType\":\"dine-in\",\"orderTime\":\"20...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 06:04:23.184] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-NEW-2",
    "externalOrderId": "ORD-NEW-2",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Customer 2",
      "phone": "555-0002",
      "email": null,
      "address": null
    },
    "orderType": "dine-in",
    "orderTime": "2025-11-04T06:04:23.184Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Item 2",
        "quantity": 2,
        "unitPrice": 12,
        "totalPrice": 24,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 24,
      "tax": 1.92,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 25.92
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 06:04:23.190] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-NEW-2",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "dine-in",
    "itemCount": 1,
    "totalAmount": 25.92,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Item 2",
      "quantity": 2,
      "unitPrice": 12,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 24,
    "tax": 1.92,
    "tip": 0,
    "total": 25.92,
    "calculatedTotal": 25.92
  }
}
[2025-11-04 06:04:23.190] INFO: Creating enhanced order ORD-NEW-2
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-NEW-2",
  "externalOrderId": "ORD-NEW-2",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "dine-in",
  "requestedTime": null,
  "itemCount": 1,
  "total": 25.92,
  "paymentStatus": "pending"
}
[2025-11-04 06:04:23.193] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1014,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-2\",\n  \"externalOrderId\": \"ORD-NEW-2\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Customer 2\",\n    \"phone\": \"555-0002\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"dine-in\",\n  \"orderTime\": \"2025-11-04T06:04:23.184Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Item 2\",\n      \"quantity\": 2,\n      \"unitPrice\": 12,\n      \"totalPrice\": 24,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 24,\n    \"tax\": 1.92,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 25.92\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"hasWebhookMetadata... [TRUNCATED]"
}
[2025-11-04 06:04:23.195] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-2",
  "idempotencyKey": "9d63ce09-ac14-454a-9a42-1a081d0b0c64",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 25.92
}
[2025-11-04 06:04:23.195] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "9d63ce09-ac14-454a-9a42-1a081d0b0c64"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.196] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "9d63ce09-ac14-454a-9a42-1a081d0b0c64"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 06:04:23.197] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "798fcabd-bd2f-4690-83ea-541b9482b698",
  "publicOrderId": "ORD-NEW-2"
}
[2025-11-04 06:04:23.197] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "798fcabd-bd2f-4690-83ea-541b9482b698",
  "orderId": "ORD-NEW-2",
  "externalOrderId": "ORD-NEW-2",
  "customer": {
    "name": "Customer 2",
    "phone": "555-0002",
    "email": null,
    "address": null
  },
  "orderType": "dine-in",
  "totals": {
    "subtotal": 24,
    "tax": 1.92,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 25.92
  }
}
[2025-11-04 06:04:23.199] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "798fcabd-bd2f-4690-83ea-541b9482b698",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-2",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-2",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "9d63ce09-ac14-454a-9a42-1a081d0b0c64",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 2",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0002",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.184Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 24,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.92,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 25.92,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 06:04:23.213] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.214] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.215] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "798fcabd-bd2f-4690-83ea-541b9482b698"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-2"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-2"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "9d63ce09-ac14-454a-9a42-1a081d0b0c64"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 2"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0002"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.184Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 24
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.92
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 25.92
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.246] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "798fcabd-bd2f-4690-83ea-541b9482b698"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-2"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-2"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "9d63ce09-ac14-454a-9a42-1a081d0b0c64"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 2"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0002"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "dine-in"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.184Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 24
    },
    {
      "index": 13,
      "type": "number",
      "value": 1.92
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 25.92
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 6
  }
}
[2025-11-04 06:04:23.246] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "798fcabd-bd2f-4690-83ea-541b9482b698",
  "orderId": "ORD-NEW-2",
  "changes": 1,
  "lastID": 6
}
[2025-11-04 06:04:23.247] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.262] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 1,
  "items": [
    {
      "index": 0,
      "name": "Item 2",
      "quantity": 2,
      "unitPrice": 12,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 06:04:23.263] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2d4d04d6-69d1-4ee5-9215-209952907559"
    },
    {
      "index": 1,
      "type": "string",
      "value": "798fcabd-bd2f-4690-83ea-541b9482b698"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 2"
    },
    {
      "index": 4,
      "type": "number",
      "value": 2
    },
    {
      "index": 5,
      "type": "number",
      "value": 12
    },
    {
      "index": 6,
      "type": "number",
      "value": 24
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.281] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2d4d04d6-69d1-4ee5-9215-209952907559"
    },
    {
      "index": 1,
      "type": "string",
      "value": "798fcabd-bd2f-4690-83ea-541b9482b698"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 2"
    },
    {
      "index": 4,
      "type": "number",
      "value": 2
    },
    {
      "index": 5,
      "type": "number",
      "value": 12
    },
    {
      "index": 6,
      "type": "number",
      "value": 24
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 8
  }
}
[2025-11-04 06:04:23.281] INFO: Inserted 1 items for order ORD-NEW-2
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.283] INFO: Order created successfully: ORD-NEW-2
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.306] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 53,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 88,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 90,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 112,
      "error": null
    }
  ]
}
[2025-11-04 06:04:23.307] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-2",
  "totalServiceTime": "114ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "ORD-NEW-2",
    "itemCount": 1,
    "totalAmount": 25.92,
    "status": "received"
  }
}
[2025-11-04 06:04:23.307] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 3,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 42,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 51,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 165,
      "error": null
    }
  ]
}
[2025-11-04 06:04:23.307] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-2",
  "totalProcessingTime": "165ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 1,
    "totalAmount": 25.92,
    "status": "received"
  }
}
[2025-11-04 06:04:23.832] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:04:23.841] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:04:23.849] DEBUG: üì® REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "user-agent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
    "host": "localhost:3000",
    "content-length": "588"
  },
  "query": {},
  "params": {},
  "bodySize": 231,
  "bodyType": "object",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-04 06:04:23.849] DEBUG: üîç PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 333,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-3\",\n  \"totals\": {\n    \"subtotal\": 39,\n    \"tax\": 3.12,\n    \"total\": 42.120000000000005\n  },\n  \"orderType\": \"pickup\",\n  \"customer\": {\n    \"name\": \"Customer 3\",\n    \"phone\": \"555-0003\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 13,\n      \"totalPrice\": 39,\n      \"quantity\": 3,\n      \"name\": \"Item 3\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:23.850] DEBUG: üîç PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 333,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-3\",\n  \"totals\": {\n    \"subtotal\": 39,\n    \"tax\": 3.12,\n    \"total\": 42.120000000000005\n  },\n  \"orderType\": \"pickup\",\n  \"customer\": {\n    \"name\": \"Customer 3\",\n    \"phone\": \"555-0003\"\n  },\n  \"items\": [\n    {\n      \"unitPrice\": 13,\n      \"totalPrice\": 39,\n      \"quantity\": 3,\n      \"name\": \"Item 3\"\n    }\n  ]\n}"
}
[2025-11-04 06:04:23.850] DEBUG: üîë Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "183e2c17-b8d6-4783-99ee-75ea18d37b2a"
}
[2025-11-04 06:04:23.850] DEBUG: üìä ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ]
}
[2025-11-04 06:04:23.850] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-NEW-3",
    "totals": {
      "subtotal": 39,
      "tax": 3.12,
      "total": 42.120000000000005
    },
    "orderType": "pickup",
    "customer": {
      "name": "Customer 3",
      "phone": "555-0003"
    },
    "items": [
      {
        "unitPrice": 13,
        "totalPrice": 39,
        "quantity": 3,
        "name": "Item 3"
      }
    ]
  }
}
[2025-11-04 06:04:23.866] DEBUG: üìã PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-04 06:04:23.867] DEBUG: üîÑ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "totals",
    "orderType",
    "customer",
    "items"
  ],
  "beforeSample": "{\"orderId\":\"ORD-NEW-3\",\"totals\":{\"subtotal\":39,\"tax\":3.12,\"total\":42.120000000000005},\"orderType\":\"pickup\",\"customer\":{\"name\":\"Customer 3\",\"phone\":\"555-0003\"},\"items\":[{\"unitPrice\":13,\"totalPrice\":39,...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-NEW-3\",\"externalOrderId\":\"ORD-NEW-3\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Customer 3\",\"phone\":\"555-0003\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"orderTime\":\"202...",
  "transformationDetails": {
    "fieldsGenerated": [
      "externalOrderId"
    ],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-04 06:04:23.876] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-NEW-3",
    "externalOrderId": "ORD-NEW-3",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Customer 3",
      "phone": "555-0003",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-04T06:04:23.866Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Item 3",
        "quantity": 3,
        "unitPrice": 13,
        "totalPrice": 39,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 39,
      "tax": 3.12,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 42.120000000000005
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-04 06:04:23.882] DEBUG: üìã PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-NEW-3",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 42.120000000000005,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Item 3",
      "quantity": 3,
      "unitPrice": 13,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 39,
    "tax": 3.12,
    "tip": 0,
    "total": 42.120000000000005,
    "calculatedTotal": 42.12
  }
}
[2025-11-04 06:04:23.882] INFO: Creating enhanced order ORD-NEW-3
{
  "service": "pos-order-gateway-api",
  "client": "Mobile App",
  "orderId": "ORD-NEW-3",
  "externalOrderId": "ORD-NEW-3",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 42.120000000000005,
  "paymentStatus": "pending"
}
[2025-11-04 06:04:23.884] DEBUG: üîç PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1026,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-NEW-3\",\n  \"externalOrderId\": \"ORD-NEW-3\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Customer 3\",\n    \"phone\": \"555-0003\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-04T06:04:23.866Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": null,\n      \"name\": \"Item 3\",\n      \"quantity\": 3,\n      \"unitPrice\": 13,\n      \"totalPrice\": 39,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 39,\n    \"tax\": 3.12,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 42.120000000000005\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"hasWeb... [TRUNCATED]"
}
[2025-11-04 06:04:23.885] DEBUG: üîß SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-3",
  "idempotencyKey": "183e2c17-b8d6-4783-99ee-75ea18d37b2a",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 42.120000000000005
}
[2025-11-04 06:04:23.885] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "183e2c17-b8d6-4783-99ee-75ea18d37b2a"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.899] DEBUG: üóÑÔ∏è DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "183e2c17-b8d6-4783-99ee-75ea18d37b2a"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-04 06:04:23.900] DEBUG: üÜî Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "2ff89368-1a3f-469f-932b-a7865ec453fe",
  "publicOrderId": "ORD-NEW-3"
}
[2025-11-04 06:04:23.901] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "2ff89368-1a3f-469f-932b-a7865ec453fe",
  "orderId": "ORD-NEW-3",
  "externalOrderId": "ORD-NEW-3",
  "customer": {
    "name": "Customer 3",
    "phone": "555-0003",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 39,
    "tax": 3.12,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 42.120000000000005
  }
}
[2025-11-04 06:04:23.917] DEBUG: üíæ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2ff89368-1a3f-469f-932b-a7865ec453fe",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-3",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-3",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "183e2c17-b8d6-4783-99ee-75ea18d37b2a",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 3",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0003",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.866Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 39,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 3.12,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 42.120000000000005,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-04 06:04:23.922] DEBUG: üìä Database columns check: hasNewColumns=true
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.923] DEBUG: ‚úÖ Using enhanced OhMyApp.io database format
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.923] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2ff89368-1a3f-469f-932b-a7865ec453fe"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-3"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-3"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "183e2c17-b8d6-4783-99ee-75ea18d37b2a"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 3"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0003"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.866Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 39
    },
    {
      "index": 13,
      "type": "number",
      "value": 3.12
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 42.120000000000005
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.945] DEBUG: üóÑÔ∏è DATABASE DEBUG - Main Order Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO orders ( id, order_id, external_order_id, restaurant_id, idempotency_key, customer_name, customer_phone, customer_email, customer_address, order_type, order_time, requested_time, subtotal, tax, tip, discount, delivery_fee, total, payment_method, payment_status, payment_transaction_id, payment_amount, notes, status, source, webhook_metadata, original_order_id, webhook_created_at, created_at, updated_at ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'), datetime('now') )",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2ff89368-1a3f-469f-932b-a7865ec453fe"
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-NEW-3"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ORD-NEW-3"
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001"
    },
    {
      "index": 4,
      "type": "string",
      "value": "183e2c17-b8d6-4783-99ee-75ea18d37b2a"
    },
    {
      "index": 5,
      "type": "string",
      "value": "Customer 3"
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-0003"
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "object",
      "value": null
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup"
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-04T06:04:23.866Z"
    },
    {
      "index": 11,
      "type": "object",
      "value": null
    },
    {
      "index": 12,
      "type": "number",
      "value": 39
    },
    {
      "index": 13,
      "type": "number",
      "value": 3.12
    },
    {
      "index": 14,
      "type": "number",
      "value": 0
    },
    {
      "index": 15,
      "type": "number",
      "value": 0
    },
    {
      "index": 16,
      "type": "number",
      "value": 0
    },
    {
      "index": 17,
      "type": "number",
      "value": 42.120000000000005
    },
    {
      "index": 18,
      "type": "object",
      "value": null
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending"
    },
    {
      "index": 20,
      "type": "object",
      "value": null
    },
    {
      "index": 21,
      "type": "number",
      "value": 0
    },
    {
      "index": 22,
      "type": "string",
      "value": ""
    },
    {
      "index": 23,
      "type": "string",
      "value": "received"
    },
    {
      "index": 24,
      "type": "string",
      "value": "api"
    },
    {
      "index": 25,
      "type": "object",
      "value": null
    },
    {
      "index": 26,
      "type": "object",
      "value": null
    },
    {
      "index": 27,
      "type": "object",
      "value": null
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 7
  }
}
[2025-11-04 06:04:23.946] DEBUG: ‚úÖ ORDER RECORD INSERTED
{
  "service": "pos-order-gateway-api",
  "internalId": "2ff89368-1a3f-469f-932b-a7865ec453fe",
  "orderId": "ORD-NEW-3",
  "changes": 1,
  "lastID": 7
}
[2025-11-04 06:04:23.946] INFO: Order main record inserted successfully
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.946] DEBUG: üõí PROCESSING ORDER ITEMS
{
  "service": "pos-order-gateway-api",
  "itemCount": 1,
  "items": [
    {
      "index": 0,
      "name": "Item 3",
      "quantity": 3,
      "unitPrice": 13,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ]
}
[2025-11-04 06:04:23.946] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2bab9618-f180-44b9-80d6-d5a3edbcfb32"
    },
    {
      "index": 1,
      "type": "string",
      "value": "2ff89368-1a3f-469f-932b-a7865ec453fe"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 3"
    },
    {
      "index": 4,
      "type": "number",
      "value": 3
    },
    {
      "index": 5,
      "type": "number",
      "value": 13
    },
    {
      "index": 6,
      "type": "number",
      "value": 39
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": null
}
[2025-11-04 06:04:23.992] DEBUG: üóÑÔ∏è DATABASE DEBUG - Item 1 Insert Result
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO order_items ( id, order_id, item_id, name, quantity, unit_price, total_price, special_instructions, category, created_at ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, datetime('now'))",
  "parameterCount": 9,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "2bab9618-f180-44b9-80d6-d5a3edbcfb32"
    },
    {
      "index": 1,
      "type": "string",
      "value": "2ff89368-1a3f-469f-932b-a7865ec453fe"
    },
    {
      "index": 2,
      "type": "string",
      "value": "ITEM-1"
    },
    {
      "index": 3,
      "type": "string",
      "value": "Item 3"
    },
    {
      "index": 4,
      "type": "number",
      "value": 3
    },
    {
      "index": 5,
      "type": "number",
      "value": 13
    },
    {
      "index": 6,
      "type": "number",
      "value": 39
    },
    {
      "index": 7,
      "type": "object",
      "value": null
    },
    {
      "index": 8,
      "type": "string",
      "value": "General"
    }
  ],
  "resultInfo": {
    "hasRows": 1,
    "changes": 1,
    "lastID": 9
  }
}
[2025-11-04 06:04:23.993] INFO: Inserted 1 items for order ORD-NEW-3
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:23.996] INFO: Order created successfully: ORD-NEW-3
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:04:24.011] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Service Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 7,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 15,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 16,
      "error": null
    },
    {
      "step": 4,
      "description": "Main order record inserted",
      "status": "completed",
      "data": [
        "changes",
        "lastID"
      ],
      "duration": 62,
      "error": null
    },
    {
      "step": 5,
      "description": "Order items processed",
      "status": "completed",
      "data": [
        "itemsInserted"
      ],
      "duration": 109,
      "error": null
    },
    {
      "step": 6,
      "description": "Retrieving created order",
      "status": "in-progress",
      "data": [
        "orderId"
      ],
      "duration": 112,
      "error": null
    },
    {
      "step": 7,
      "description": "Order retrieval completed",
      "status": "completed",
      "data": [
        "hasOrder",
        "orderItemCount"
      ],
      "duration": 127,
      "error": null
    }
  ]
}
[2025-11-04 06:04:24.012] DEBUG: üéØ SERVICE COMPLETION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-3",
  "totalServiceTime": "127ms",
  "stepsCompleted": 7,
  "finalOrder": {
    "id": "ORD-NEW-3",
    "itemCount": 1,
    "totalAmount": 42.120000000000005,
    "status": "received"
  }
}
[2025-11-04 06:04:24.012] DEBUG: üë£ STEP-BY-STEP DEBUG - Order Creation Process
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 27,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 35,
      "error": null
    },
    {
      "step": 6,
      "description": "Order service completed successfully",
      "status": "completed",
      "data": [
        "createdOrderId",
        "serviceResponse"
      ],
      "duration": 163,
      "error": null
    }
  ]
}
[2025-11-04 06:04:24.012] DEBUG: üéâ ORDER CREATION SUCCESS
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-NEW-3",
  "totalProcessingTime": "163ms",
  "stepsCompleted": 6,
  "client": "Mobile App",
  "finalOrderStructure": {
    "hasItems": true,
    "itemCount": 1,
    "totalAmount": 42.120000000000005,
    "status": "received"
  }
}
[2025-11-04 06:05:40.992] INFO: GET /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:05:41.027] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:05:41.061] INFO: Retrieving all orders
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "limit": 10,
  "offset": 0
}
[2025-11-04 06:06:08.866] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:06:08.867] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 06:07:01.425] INFO: GET /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:07:01.440] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:07:01.441] INFO: Retrieving all orders
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "limit": 10,
  "offset": 0
}
[2025-11-04 06:07:26.331] INFO: GET /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:07:26.334] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:07:26.339] INFO: Retrieving all orders
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "limit": 10,
  "offset": 0
}
[2025-11-04 06:08:04.871] INFO: GET /api/v1/logs/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "Mozilla/5.0 (Windows NT; Windows NT 10.0; en-US) WindowsPowerShell/5.1.22000.65"
}
[2025-11-04 06:08:04.905] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/payloads"
}
[2025-11-04 06:09:06.960] INFO: GET /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1",
  "userAgent": "PostmanRuntime/7.49.1"
}
[2025-11-04 06:09:06.983] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-04 06:09:06.984] INFO: Retrieving all orders
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "limit": 10,
  "offset": 0
}
[2025-11-04 06:09:17.476] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-04 06:09:17.489] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
