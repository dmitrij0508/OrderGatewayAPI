[2025-11-06 19:44:03.009] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.033] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.097] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.155] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.169] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.176] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.181] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.219] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.249] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.270] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.306] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.308] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.319] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.323] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.325] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.354] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.377] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.382] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.391] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.395] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.404] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.406] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.410] INFO: âœ… Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.429] INFO: ðŸš€ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.449] INFO: ðŸ“– API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.476] INFO: ðŸ’“ Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.486] INFO: ðŸŒ Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:03.502] INFO: ðŸŽ£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:04.291] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-06 19:44:04.385] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.690] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.729] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.745] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.785] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.795] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.841] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.875] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.924] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.934] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.977] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.985] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:28.991] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.025] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.060] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.098] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.107] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.124] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.135] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.137] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.193] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.199] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.227] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.241] INFO: âœ… Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.283] INFO: ðŸš€ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.310] INFO: ðŸ“– API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.328] INFO: ðŸ’“ Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.334] INFO: ðŸŒ Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:40:29.335] INFO: ðŸŽ£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:44:33.671] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 19:44:33.680] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.816] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.841] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.852] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.873] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.875] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.876] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.878] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.879] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.880] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.881] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.882] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.883] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.884] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.887] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.890] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.894] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.899] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.900] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.901] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.902] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.907] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.907] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.909] INFO: âœ… Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.968] INFO: ðŸš€ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.968] INFO: ðŸ“– API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.969] INFO: ðŸ’“ Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.969] INFO: ðŸŒ Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:43.969] INFO: ðŸŽ£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:47.409] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-07 20:23:47.411] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.072] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.085] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.096] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.113] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.114] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.115] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.116] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.117] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.120] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.121] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.122] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.123] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.125] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.126] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.127] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.130] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.132] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.133] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.136] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.137] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.139] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.139] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.140] INFO: âœ… Database migration completed
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.150] INFO: ðŸš€ Order Gateway API started on port 3000
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.150] INFO: ðŸ“– API Index: http://localhost:3000/api
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.151] INFO: ðŸ’“ Health Check: http://localhost:3000/health
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.154] INFO: ðŸŒ Environment: development
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:26.155] INFO: ðŸŽ£ OhMyApp.io webhook support: ENABLED
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:50.681] INFO: Closing SQLite database...
{
  "service": "pos-order-gateway-api"
}
[2025-11-10 21:52:50.683] INFO: SIGINT received, shutting down gracefully
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:19:54.393] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:19:54.396] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:19:54.524] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:19:54.570] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.574] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-11 05:19:54.504] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:19:54.574] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.578] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-11 05:19:54.584] DEBUG: ðŸ“¨ REQUEST DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:52416",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "116",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 116,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.584] DEBUG: ðŸ” PAYLOAD DEBUG - Save Payload - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 148,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "key",
    "description",
    "source",
    "payload"
  ],
  "payload": "{\n  \"key\": \"jest_sample_1762838394451\",\n  \"description\": \"Jest test payload\",\n  \"source\": \"jest\",\n  \"payload\": {\n    \"foo\": \"bar\",\n    \"n\": 42\n  }\n}"
}
[2025-11-11 05:19:54.585] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762838394451"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-11 05:19:54.588] ERROR: Failed to save payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads"
}
[2025-11-11 05:19:54.591] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads",
  "path": "/api/v1/payloads",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "key": "jest_sample_1762838394451",
    "description": "Jest test payload",
    "source": "jest",
    "payload": {
      "foo": "bar",
      "n": 42
    }
  }
}
[2025-11-11 05:19:54.603] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.604] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-11 05:19:54.616] INFO: GET /api/v1/payloads/jest_sample_1762838394451
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.618] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762838394451"
}
[2025-11-11 05:19:54.648] ERROR: Failed to load payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762838394451' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:33:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-11 05:19:54.650] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762838394451' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:33:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads/jest_sample_1762838394451",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-11 05:19:54.665] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:19:54.667] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-11 05:19:54.675] ERROR: Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:48:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-11 05:19:54.675] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:48:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-11 05:53:02.924] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:53:02.924] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:53:02.996] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:53:03.040] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.045] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-11 05:53:03.049] DEBUG: ðŸ“¨ REQUEST DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:53879",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "116",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 116,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.049] DEBUG: ðŸ” PAYLOAD DEBUG - Save Payload - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 148,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "key",
    "description",
    "source",
    "payload"
  ],
  "payload": "{\n  \"key\": \"jest_sample_1762840382962\",\n  \"description\": \"Jest test payload\",\n  \"source\": \"jest\",\n  \"payload\": {\n    \"foo\": \"bar\",\n    \"n\": 42\n  }\n}"
}
[2025-11-11 05:53:03.050] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762840382962"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-11 05:53:02.996] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-11 05:53:03.040] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.044] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-11 05:53:03.059] ERROR: Failed to save payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads"
}
[2025-11-11 05:53:03.062] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads",
  "path": "/api/v1/payloads",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "key": "jest_sample_1762840382962",
    "description": "Jest test payload",
    "source": "jest",
    "payload": {
      "foo": "bar",
      "n": 42
    }
  }
}
[2025-11-11 05:53:03.070] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.072] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-11 05:53:03.097] INFO: GET /api/v1/payloads/jest_sample_1762840382962
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.100] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762840382962"
}
[2025-11-11 05:53:03.124] ERROR: Failed to load payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762840382962' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:54:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-11 05:53:03.126] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762840382962' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:54:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads/jest_sample_1762840382962",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-11 05:53:03.145] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-11 05:53:03.147] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-11 05:53:03.153] ERROR: Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:69:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-11 05:53:03.155] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:69:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:107:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:06:46.479] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:46.478] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:46.597] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:46.640] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:46.645] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:06:46.650] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762967206522"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 17:06:46.660] ERROR: Failed to save payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads"
}
[2025-11-12 17:06:46.563] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:46.649] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:46.653] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:06:46.664] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads",
  "path": "/api/v1/payloads",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "key": "jest_sample_1762967206522",
    "description": "Jest test payload",
    "source": "jest",
    "payload": {
      "foo": "bar",
      "n": 42
    }
  }
}
[2025-11-12 17:06:46.679] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:46.680] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:06:46.688] INFO: GET /api/v1/payloads/jest_sample_1762967206522
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:46.690] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762967206522"
}
[2025-11-12 17:06:46.712] ERROR: Failed to load payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967206522' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:06:46.716] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967206522' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads/jest_sample_1762967206522",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:06:46.726] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:46.729] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:06:46.736] ERROR: Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:06:46.738] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:06:59.659] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:59.677] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:59.749] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:59.795] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:59.800] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:06:59.771] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:06:59.817] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:59.820] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:06:59.827] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762967219732"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 17:06:59.831] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:59.833] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:06:59.829] ERROR: Failed to save payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads"
}
[2025-11-12 17:06:59.834] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads",
  "path": "/api/v1/payloads",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "key": "jest_sample_1762967219732",
    "description": "Jest test payload",
    "source": "jest",
    "payload": {
      "foo": "bar",
      "n": 42
    }
  }
}
[2025-11-12 17:06:59.865] INFO: GET /api/v1/payloads/jest_sample_1762967219732
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:59.867] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762967219732"
}
[2025-11-12 17:06:59.900] ERROR: Failed to load payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967219732' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:06:59.901] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967219732' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads/jest_sample_1762967219732",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:06:59.963] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:06:59.964] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:06:59.970] ERROR: Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:06:59.982] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:10:29.623] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.656] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.696] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.701] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.726] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:10:29.729] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:10:29.733] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762967429661"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 17:10:29.662] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.736] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.737] ERROR: Failed to save payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads"
}
[2025-11-12 17:10:29.741] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads",
  "path": "/api/v1/payloads",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "key": "jest_sample_1762967429661",
    "description": "Jest test payload",
    "source": "jest",
    "payload": {
      "foo": "bar",
      "n": 42
    }
  }
}
[2025-11-12 17:10:29.749] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.765] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.767] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.769] INFO: GET /api/v1/payloads/jest_sample_1762967429661
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:10:29.772] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762967429661"
}
[2025-11-12 17:10:29.695] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.730] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.737] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.764] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:10:29.767] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:10:29.775] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.789] ERROR: Failed to load payload: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967429661' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:10:29.790] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT id, payload_key, description, source, payload, created_at, updated_at FROM saved_payloads WHERE payload_key = ?', [ 'jest_sample_1762967429661' ], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as getByKeyOrId] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:41:35)\n    at PayloadController.getByKeyOrId (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:60:43)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:365:14)\n    at param (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:376:14)\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:421:3)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads/jest_sample_1762967429661",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:10:29.778] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.792] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.795] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.799] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.801] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.803] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:10:29.807] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:10:29.797] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.804] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:10:29.805] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:10:29.812] ERROR: Failed to list payloads: SQLITE_ERROR: no such table: saved_payloads
{
  "service": "pos-order-gateway-api",
  "errno": 1,
  "code": "SQLITE_ERROR",
  "__augmented": true,
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5"
}
[2025-11-12 17:10:29.813] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "SQLITE_ERROR: no such table: saved_payloads",
  "stack": "Error: SQLITE_ERROR: no such table: saved_payloads\n--> in Database#all('SELECT COUNT(*) as total FROM saved_payloads ', [], [Function (anonymous)])\n    at all (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:16:8)\n    at new Promise (<anonymous>)\n    at Object.query (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\config\\database-sqlite.js:15:10)\n    at PayloadService.query [as list] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\payloadService.js:76:34)\n    at PayloadController.list (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\payloadController.js:75:41)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:68:5)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:149:13)\n    at Route.dispatch (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\route.js:119:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:284:15\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at textParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\text.js:69:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at Function.handle (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:175:3)\n    at router (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:47:12)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\middleware\\auth.js:46:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\server.js:118:3)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at urlencodedParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\urlencoded.js:94:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at jsonParser (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\body-parser\\lib\\types\\json.js:113:7)\n    at Layer.handle [as handle_request] (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\layer.js:95:5)\n    at trim_prefix (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:328:13)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:286:9\n    at Function.process_params (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:346:12)\n    at next (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express\\lib\\router\\index.js:280:10)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:807:7\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\node_modules\\express-rate-limit\\dist\\index.cjs:691:5",
  "path": "/api/v1/payloads",
  "method": "GET",
  "ip": "::ffff:127.0.0.1",
  "body": {}
}
[2025-11-12 17:10:29.807] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.821] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.823] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.824] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.826] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.831] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.838] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.842] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.844] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.845] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.847] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.851] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.864] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.872] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.873] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.874] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.815] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.933] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:29.979] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.026] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.028] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.028] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.076] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.166] INFO: âœ… POS catalog table created
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.167] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.184] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.186] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.189] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.190] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.191] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.192] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.194] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.195] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.195] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.197] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.198] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.199] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.200] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.201] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.202] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:10:30.203] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.134] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.180] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.214] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.234] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.264] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:12:11.267] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:12:11.193] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.276] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.293] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.295] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.300] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:12:11.301] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 17:12:11.304] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.310] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.312] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.228] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.260] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.274] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.301] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:12:11.305] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:12:11.313] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.309] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.317] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.318] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762967531233"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 17:12:11.320] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.321] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.315] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.376] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.401] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.397] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.404] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.401] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.412] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.403] INFO: GET /api/v1/payloads/jest_sample_1762967531233
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:12:11.406] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762967531233"
}
[2025-11-12 17:12:11.409] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.410] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.414] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.413] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.416] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.417] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.422] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.423] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.424] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.425] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.426] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.425] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.429] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.430] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.431] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.433] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.427] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 17:12:11.429] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 17:12:11.434] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.435] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.439] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.440] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.441] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.442] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.443] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.445] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.452] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.453] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.454] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.457] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.459] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.460] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.461] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.462] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.463] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 17:12:11.466] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:06.777] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:06.851] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:06.941] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:06.991] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.043] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.046] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:40:07.060] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.106] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.109] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.113] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.123] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:40:07.125] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.134] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.136] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.137] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.138] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.150] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.232] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.283] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.286] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.288] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.289] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.291] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.337] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.339] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.340] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.340] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.151] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.393] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.395] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.396] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.397] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.398] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.400] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.401] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.265] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.346] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.353] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.413] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.419] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:07.424] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63493",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.425] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972807280\",\n  \"externalOrderId\": \"EXT-1762972807280\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:07.280Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:40:07.426] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972807280\",\n  \"externalOrderId\": \"EXT-1762972807280\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:07.280Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:40:07.430] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "1d780d23-d4ea-46de-a3d3-7f207f7e1183"
}
[2025-11-12 18:40:07.430] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:40:07.430] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972807280",
    "externalOrderId": "EXT-1762972807280",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:07.280Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:40:07.439] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:40:07.440] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972807280\",\"externalOrderId\":\"EXT-1762972807280\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:40:07.2...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972807280\",\"externalOrderId\":\"EXT-1762972807280\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:40:07.440] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972807280",
    "externalOrderId": "EXT-1762972807280",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:07.280Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:40:07.442] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:40:07.490] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.509] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.511] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.514] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.515] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:07.516] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63495",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.517] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972807505-TM\",\n  \"externalOrderId\": \"EXT-1762972807505-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:07.505Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:40:07.517] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972807505-TM\",\n  \"externalOrderId\": \"EXT-1762972807505-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:07.505Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:40:07.517] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "4f4bc363-0d98-4304-94b9-fbbaf7b073b9"
}
[2025-11-12 18:40:07.517] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:40:07.517] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972807505-TM",
    "externalOrderId": "EXT-1762972807505-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:07.505Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:40:07.520] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:40:07.520] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972807505-TM\",\"externalOrderId\":\"EXT-1762972807505-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:4...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972807505-TM\",\"externalOrderId\":\"EXT-1762972807505-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:40:07.520] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972807505-TM",
    "externalOrderId": "EXT-1762972807505-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:07.505Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:40:07.523] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:40:07.525] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:40:07.526] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762972807505-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:40:07.526] INFO: Creating enhanced order ORD-1762972807505-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762972807505-TM",
  "externalOrderId": "EXT-1762972807505-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:40:07.556] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972807505-TM\",\n  \"externalOrderId\": \"EXT-1762972807505-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:07.505Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:40:07.556] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762972807505-TM",
  "idempotencyKey": "4f4bc363-0d98-4304-94b9-fbbaf7b073b9",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:40:07.557] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4f4bc363-0d98-4304-94b9-fbbaf7b073b9"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:40:07.558] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.561] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.562] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "4f4bc363-0d98-4304-94b9-fbbaf7b073b9"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:40:07.562] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "8376cb9c-c416-4b67-93d8-a705ba34b630",
  "publicOrderId": "ORD-1762972807505-TM"
}
[2025-11-12 18:40:07.563] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "8376cb9c-c416-4b67-93d8-a705ba34b630",
  "orderId": "ORD-1762972807505-TM",
  "externalOrderId": "EXT-1762972807505-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:40:07.571] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "8376cb9c-c416-4b67-93d8-a705ba34b630",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762972807505-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762972807505-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "4f4bc363-0d98-4304-94b9-fbbaf7b073b9",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:40:07.505Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:40:07.572] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:40:07.573] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:40:07.574] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.497] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.580] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.652] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 95,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:40:07.652] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "95ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762972807505-TM",
    "externalOrderId": "EXT-1762972807505-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:40:07.660] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 12,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 144,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:40:07.661] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "144ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:40:07.666] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762972807505-TM",
    "externalOrderId": "EXT-1762972807505-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:07.505Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:40:07.681] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.711] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.725] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.727] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.730] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.732] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.734] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.736] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.740] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.741] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.742] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.743] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.745] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.747] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.749] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.752] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.754] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.756] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.547] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.637] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.644] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.713] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.717] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:07.760] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.762] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.764] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762972807558"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:40:07.774] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.776] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.758] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.834] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.870] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.872] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.876] INFO: GET /api/v1/payloads/jest_sample_1762972807558
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.877] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762972807558"
}
[2025-11-12 18:40:07.881] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.894] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.914] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.924] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.927] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:07.928] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:07.931] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.932] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.934] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.935] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.950] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.987] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.988] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.990] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.994] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:07.997] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:08.001] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:08.004] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:08.006] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:08.011] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:08.012] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:23.952] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.085] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.105] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.227] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.249] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.305] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.346] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:24.353] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.355] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.357] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762972824123"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:40:24.359] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.361] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.186] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.297] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.303] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.357] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.364] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:24.380] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63513",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.381] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972824247\",\n  \"externalOrderId\": \"EXT-1762972824247\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:24.247Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:40:24.381] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972824247\",\n  \"externalOrderId\": \"EXT-1762972824247\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:24.247Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:40:24.383] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "6503a97d-1030-4752-8349-2a8a7a572779"
}
[2025-11-12 18:40:24.383] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:40:24.383] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972824247",
    "externalOrderId": "EXT-1762972824247",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:24.247Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:40:24.412] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:40:24.414] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972824247\",\"externalOrderId\":\"EXT-1762972824247\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:40:24.2...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972824247\",\"externalOrderId\":\"EXT-1762972824247\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:40:24.414] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972824247",
    "externalOrderId": "EXT-1762972824247",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:24.247Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:40:24.416] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:40:24.497] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.474] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.506] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.512] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.514] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.516] INFO: GET /api/v1/payloads/jest_sample_1762972824123
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.519] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762972824123"
}
[2025-11-12 18:40:24.521] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.540] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.350] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.510] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.512] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.513] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:24.514] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63517",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.515] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972824501-TM\",\n  \"externalOrderId\": \"EXT-1762972824501-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:24.501Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:40:24.515] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972824501-TM\",\n  \"externalOrderId\": \"EXT-1762972824501-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:24.501Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:40:24.515] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "cbade7a5-8631-427c-8c97-2dc99524d56e"
}
[2025-11-12 18:40:24.515] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:40:24.516] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972824501-TM",
    "externalOrderId": "EXT-1762972824501-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:24.501Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:40:24.518] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:40:24.518] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972824501-TM\",\"externalOrderId\":\"EXT-1762972824501-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:4...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972824501-TM\",\"externalOrderId\":\"EXT-1762972824501-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:40:24.520] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972824501-TM",
    "externalOrderId": "EXT-1762972824501-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:24.501Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:40:24.522] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:40:24.542] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:40:24.544] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762972824501-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:40:24.544] INFO: Creating enhanced order ORD-1762972824501-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762972824501-TM",
  "externalOrderId": "EXT-1762972824501-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:40:24.546] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972824501-TM\",\n  \"externalOrderId\": \"EXT-1762972824501-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:40:24.501Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:40:24.546] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762972824501-TM",
  "idempotencyKey": "cbade7a5-8631-427c-8c97-2dc99524d56e",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:40:24.547] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "cbade7a5-8631-427c-8c97-2dc99524d56e"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:40:24.548] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.561] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.554] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.556] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "cbade7a5-8631-427c-8c97-2dc99524d56e"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:40:24.556] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "1d51169a-1047-450c-9abb-9065527e78b4",
  "publicOrderId": "ORD-1762972824501-TM"
}
[2025-11-12 18:40:24.556] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "1d51169a-1047-450c-9abb-9065527e78b4",
  "orderId": "ORD-1762972824501-TM",
  "externalOrderId": "EXT-1762972824501-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:40:24.563] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "1d51169a-1047-450c-9abb-9065527e78b4",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762972824501-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762972824501-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "cbade7a5-8631-427c-8c97-2dc99524d56e",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:40:24.501Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:40:24.564] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:40:24.565] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:40:24.566] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.596] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.600] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.601] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:40:24.618] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.619] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.620] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.449] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.524] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.543] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.603] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.609] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:40:24.567] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.627] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 10,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 10,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 81,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:40:24.628] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "81ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762972824501-TM",
    "externalOrderId": "EXT-1762972824501-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:40:24.629] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 31,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 115,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:40:24.630] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "115ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:40:24.631] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762972824501-TM",
    "externalOrderId": "EXT-1762972824501-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:40:24.501Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:40:24.634] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.625] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.645] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.648] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.653] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:40:24.655] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:40:24.658] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.657] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.634] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.664] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.663] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.670] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.683] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.665] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.683] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.685] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.670] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.674] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.693] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.696] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.697] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.713] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.725] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.726] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.726] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.727] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.728] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.732] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.737] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.739] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.741] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.743] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.747] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.754] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.755] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.803] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.756] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.805] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.804] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.805] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.808] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.810] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.811] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.813] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.812] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.846] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.846] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.847] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.847] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.852] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.869] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.871] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.873] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.889] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.894] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.899] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.900] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.902] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:40:24.904] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.840] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.834] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.917] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.985] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.015] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.103] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.109] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:43:08.113] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.115] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.117] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762972987945"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:43:08.118] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.119] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.946] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:07.988] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.058] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.070] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:43:08.123] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.151] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.160] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.165] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.166] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:43:08.183] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.193] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.203] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.206] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.209] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.210] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.211] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.217] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.249] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.254] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.258] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.285] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.260] INFO: GET /api/v1/payloads/jest_sample_1762972987945
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.264] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762972987945"
}
[2025-11-12 18:43:08.311] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.321] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.336] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.344] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.346] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.349] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.352] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.357] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.375] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.379] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.379] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.380] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:43:08.390] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.391] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.392] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.395] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.380] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.381] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.433] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.434] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.436] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.467] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.469] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.470] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.437] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.437] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.478] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.485] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.485] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.496] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.499] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.508] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.511] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.511] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.517] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.518] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.578] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.719] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.805] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.819] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:08.883] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.911] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:43:08.920] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63674",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:08.924] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972988749\",\n  \"externalOrderId\": \"EXT-1762972988749\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:43:08.749Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:43:08.929] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972988749\",\n  \"externalOrderId\": \"EXT-1762972988749\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:43:08.749Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:43:08.935] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "a1b6505e-e40a-4be8-af8f-42ea510f68be"
}
[2025-11-12 18:43:08.944] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:43:08.959] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972988749",
    "externalOrderId": "EXT-1762972988749",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:43:08.749Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:43:08.982] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:43:08.983] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972988749\",\"externalOrderId\":\"EXT-1762972988749\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:43:08.7...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972988749\",\"externalOrderId\":\"EXT-1762972988749\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:43:08.985] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972988749",
    "externalOrderId": "EXT-1762972988749",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:43:08.749Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:43:08.994] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:43:09.014] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.068] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.076] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.081] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:09.092] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:43:09.094] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:63677",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:43:09.095] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972989054-TM\",\n  \"externalOrderId\": \"EXT-1762972989054-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:43:09.054Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:43:09.095] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972989054-TM\",\n  \"externalOrderId\": \"EXT-1762972989054-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:43:09.054Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:43:09.095] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "c1347c17-0ad3-493d-9672-2b51745ef3cc"
}
[2025-11-12 18:43:09.095] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:43:09.095] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762972989054-TM",
    "externalOrderId": "EXT-1762972989054-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:43:09.054Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:43:09.101] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:43:09.101] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762972989054-TM\",\"externalOrderId\":\"EXT-1762972989054-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:4...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762972989054-TM\",\"externalOrderId\":\"EXT-1762972989054-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:43:09.102] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762972989054-TM",
    "externalOrderId": "EXT-1762972989054-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:43:09.054Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:43:09.104] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:43:09.110] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:43:09.118] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762972989054-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:43:09.119] INFO: Creating enhanced order ORD-1762972989054-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762972989054-TM",
  "externalOrderId": "EXT-1762972989054-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:43:09.122] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762972989054-TM\",\n  \"externalOrderId\": \"EXT-1762972989054-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:43:09.054Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:43:09.122] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762972989054-TM",
  "idempotencyKey": "c1347c17-0ad3-493d-9672-2b51745ef3cc",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:43:09.130] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c1347c17-0ad3-493d-9672-2b51745ef3cc"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:43:09.132] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.144] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.146] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c1347c17-0ad3-493d-9672-2b51745ef3cc"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:43:09.146] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "3beb60d7-d6fd-406a-9e55-e935e27954ff",
  "publicOrderId": "ORD-1762972989054-TM"
}
[2025-11-12 18:43:09.146] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "3beb60d7-d6fd-406a-9e55-e935e27954ff",
  "orderId": "ORD-1762972989054-TM",
  "externalOrderId": "EXT-1762972989054-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:43:09.163] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "3beb60d7-d6fd-406a-9e55-e935e27954ff",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762972989054-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762972989054-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "c1347c17-0ad3-493d-9672-2b51745ef3cc",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:43:09.054Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:43:09.163] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:43:09.164] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:43:09.176] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.177] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.242] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 8,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 25,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 25,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 120,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:43:09.243] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "120ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762972989054-TM",
    "externalOrderId": "EXT-1762972989054-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:43:09.244] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 27,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 150,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:43:09.245] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "150ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:43:09.247] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762972989054-TM",
    "externalOrderId": "EXT-1762972989054-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:43:09.054Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:43:09.252] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.293] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.298] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.305] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.315] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.334] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.336] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.348] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.353] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.392] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.393] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.395] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.402] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.404] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.405] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.428] INFO: ðŸ“‹ saved_payloads table columns:
{
  "0": "id",
  "1": "payload_key",
  "2": "description",
  "3": "source",
  "4": "payload",
  "5": "created_at",
  "6": "updated_at",
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.430] INFO: ðŸŽ‰ Saved Payloads migration completed.
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.434] INFO: POS catalog table already exists
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:43:09.438] INFO: ðŸ§ª Migrations applied for test/import context
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.386] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.508] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.589] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.691] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.695] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:43.437] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.477] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.701] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.732] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.737] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762973743512"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:43.738] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.742] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.539] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.648] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.712] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.794] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.797] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:43.813] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.810] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.594] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.716] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.727] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.789] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.795] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:43.814] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64201",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.816] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973743690\",\n  \"externalOrderId\": \"EXT-1762973743690\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:43.690Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:43.816] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973743690\",\n  \"externalOrderId\": \"EXT-1762973743690\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:43.690Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:43.822] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "d9d48ac3-b790-4e78-abb0-84e5de123ebe"
}
[2025-11-12 18:55:43.822] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:43.822] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973743690",
    "externalOrderId": "EXT-1762973743690",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:43.690Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:55:43.831] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:43.832] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973743690\",\"externalOrderId\":\"EXT-1762973743690\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:55:43.6...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973743690\",\"externalOrderId\":\"EXT-1762973743690\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:43.832] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973743690",
    "externalOrderId": "EXT-1762973743690",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:43.690Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:43.840] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:55:43.861] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.824] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.857] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.858] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:43.863] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.861] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.866] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.866] INFO: GET /api/v1/payloads/jest_sample_1762973743512
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.869] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762973743512"
}
[2025-11-12 18:55:43.888] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.889] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.847] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.904] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.924] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.995] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.000] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.908] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:43.914] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.919] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:43.924] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64208",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:43.924] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973743897-TM\",\n  \"externalOrderId\": \"EXT-1762973743897-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:43.897Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:43.924] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973743897-TM\",\n  \"externalOrderId\": \"EXT-1762973743897-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:43.897Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:43.925] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "be815593-3dd3-4278-8fda-61dbc31bfd19"
}
[2025-11-12 18:55:43.925] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:43.925] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973743897-TM",
    "externalOrderId": "EXT-1762973743897-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:43.897Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:43.928] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:43.930] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973743897-TM\",\"externalOrderId\":\"EXT-1762973743897-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:5...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973743897-TM\",\"externalOrderId\":\"EXT-1762973743897-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:43.932] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973743897-TM",
    "externalOrderId": "EXT-1762973743897-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:43.897Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:43.938] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:55:43.996] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:43.998] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762973743897-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:55:43.999] INFO: Creating enhanced order ORD-1762973743897-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762973743897-TM",
  "externalOrderId": "EXT-1762973743897-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:55:44.005] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973743897-TM\",\n  \"externalOrderId\": \"EXT-1762973743897-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:43.897Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:55:44.005] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762973743897-TM",
  "idempotencyKey": "be815593-3dd3-4278-8fda-61dbc31bfd19",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:55:44.005] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "be815593-3dd3-4278-8fda-61dbc31bfd19"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:44.007] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.002] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:44.008] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.010] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.011] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.012] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.014] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.022] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.023] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.008] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.010] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "be815593-3dd3-4278-8fda-61dbc31bfd19"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:55:44.010] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "422c4948-acdd-4a94-a1ba-92461894e336",
  "publicOrderId": "ORD-1762973743897-TM"
}
[2025-11-12 18:55:44.010] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "422c4948-acdd-4a94-a1ba-92461894e336",
  "orderId": "ORD-1762973743897-TM",
  "externalOrderId": "EXT-1762973743897-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:55:44.022] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "422c4948-acdd-4a94-a1ba-92461894e336",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762973743897-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762973743897-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "be815593-3dd3-4278-8fda-61dbc31bfd19",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:55:43.897Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:55:44.026] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:55:44.028] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:44.030] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.024] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.025] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.055] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.058] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.072] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_source ON saved_payloads(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.032] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.116] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 6,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 111,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:55:44.116] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "111ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762973743897-TM",
    "externalOrderId": "EXT-1762973743897-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:55:44.117] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 7,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 79,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 193,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:55:44.118] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "193ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:55:44.138] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762973743897-TM",
    "externalOrderId": "EXT-1762973743897-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:43.897Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:44.142] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:44.218] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.180] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.298] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.398] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.404] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.503] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:49.508] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:49.516] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.575] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.578] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.601] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:49.602] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:49.604] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.610] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.678] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.850] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.896] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.902] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.931] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:49.937] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:49.943] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64219",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:49.944] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973749869\",\n  \"externalOrderId\": \"EXT-1762973749869\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:49.869Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:49.944] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973749869\",\n  \"externalOrderId\": \"EXT-1762973749869\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:49.869Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:49.946] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "d7f303a4-9c42-4317-82f4-df2fc59ab682"
}
[2025-11-12 18:55:49.946] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:49.946] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973749869",
    "externalOrderId": "EXT-1762973749869",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:49.869Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:55:49.961] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:49.962] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973749869\",\"externalOrderId\":\"EXT-1762973749869\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:55:49.8...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973749869\",\"externalOrderId\":\"EXT-1762973749869\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:49.962] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973749869",
    "externalOrderId": "EXT-1762973749869",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:49.869Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:49.964] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:55:49.971] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.992] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.995] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.997] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:49.998] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:50.000] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64221",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:50.000] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973749986-TM\",\n  \"externalOrderId\": \"EXT-1762973749986-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:49.986Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:50.000] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973749986-TM\",\n  \"externalOrderId\": \"EXT-1762973749986-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:49.986Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:50.000] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "8ebfcde6-9cdb-40b7-a482-b4db2217fecb"
}
[2025-11-12 18:55:50.000] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:50.001] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973749986-TM",
    "externalOrderId": "EXT-1762973749986-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:49.986Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:50.002] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:50.002] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973749986-TM\",\"externalOrderId\":\"EXT-1762973749986-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:5...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973749986-TM\",\"externalOrderId\":\"EXT-1762973749986-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:50.004] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973749986-TM",
    "externalOrderId": "EXT-1762973749986-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:49.986Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:50.005] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:55:50.007] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:50.010] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762973749986-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:55:50.010] INFO: Creating enhanced order ORD-1762973749986-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762973749986-TM",
  "externalOrderId": "EXT-1762973749986-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:55:50.012] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973749986-TM\",\n  \"externalOrderId\": \"EXT-1762973749986-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:49.986Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:55:50.012] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762973749986-TM",
  "idempotencyKey": "8ebfcde6-9cdb-40b7-a482-b4db2217fecb",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:55:50.013] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "8ebfcde6-9cdb-40b7-a482-b4db2217fecb"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:50.014] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.020] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.021] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "8ebfcde6-9cdb-40b7-a482-b4db2217fecb"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:55:50.022] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "1adc73c1-e1d5-4edb-b4d9-a49181a2596e",
  "publicOrderId": "ORD-1762973749986-TM"
}
[2025-11-12 18:55:50.022] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "1adc73c1-e1d5-4edb-b4d9-a49181a2596e",
  "orderId": "ORD-1762973749986-TM",
  "externalOrderId": "EXT-1762973749986-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:55:50.028] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "1adc73c1-e1d5-4edb-b4d9-a49181a2596e",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762973749986-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762973749986-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "8ebfcde6-9cdb-40b7-a482-b4db2217fecb",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:55:49.986Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:55:50.029] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:55:50.030] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:50.031] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.920] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.032] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.073] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 9,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 10,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 60,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:55:50.073] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "60ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762973749986-TM",
    "externalOrderId": "EXT-1762973749986-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:55:50.074] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 2,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 11,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 74,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:55:50.076] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "74ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:55:50.078] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762973749986-TM",
    "externalOrderId": "EXT-1762973749986-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:49.986Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:50.082] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.096] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:49.988] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.051] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.073] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.117] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:50.139] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:50.154] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.163] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.166] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762973749994"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:50.169] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.171] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.338] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.355] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.357] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.360] INFO: GET /api/v1/payloads/jest_sample_1762973749994
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:50.362] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762973749994"
}
[2025-11-12 18:55:50.365] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.366] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.368] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.381] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.383] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:50.385] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:50.388] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.389] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.393] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.401] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.403] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.410] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.411] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.412] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.420] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:50.424] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.455] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.522] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.579] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.594] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.676] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:54.686] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:54.697] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.728] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.733] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.737] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:54.738] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:55:54.740] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.743] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.981] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:54.977] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.039] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.088] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.093] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.175] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.182] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:55.191] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.236] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.238] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762973755044"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:55.239] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.242] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.039] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.129] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.135] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.207] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.212] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:55.233] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64237",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.234] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973755075\",\n  \"externalOrderId\": \"EXT-1762973755075\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:55.075Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:55.234] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973755075\",\n  \"externalOrderId\": \"EXT-1762973755075\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:55.075Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:55:55.236] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "0584e896-7bd4-44e2-9251-3d12bccea4e5"
}
[2025-11-12 18:55:55.237] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:55.237] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973755075",
    "externalOrderId": "EXT-1762973755075",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:55.075Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:55:55.265] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:55.266] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973755075\",\"externalOrderId\":\"EXT-1762973755075\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:55:55.0...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973755075\",\"externalOrderId\":\"EXT-1762973755075\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:55.267] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973755075",
    "externalOrderId": "EXT-1762973755075",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:55.075Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:55.269] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:55:55.301] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.291] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.332] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.326] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.335] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.337] INFO: GET /api/v1/payloads/jest_sample_1762973755044
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.339] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762973755044"
}
[2025-11-12 18:55:55.341] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.349] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.372] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.334] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.336] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.337] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:55.339] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64239",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.339] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973755302-TM\",\n  \"externalOrderId\": \"EXT-1762973755302-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:55.302Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:55.339] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973755302-TM\",\n  \"externalOrderId\": \"EXT-1762973755302-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:55.302Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:55:55.340] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "c37b9b1e-2ee3-4215-a2ed-ac1479234099"
}
[2025-11-12 18:55:55.340] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:55:55.340] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973755302-TM",
    "externalOrderId": "EXT-1762973755302-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:55.302Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:55.342] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:55:55.343] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973755302-TM\",\"externalOrderId\":\"EXT-1762973755302-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:5...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973755302-TM\",\"externalOrderId\":\"EXT-1762973755302-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:55:55.343] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973755302-TM",
    "externalOrderId": "EXT-1762973755302-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:55.302Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:55:55.347] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:55:55.350] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:55.353] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762973755302-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:55:55.353] INFO: Creating enhanced order ORD-1762973755302-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762973755302-TM",
  "externalOrderId": "EXT-1762973755302-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:55:55.370] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973755302-TM\",\n  \"externalOrderId\": \"EXT-1762973755302-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:55:55.302Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:55:55.371] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762973755302-TM",
  "idempotencyKey": "c37b9b1e-2ee3-4215-a2ed-ac1479234099",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:55:55.372] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c37b9b1e-2ee3-4215-a2ed-ac1479234099"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:55:55.373] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.386] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.389] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:55:55.391] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:55:55.408] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.382] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.389] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "c37b9b1e-2ee3-4215-a2ed-ac1479234099"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:55:55.389] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "f76c0985-909e-4b70-8786-13cfae3ea21a",
  "publicOrderId": "ORD-1762973755302-TM"
}
[2025-11-12 18:55:55.389] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "f76c0985-909e-4b70-8786-13cfae3ea21a",
  "orderId": "ORD-1762973755302-TM",
  "externalOrderId": "EXT-1762973755302-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:55:55.406] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "f76c0985-909e-4b70-8786-13cfae3ea21a",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762973755302-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762973755302-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "c37b9b1e-2ee3-4215-a2ed-ac1479234099",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:55:55.302Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:55:55.408] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:55:55.409] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:55:55.421] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.420] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.423] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.426] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.437] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.441] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.455] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.456] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.464] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.474] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.424] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.494] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 19,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 19,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 124,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:55:55.495] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "124ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762973755302-TM",
    "externalOrderId": "EXT-1762973755302-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:55:55.496] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": null,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 29,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 157,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:55:55.498] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "157ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:55:55.502] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762973755302-TM",
    "externalOrderId": "EXT-1762973755302-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:55:55.302Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:55:55.505] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:55:55.534] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:00.727] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:00.862] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:00.975] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:00.981] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.061] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.064] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:56:01.074] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.132] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.135] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.141] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.142] WARN: Authentication failed: Invalid API key
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "path": "/",
  "apiKeyPrefix": "test-key..."
}
[2025-11-12 18:56:01.144] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.150] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.131] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.154] INFO: ðŸ”’ Proxy trust enabled for production deployment
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.242] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.341] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.351] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.410] INFO: POST /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.415] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:56:01.421] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.440] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.441] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Save Payload
{
  "service": "pos-order-gateway-api",
  "query": "INSERT INTO saved_payloads (payload_key, description, source, payload, created_at, updated_at) VALUES (?, ?, ?, ?, datetime('now'), datetime('now')) ON CONFLICT(payload_key) DO UPDATE SET description = COALESCE(excluded.description, saved_payloads.description), source = COALESCE(excluded.source, saved_payloads.source), payload = excluded.payload, updated_at = datetime('now') ;",
  "parameterCount": 4,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "jest_sample_1762973761246"
    },
    {
      "index": 1,
      "type": "string",
      "value": "Jest test payload"
    },
    {
      "index": 2,
      "type": "string",
      "value": "jest"
    },
    {
      "index": 3,
      "type": "string",
      "value": "{\"foo\":\"bar\",\"n\":42}"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:56:01.443] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.445] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.290] INFO: ðŸ”„ Applying OhMyApp.io support migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.356] INFO: ðŸ—„ï¸ Connected to SQLite database
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.406] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN customer_address TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.446] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.473] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:56:01.477] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64253",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "467",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 467,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.478] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973761331\",\n  \"externalOrderId\": \"EXT-1762973761331\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:56:01.331Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:56:01.479] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 667,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973761331\",\n  \"externalOrderId\": \"EXT-1762973761331\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:56:01.331Z\",\n  \"items\": [\n    {\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 0,\n      \"unitPrice\": 2.99\n    },\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 2.99,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 2.99\n  }\n}"
}
[2025-11-12 18:56:01.482] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "bcd457d6-3ba0-470b-9ccf-3f503af696cb"
}
[2025-11-12 18:56:01.482] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 3,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:56:01.482] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973761331",
    "externalOrderId": "EXT-1762973761331",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:56:01.331Z",
    "items": [
      {
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 0,
        "unitPrice": 2.99
      },
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    }
  }
}
[2025-11-12 18:56:01.511] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:56:01.513] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973761331\",\"externalOrderId\":\"EXT-1762973761331\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:56:01.3...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973761331\",\"externalOrderId\":\"EXT-1762973761331\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",\"order...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 3,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:56:01.514] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973761331",
    "externalOrderId": "EXT-1762973761331",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:56:01.331Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": null,
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 2.99,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      },
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 0,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 2.99,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 2.99
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:56:01.516] WARN: âŒ Order validation failed
{
  "service": "pos-order-gateway-api",
  "errors": [
    "items[0].sku is required"
  ]
}
[2025-11-12 18:56:01.530] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.564] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.567] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.524] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN payment_amount REAL DEFAULT 0...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.569] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN source TEXT DEFAULT 'api'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.573] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_metadata TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.576] INFO: POST /api/v1/orders
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.577] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:56:01.578] DEBUG: ðŸ“¨ REQUEST DEBUG - Order Creation Request
{
  "service": "pos-order-gateway-api",
  "method": "POST",
  "url": "/",
  "headers": {
    "host": "127.0.0.1:64256",
    "accept-encoding": "gzip, deflate",
    "x-api-key": "[SANITIZED]",
    "content-type": "application/json",
    "content-length": "367",
    "connection": "close"
  },
  "query": {},
  "params": {},
  "bodySize": 367,
  "bodyType": "object",
  "ip": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.579] DEBUG: ðŸ” PAYLOAD DEBUG - Order Creation Request - Body
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973761552-TM\",\n  \"externalOrderId\": \"EXT-1762973761552-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:56:01.552Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:56:01.579] DEBUG: ðŸ” PAYLOAD DEBUG - Raw Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 499,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973761552-TM\",\n  \"externalOrderId\": \"EXT-1762973761552-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\"\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:56:01.552Z\",\n  \"items\": [\n    {\n      \"sku\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  }\n}"
}
[2025-11-12 18:56:01.579] DEBUG: ðŸ”‘ Generated new idempotency key
{
  "service": "pos-order-gateway-api",
  "idempotencyKey": "960fd602-7193-4df9-9d09-25b24a9f6222"
}
[2025-11-12 18:56:01.579] DEBUG: ðŸ“Š ORDER ANALYSIS - Pre-processing
{
  "service": "pos-order-gateway-api",
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true,
  "itemCount": 1,
  "hasTotals": true,
  "hasPayment": false,
  "originalFields": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ]
}
[2025-11-12 18:56:01.579] INFO: Processing order data:
{
  "service": "pos-order-gateway-api",
  "orderData": {
    "orderId": "ORD-1762973761552-TM",
    "externalOrderId": "EXT-1762973761552-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:56:01.552Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:56:01.582] DEBUG: ðŸ“‹ PROCESSING ORDER DATA
{
  "service": "pos-order-gateway-api",
  "usingExtractedData": false,
  "extractionPath": "direct",
  "dataKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "hasOrderId": true,
  "hasCustomer": true,
  "hasItems": true
}
[2025-11-12 18:56:01.582] DEBUG: ðŸ”„ TRANSFORMATION DEBUG - Order Data Processing
{
  "service": "pos-order-gateway-api",
  "beforeType": "object",
  "beforeKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "items",
    "totals"
  ],
  "beforeSample": "{\"orderId\":\"ORD-1762973761552-TM\",\"externalOrderId\":\"EXT-1762973761552-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\"},\"orderType\":\"pickup\",\"orderTime\":\"2025-11-12T18:5...",
  "afterType": "object",
  "afterKeys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "afterSample": "{\"orderId\":\"ORD-1762973761552-TM\",\"externalOrderId\":\"EXT-1762973761552-TM\",\"restaurantId\":\"NYC-DELI-001\",\"customer\":{\"name\":\"Test\",\"phone\":\"555-1234\",\"email\":null,\"address\":null},\"orderType\":\"pickup\",...",
  "transformationDetails": {
    "fieldsGenerated": [],
    "customerFieldsMapped": [
      "name",
      "phone",
      "email",
      "address"
    ],
    "itemsProcessed": 1,
    "totalsCalculated": [
      "subtotal",
      "tax",
      "tip",
      "discount",
      "deliveryFee",
      "total"
    ],
    "paymentFieldsMapped": [
      "method",
      "status",
      "transactionId",
      "amount"
    ]
  }
}
[2025-11-12 18:56:01.583] INFO: Processed order ready for service:
{
  "service": "pos-order-gateway-api",
  "processedOrder": {
    "orderId": "ORD-1762973761552-TM",
    "externalOrderId": "EXT-1762973761552-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234",
      "email": null,
      "address": null
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:56:01.552Z",
    "requestedTime": null,
    "items": [
      {
        "itemId": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5,
        "totalPrice": 0,
        "specialInstructions": null,
        "modifiers": []
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    },
    "payment": {
      "method": null,
      "status": "pending",
      "transactionId": null,
      "amount": 0
    },
    "notes": "",
    "status": "received",
    "source": "api",
    "webhookMetadata": null,
    "originalOrderId": null,
    "createdAt": null,
    "_ohmyAppFields": {
      "hasShippingFee": false,
      "hasServiceFee": false,
      "hasAddress": false,
      "hasWebhookMetadata": false
    }
  }
}
[2025-11-12 18:56:01.585] INFO: ðŸ§¾ MAPPED LINES (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ]
}
[2025-11-12 18:56:01.589] WARN: âš–ï¸ Totals mismatch (pre-POS-price)
{
  "service": "pos-order-gateway-api",
  "previewSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "previewTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:56:01.591] DEBUG: ðŸ“‹ PROCESSED ORDER ANALYSIS
{
  "service": "pos-order-gateway-api",
  "structure": {
    "orderId": "ORD-1762973761552-TM",
    "hasExternalId": true,
    "restaurantId": "NYC-DELI-001",
    "customerComplete": true,
    "orderType": "pickup",
    "itemCount": 1,
    "totalAmount": 3,
    "paymentStatus": "pending",
    "hasNotes": false
  },
  "itemDetails": [
    {
      "index": 0,
      "name": "Coffee",
      "quantity": 1,
      "unitPrice": 3.5,
      "hasModifiers": false,
      "modifierCount": 0
    }
  ],
  "financials": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "total": 3,
    "calculatedTotal": 3
  }
}
[2025-11-12 18:56:01.591] INFO: Creating enhanced order ORD-1762973761552-TM
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "orderId": "ORD-1762973761552-TM",
  "externalOrderId": "EXT-1762973761552-TM",
  "restaurantId": "NYC-DELI-001",
  "customerEmail": null,
  "orderType": "pickup",
  "requestedTime": null,
  "itemCount": 1,
  "total": 3,
  "paymentStatus": "pending"
}
[2025-11-12 18:56:01.596] DEBUG: ðŸ” PAYLOAD DEBUG - Service - Incoming Order Data
{
  "service": "pos-order-gateway-api",
  "payloadSize": 1030,
  "payloadType": "object",
  "isArray": false,
  "keys": [
    "orderId",
    "externalOrderId",
    "restaurantId",
    "customer",
    "orderType",
    "orderTime",
    "requestedTime",
    "items",
    "totals",
    "payment",
    "notes",
    "status",
    "source",
    "webhookMetadata",
    "originalOrderId",
    "createdAt",
    "_ohmyAppFields"
  ],
  "payload": "{\n  \"orderId\": \"ORD-1762973761552-TM\",\n  \"externalOrderId\": \"EXT-1762973761552-TM\",\n  \"restaurantId\": \"NYC-DELI-001\",\n  \"customer\": {\n    \"name\": \"Test\",\n    \"phone\": \"555-1234\",\n    \"email\": null,\n    \"address\": null\n  },\n  \"orderType\": \"pickup\",\n  \"orderTime\": \"2025-11-12T18:56:01.552Z\",\n  \"requestedTime\": null,\n  \"items\": [\n    {\n      \"itemId\": \"COFFEE-12OZ\",\n      \"name\": \"Coffee\",\n      \"quantity\": 1,\n      \"unitPrice\": 3.5,\n      \"totalPrice\": 0,\n      \"specialInstructions\": null,\n      \"modifiers\": []\n    }\n  ],\n  \"totals\": {\n    \"subtotal\": 3,\n    \"tax\": 0,\n    \"tip\": 0,\n    \"discount\": 0,\n    \"deliveryFee\": 0,\n    \"total\": 3\n  },\n  \"payment\": {\n    \"method\": null,\n    \"status\": \"pending\",\n    \"transactionId\": null,\n    \"amount\": 0\n  },\n  \"notes\": \"\",\n  \"status\": \"received\",\n  \"source\": \"api\",\n  \"webhookMetadata\": null,\n  \"originalOrderId\": null,\n  \"createdAt\": null,\n  \"_ohmyAppFields\": {\n    \"hasShippingFee\": false,\n    \"hasServiceFee\": false,\n    \"hasAddress\": false,\n    \"ha... [TRUNCATED]"
}
[2025-11-12 18:56:01.596] DEBUG: ðŸ”§ SERVICE DEBUG - Create Order Called
{
  "service": "pos-order-gateway-api",
  "orderId": "ORD-1762973761552-TM",
  "idempotencyKey": "960fd602-7193-4df9-9d09-25b24a9f6222",
  "hasCustomer": true,
  "itemCount": 1,
  "totalAmount": 3
}
[2025-11-12 18:56:01.596] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "960fd602-7193-4df9-9d09-25b24a9f6222"
    }
  ],
  "resultInfo": null
}
[2025-11-12 18:56:01.595] INFO: GET /api/v1/payloads/jest_sample_1762973761246
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.597] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/jest_sample_1762973761246"
}
[2025-11-12 18:56:01.599] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.603] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.607] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_original_order_id ON orders(original_order...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.598] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN original_order_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.626] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source_created ON orders(source, created_a...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.628] INFO: GET /api/v1/payloads
{
  "service": "pos-order-gateway-api",
  "ip": "::ffff:127.0.0.1",
  "ips": [],
  "remoteAddress": "::ffff:127.0.0.1"
}
[2025-11-12 18:56:01.629] INFO: Authentication successful
{
  "service": "pos-order-gateway-api",
  "client": "Admin Dashboard",
  "ip": "::ffff:127.0.0.1",
  "path": "/"
}
[2025-11-12 18:56:01.617] INFO: âš ï¸ Skipped (already exists): ALTER TABLE orders ADD COLUMN webhook_created_at TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.620] DEBUG: ðŸ—„ï¸ DATABASE DEBUG - Idempotency Check Result
{
  "service": "pos-order-gateway-api",
  "query": "SELECT id, order_id, status FROM orders WHERE idempotency_key = ?",
  "parameterCount": 1,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "960fd602-7193-4df9-9d09-25b24a9f6222"
    }
  ],
  "resultInfo": {
    "hasRows": 0,
    "changes": "unknown",
    "lastID": "unknown"
  }
}
[2025-11-12 18:56:01.620] DEBUG: ðŸ†” Generated internal ID
{
  "service": "pos-order-gateway-api",
  "internalId": "f01292a2-50f3-44d9-b5e7-3c29b750b054",
  "publicOrderId": "ORD-1762973761552-TM"
}
[2025-11-12 18:56:01.621] INFO: Creating order with data:
{
  "service": "pos-order-gateway-api",
  "internalId": "f01292a2-50f3-44d9-b5e7-3c29b750b054",
  "orderId": "ORD-1762973761552-TM",
  "externalOrderId": "EXT-1762973761552-TM",
  "customer": {
    "name": "Test",
    "phone": "555-1234",
    "email": null,
    "address": null
  },
  "orderType": "pickup",
  "totals": {
    "subtotal": 3,
    "tax": 0,
    "tip": 0,
    "discount": 0,
    "deliveryFee": 0,
    "total": 3
  }
}
[2025-11-12 18:56:01.628] DEBUG: ðŸ’¾ SQL PARAMETERS PREPARED
{
  "service": "pos-order-gateway-api",
  "parameterCount": 28,
  "parameters": [
    {
      "index": 0,
      "type": "string",
      "value": "f01292a2-50f3-44d9-b5e7-3c29b750b054",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 1,
      "type": "string",
      "value": "ORD-1762973761552-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 2,
      "type": "string",
      "value": "EXT-1762973761552-TM",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 3,
      "type": "string",
      "value": "NYC-DELI-001",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 4,
      "type": "string",
      "value": "960fd602-7193-4df9-9d09-25b24a9f6222",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 5,
      "type": "string",
      "value": "Test",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 6,
      "type": "string",
      "value": "555-1234",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 7,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 8,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 9,
      "type": "string",
      "value": "pickup",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 10,
      "type": "string",
      "value": "2025-11-12T18:56:01.552Z",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 11,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 12,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 13,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 14,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 15,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 16,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 17,
      "type": "number",
      "value": 3,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 18,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 19,
      "type": "string",
      "value": "pending",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 20,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 21,
      "type": "number",
      "value": 0,
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 22,
      "type": "string",
      "value": "",
      "isNull": false,
      "isEmpty": true
    },
    {
      "index": 23,
      "type": "string",
      "value": "received",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 24,
      "type": "string",
      "value": "api",
      "isNull": false,
      "isEmpty": false
    },
    {
      "index": 25,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 26,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    },
    {
      "index": 27,
      "type": "object",
      "value": null,
      "isNull": true,
      "isEmpty": false
    }
  ]
}
[2025-11-12 18:56:01.629] INFO: ðŸ§¾ MAPPED LINES (final-to-POS)
{
  "service": "pos-order-gateway-api",
  "lines": [
    {
      "sku": "COFFEE-12OZ",
      "name": "Coffee",
      "qty": 1,
      "unitPrice": 3.5,
      "modsTotal": 0,
      "extended": 3.5
    }
  ],
  "subtotal": 3.5,
  "expectedTotal": 3.5
}
[2025-11-12 18:56:01.629] WARN: âš–ï¸ Totals reconciliation failed
{
  "service": "pos-order-gateway-api",
  "calculatedSubtotal": 3.5,
  "payloadSubtotal": 3,
  "diffSubtotal": 0.5,
  "calculatedTotal": 3.5,
  "payloadTotal": 3,
  "diffTotal": 0.5,
  "tolerance": 0.05
}
[2025-11-12 18:56:01.632] INFO: ðŸ“‹ Final orders table structure:
{
  "0": {
    "cid": 0,
    "name": "id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "lower(hex(randomblob(16)))",
    "pk": 1
  },
  "1": {
    "cid": 1,
    "name": "order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "2": {
    "cid": 2,
    "name": "external_order_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "3": {
    "cid": 3,
    "name": "restaurant_id",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "4": {
    "cid": 4,
    "name": "idempotency_key",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "5": {
    "cid": 5,
    "name": "customer_name",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "6": {
    "cid": 6,
    "name": "customer_phone",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "7": {
    "cid": 7,
    "name": "customer_email",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "8": {
    "cid": 8,
    "name": "order_type",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "9": {
    "cid": 9,
    "name": "order_time",
    "type": "TEXT",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "10": {
    "cid": 10,
    "name": "requested_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "11": {
    "cid": 11,
    "name": "subtotal",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "12": {
    "cid": 12,
    "name": "tax",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "13": {
    "cid": 13,
    "name": "tip",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "14": {
    "cid": 14,
    "name": "discount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "15": {
    "cid": 15,
    "name": "delivery_fee",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "16": {
    "cid": 16,
    "name": "total",
    "type": "REAL",
    "notnull": 1,
    "dflt_value": null,
    "pk": 0
  },
  "17": {
    "cid": 17,
    "name": "payment_method",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "18": {
    "cid": 18,
    "name": "payment_status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'pending'",
    "pk": 0
  },
  "19": {
    "cid": 19,
    "name": "payment_transaction_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "20": {
    "cid": 20,
    "name": "status",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'received'",
    "pk": 0
  },
  "21": {
    "cid": 21,
    "name": "estimated_time",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "22": {
    "cid": 22,
    "name": "cancellation_reason",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "23": {
    "cid": 23,
    "name": "notes",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "24": {
    "cid": 24,
    "name": "created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "25": {
    "cid": 25,
    "name": "updated_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "datetime('now')",
    "pk": 0
  },
  "26": {
    "cid": 26,
    "name": "customer_address",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "27": {
    "cid": 27,
    "name": "payment_amount",
    "type": "REAL",
    "notnull": 0,
    "dflt_value": "0",
    "pk": 0
  },
  "28": {
    "cid": 28,
    "name": "source",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": "'api'",
    "pk": 0
  },
  "29": {
    "cid": 29,
    "name": "webhook_metadata",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "30": {
    "cid": 30,
    "name": "original_order_id",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "31": {
    "cid": 31,
    "name": "webhook_created_at",
    "type": "TEXT",
    "notnull": 0,
    "dflt_value": null,
    "pk": 0
  },
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.631] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_items ADD COLUMN category TEXT DEFAULT 'General'...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.633] INFO: ðŸŽ‰ OhMyApp.io migration completed successfully!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.634] INFO: ðŸ§ª Testing new database structure...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.638] INFO: âœ… All new order columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.667] INFO: âœ… order_items.category column is present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.632] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN modifier_id TEXT...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.701] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Service Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 4,
  "steps": [
    {
      "step": 1,
      "description": "Service method called with order data",
      "status": "completed",
      "data": [
        "orderId",
        "hasIdempotencyKey"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Idempotency check completed",
      "status": "completed",
      "data": [
        "existingOrderFound"
      ],
      "duration": 25,
      "error": null
    },
    {
      "step": 3,
      "description": "Internal ID generated",
      "status": "completed",
      "data": [
        "internalId"
      ],
      "duration": 25,
      "error": null
    },
    {
      "step": 4,
      "description": "Service error occurred",
      "status": "failed",
      "data": null,
      "duration": 105,
      "error": "Totals reconciliation failed"
    }
  ]
}
[2025-11-12 18:56:01.702] ERROR: âŒ SERVICE CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals reconciliation failed",
  "stack": "TotalsMismatchError: Totals reconciliation failed\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:191:21)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "serviceProcessingTime": "105ms",
  "failedAtStep": 4,
  "orderDataSnapshot": {
    "orderId": "ORD-1762973761552-TM",
    "externalOrderId": "EXT-1762973761552-TM",
    "hasCustomer": true,
    "hasItems": true,
    "itemCount": 1,
    "hasTotals": true,
    "totalAmount": 3
  },
  "databaseState": {
    "lastQuery": "Check logs for last executed query"
  }
}
[2025-11-12 18:56:01.705] DEBUG: ðŸ‘£ STEP-BY-STEP DEBUG - Order Creation Process (FAILED)
{
  "service": "pos-order-gateway-api",
  "totalSteps": 6,
  "steps": [
    {
      "step": 1,
      "description": "Incoming request logged",
      "status": "completed",
      "data": [
        "method",
        "url",
        "bodySize",
        "isOhMyAppWebhook",
        "webhookConfidence"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 2,
      "description": "Raw order data extracted and analyzed",
      "status": "completed",
      "data": [
        "hasData",
        "dataType",
        "keys",
        "nullCount",
        "dataExtracted",
        "extractionPath"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 3,
      "description": "Idempotency key processed",
      "status": "completed",
      "data": [
        "hasKey",
        "generated"
      ],
      "duration": 1,
      "error": null
    },
    {
      "step": 4,
      "description": "Order data transformation completed",
      "status": "completed",
      "data": [
        "itemsProcessed",
        "totalAmount",
        "hasCustomer"
      ],
      "duration": 4,
      "error": null
    },
    {
      "step": 5,
      "description": "Calling order service",
      "status": "in-progress",
      "data": [
        "orderId",
        "idempotencyKey"
      ],
      "duration": 16,
      "error": null
    },
    {
      "step": 6,
      "description": "Error occurred",
      "status": "failed",
      "data": null,
      "duration": 127,
      "error": "Totals mismatch"
    }
  ]
}
[2025-11-12 18:56:01.706] ERROR: âŒ ORDER CREATION FAILED - Detailed Debug
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "processingTime": "127ms",
  "failedAtStep": 6,
  "requestAnalysis": {
    "hasBody": true,
    "bodyKeys": [
      "orderId",
      "externalOrderId",
      "restaurantId",
      "customer",
      "orderType",
      "orderTime",
      "items",
      "totals"
    ],
    "method": "POST",
    "url": "/",
    "contentType": "application/json"
  },
  "processedOrderSnapshot": "Transformation completed"
}
[2025-11-12 18:56:01.708] ERROR: API Error:
{
  "service": "pos-order-gateway-api",
  "error": "Totals mismatch",
  "stack": "Error: Totals mismatch\n    at OrderService.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\services\\orderService.js:471:19)\n    at OrderController.createOrder (D:\\Software\\Dmitri\\Working\\POS_Mobile\\Git\\POSSyncAgent\\API\\src\\controllers\\orderController.js:361:21)",
  "path": "/api/v1/orders",
  "method": "POST",
  "ip": "::ffff:127.0.0.1",
  "body": {
    "orderId": "ORD-1762973761552-TM",
    "externalOrderId": "EXT-1762973761552-TM",
    "restaurantId": "NYC-DELI-001",
    "customer": {
      "name": "Test",
      "phone": "555-1234"
    },
    "orderType": "pickup",
    "orderTime": "2025-11-12T18:56:01.552Z",
    "items": [
      {
        "sku": "COFFEE-12OZ",
        "name": "Coffee",
        "quantity": 1,
        "unitPrice": 3.5
      }
    ],
    "totals": {
      "subtotal": 3,
      "tax": 0,
      "tip": 0,
      "discount": 0,
      "deliveryFee": 0,
      "total": 3
    }
  }
}
[2025-11-12 18:56:01.713] INFO: âœ… All new order_item_modifiers columns are present
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.711] INFO: âš ï¸ Skipped (already exists): ALTER TABLE order_item_modifiers ADD COLUMN quantity INTEGER DEFAULT 1...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.717] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_orders_source ON orders(source)...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.714] INFO: ðŸŽ¯ Database structure test completed!
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.715] INFO: ðŸ”„ Applying Saved Payloads migration...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.723] INFO: âœ… Applied: CREATE TABLE IF NOT EXISTS saved_payloads (...
{
  "service": "pos-order-gateway-api"
}
[2025-11-12 18:56:01.727] INFO: âœ… Applied: CREATE INDEX IF NOT EXISTS idx_saved_payloads_created_at ON saved_payloads(created_at)...
{
  "service": "pos-order-gateway-api"
}
